import"./CWj6FrbW.js";import{o as Pe}from"./C_FCoYF_.js";import{c as ue,f as j,a as v,a7 as we,b as m,U as r,ab as ke,d as l,r as s,t as G,ah as L,s as Me,a3 as o,ag as je,a8 as ie,a9 as xe,B as Oe,ad as d,ai as ye,af as de,ak as Se,ae as Ce,aj as fe}from"./dGHTYzhB.js";import{i as D}from"./_danfitL.js";import{b as ge}from"./Bh6sXfGS.js";import{l as Ne,s as Te,p as O,r as Ve}from"./pnKjlpSc.js";import{B as be}from"./DOI_CNwM.js";import{I as W}from"./CFvsllsx.js";import{a as Ee,C as Ge,d as Le,s as Ie,e as qe,i as De,c as Re,r as He}from"./X3gEIfGK.js";/* empty css        */import{s as Ue}from"./BZZkyLtE.js";import{b as Xe}from"./EndzCuNO.js";import{S as Je,d as Ke}from"./5fA7gCJ-.js";import{X as We}from"./Z30GsDLy.js";import"./Bf0aZHXT.js";import{I as Ye,s as Ze}from"./DblrYRE4.js";import{C as ce}from"./D80h1qkp.js";import{s as Qe}from"./CXhoiRHA.js";import{S as $e}from"./sA2ACGqx.js";function ea(R,t){const _=Ne(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.545.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const c=[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]];Ye(R,Te({name:"external-link"},()=>_,{get iconNode(){return c},children:(I,y)=>{var z=ue(),g=j(z);Ze(g,t,"default",{}),v(I,z)},$$slots:{default:!0}}))}var aa=m('<label class="label svelte-gjx2ev"> </label>'),ra=m('<option class="svelte-gjx2ev"> </option>'),ta=m('<span class="error-message svelte-gjx2ev"> </span>'),la=m("<!> <select><!></select> <!>",1);function he(R,t){we(t,!0);let _=O(t,"options",19,()=>[]),c=O(t,"value",15,""),I=O(t,"class",3,""),y=Ve(t,["$$slots","$$events","$$legacy","label","error","options","value","class","id","children"]);const z=t.id||`select-${Math.random().toString(36).substr(2,9)}`;var g=la(),e=j(g);{var N=p=>{var h=aa(),B=l(h,!0);s(h),G(()=>{Ie(h,"for",z),L(B,t.label)}),v(p,h)};D(e,p=>{t.label&&p(N)})}var A=r(e,2);Ee(A,p=>({id:t.id,class:`select ${I()??""}`,...y,[Ge]:p}),[()=>({error:t.error})],void 0,"svelte-gjx2ev");var q=l(A);{var K=p=>{var h=ue(),B=j(h);Me(B,()=>t.children),v(p,h)},oe=p=>{var h=ue(),B=j(h);qe(B,17,_,De,(ve,H)=>{var T=ra(),Z=l(T,!0);s(T);var Q={};G(()=>{L(Z,o(H).label),Q!==(Q=o(H).value)&&(T.value=(T.__value=o(H).value)??"")}),v(ve,T)}),v(p,h)};D(q,p=>{t.children?p(K):p(oe,!1)})}s(A);var Y=r(A,2);{var re=p=>{var h=ta(),B=l(h,!0);s(h),G(()=>L(B,t.error)),v(p,h)};D(Y,p=>{t.error&&p(re)})}Le(A,c),v(R,g),ke()}function sa(R,t,_,c,I,y,z){var e;const g=R.target;d(t,g.value,!0),o(_)&&o(t)!==o(_).label&&(d(_,null),c(""),(e=I.onValueChange)==null||e.call(I,"")),y(o(t)),d(z,!0)}var ia=m('<button type="button" class="clear-btn svelte-1kxtmwo" title="Limpiar selección"><!></button>'),oa=m('<div class="loading svelte-1kxtmwo">Buscando...</div>'),va=(R,t,_)=>t(o(_)),na=m('<span class="option-meta svelte-1kxtmwo"> </span>'),da=m('<span class="option-document svelte-1kxtmwo"> </span>'),ca=m('<button type="button" class="option svelte-1kxtmwo"><div class="option-main svelte-1kxtmwo"><span class="option-label svelte-1kxtmwo"> </span> <!></div> <!></button>'),ua=m('<div class="dropdown svelte-1kxtmwo"><!></div>'),ma=m('<div class="dropdown svelte-1kxtmwo"><div class="no-results svelte-1kxtmwo"><p class="svelte-1kxtmwo">No se encontraron clientes</p> <a href="/clientes/nuevo" target="_blank" class="create-link svelte-1kxtmwo"><!> Crear nuevo cliente</a></div></div>'),_a=m('<div class="error-message svelte-1kxtmwo"> </div>'),pa=m('<div class="help-text svelte-1kxtmwo">Si el cliente no existe, <a href="/clientes/nuevo" target="_blank" class="svelte-1kxtmwo">créalo primero</a></div>'),fa=m('<div><div class="input-wrapper svelte-1kxtmwo"><div class="icon-left svelte-1kxtmwo"><!></div> <input type="text" autocomplete="off" class="svelte-1kxtmwo"/> <!></div> <!> <!> <!> <!></div>');function ga(R,t){we(t,!0);let _=O(t,"value",15,""),c=O(t,"placeholder",3,"Buscar cliente..."),I=O(t,"error",3,""),y=O(t,"required",3,!1),z=O(t,"disabled",3,!1),g=ie(""),e=ie(xe([])),N=ie(!1),A=ie(!1),q=ie(null),K;Pe(async()=>{_()&&await oe(_())}),Oe(()=>{_()&&!o(q)?oe(_()):!_()&&o(q)&&(d(q,null),d(g,""))});async function oe(a){try{const i=await fetch(`/api/clients/${a}`);if(i.ok){const S=(await i.json()).client;S&&(d(q,{value:S.id,label:`${S.first_name} ${S.last_name}`,email:S.email_primary,document:S.document_number},!0),d(g,o(q).label,!0))}}catch(i){console.error("Error fetching client:",i)}}async function Y(a){if(!a||a.length<2){d(e,[],!0);return}d(A,!0);try{const i=await fetch(`/api/clients/search?q=${encodeURIComponent(a)}&limit=20`);if(i.ok){const k=await i.json();d(e,k.options||[],!0)}else d(e,[],!0)}catch(i){console.error("Error searching clients:",i),d(e,[],!0)}finally{d(A,!1)}}const re=Ke(a=>{Y(a)},300);function p(a){var i;d(q,a,!0),d(g,a.label,!0),_(a.value),d(N,!1),(i=t.onValueChange)==null||i.call(t,a.value)}function h(){var a;d(q,null),d(g,""),_(""),d(e,[],!0),d(N,!1),(a=t.onValueChange)==null||a.call(t,""),K==null||K.focus()}function B(){o(g)&&!o(q)&&(re(o(g)),d(N,!0))}function ve(){setTimeout(()=>{d(N,!1)},200)}var H=fa();let T;var Z=l(H),Q=l(Z),n=l(Q);Je(n,{size:18}),s(Q);var u=r(Q,2);He(u),u.__input=[sa,g,q,_,t,re,N],Xe(u,a=>K=a,()=>K);var x=r(u,2);{var w=a=>{var i=ia();i.__click=h;var k=l(i);We(k,{size:16}),s(i),v(a,i)};D(x,a=>{o(q)&&a(w)})}s(Z);var b=r(Z,2);{var U=a=>{var i=ua(),k=l(i);{var S=E=>{var f=oa();v(E,f)},C=E=>{var f=ue(),me=j(f);qe(me,17,()=>o(e),De,(_e,$)=>{var ne=ca();ne.__click=[va,p,$];var J=l(ne),ee=l(J),ae=l(ee,!0);s(ee);var ze=r(ee,2);{var Ae=le=>{var se=na(),pe=l(se,!0);s(se),G(()=>L(pe,o($).email)),v(le,se)};D(ze,le=>{o($).email&&le(Ae)})}s(J);var Fe=r(J,2);{var Be=le=>{var se=da(),pe=l(se,!0);s(se),G(()=>L(pe,o($).document)),v(le,se)};D(Fe,le=>{o($).document&&le(Be)})}s(ne),G(()=>L(ae,o($).label)),v(_e,ne)}),v(E,f)};D(k,E=>{o(A)?E(S):E(C,!1)})}s(i),v(a,i)};D(b,a=>{o(N)&&(o(A)||o(e).length>0)&&a(U)})}var P=r(b,2);{var M=a=>{var i=ma(),k=l(i),S=r(l(k),2),C=l(S);ea(C,{size:14}),de(),s(S),s(k),s(i),v(a,i)};D(P,a=>{o(N)&&!o(A)&&o(e).length===0&&o(g).length>=2&&a(M)})}var F=r(P,2);{var X=a=>{var i=_a(),k=l(i,!0);s(i),G(()=>L(k,I())),v(a,i)};D(F,a=>{I()&&a(X)})}var V=r(F,2);{var te=a=>{var i=pa();v(a,i)};D(V,a=>{o(q)||a(te)})}s(H),G(a=>{T=Ue(H,1,"searchable-select svelte-1kxtmwo",null,T,a),Re(u,o(g)),Ie(u,"placeholder",c()),u.required=y(),u.disabled=z()},[()=>({error:!!I(),disabled:z()})]),ye("focus",u,B),ye("blur",u,ve),v(R,H),ke()}je(["input","click"]);var ba=m('<!> <small class="help-text svelte-107edav">Crea aseguradoras en Configuración → Aseguradoras</small>',1),ha=m('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Información General</h2></div> <div class="form-grid svelte-107edav"><div class="form-group svelte-107edav"><label for="client_id" class="svelte-107edav">Cliente <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="policy_number" class="svelte-107edav">Número de Póliza <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="policy_type" class="svelte-107edav">Tipo de Seguro <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="payment_mode" class="svelte-107edav">Modalidad de Pago</label> <!></div> <div class="form-group svelte-107edav"><label for="insurer_id" class="svelte-107edav">Compañía Aseguradora</label> <!></div> <div class="form-group svelte-107edav"><label for="vehicle_plate" class="svelte-107edav">Matrícula (si aplica)</label> <!></div></div>',1),xa=m('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Información Financiera</h2></div> <div class="form-grid svelte-107edav"><div class="form-group svelte-107edav"><label for="insured_sum" class="svelte-107edav">Suma Asegurada (ARS)</label> <!></div> <div class="form-group svelte-107edav"><label for="premium" class="svelte-107edav">Premio (ARS)</label> <!></div> <div class="form-group full-width svelte-107edav"><label for="accessories" class="svelte-107edav">Accesorios</label> <textarea id="accessories" placeholder="Descripción de accesorios incluidos..." rows="2" maxlength="2000" class="svelte-107edav"></textarea> <small class="help-text svelte-107edav"> </small></div> <div class="form-group full-width svelte-107edav"><label for="endorsement" class="svelte-107edav">Endoso</label> <textarea id="endorsement" placeholder="Detalles del endoso..." rows="2" maxlength="2000" class="svelte-107edav"></textarea> <small class="help-text svelte-107edav"> </small></div></div>',1),ya=m('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Fechas</h2></div> <div class="form-grid svelte-107edav"><div class="form-group svelte-107edav"><label for="start_date" class="svelte-107edav">Fecha de Inicio <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="expiry_date" class="svelte-107edav">Fecha de Vencimiento <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="review_date" class="svelte-107edav">Fecha de Revisión</label> <div style="display: flex; gap: 8px;" class="svelte-107edav"><!> <!></div> <small class="help-text svelte-107edav">Fecha sugerida para revisar la póliza antes del vencimiento</small></div></div>',1),wa=m('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Observaciones</h2></div> <div class="form-group svelte-107edav"><label for="observations" class="svelte-107edav">Observaciones</label> <textarea id="observations" placeholder="Información adicional sobre la póliza..." rows="4" maxlength="1000" class="svelte-107edav"></textarea> <small class="help-text svelte-107edav"> </small></div>',1),ka=m('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Seguimientos</h2></div> <div class="info-message svelte-107edav"><p class="svelte-107edav">ℹ️ Los seguimientos se pueden agregar después de crear la póliza</p></div>',1),Sa=m("<!> ",1),Ca=m('<form class="svelte-107edav"><!> <!> <!> <!> <!> <div class="form-actions svelte-107edav"><!> <!></div></form>');function Ua(R,t){we(t,!0);let _=O(t,"mode",3,"create"),c=O(t,"initialData",19,()=>({})),I=O(t,"loading",3,!1),y=O(t,"errors",19,()=>({})),z=ie(!1),g=ie(xe([])),e=xe({client_id:c().client_id||"",policy_number:c().policy_number||"",policy_type:c().policy_type||"",insurer_id:c().insurer_id||"",payment_mode:c().payment_mode||"",start_date:c().start_date||"",expiry_date:c().expiry_date||"",review_date:c().review_date||"",vehicle_plate:c().vehicle_plate||"",insured_sum:c().insured_sum||"",accessories:c().accessories||"",premium:c().premium||"",endorsement:c().endorsement||"",observations:c().observations||""});const N=[{value:"auto",label:"Auto"},{value:"home",label:"Hogar"},{value:"life",label:"Vida"},{value:"health",label:"Salud"},{value:"business",label:"Negocio"},{value:"other",label:"Otro"}],A=[{value:"monthly",label:"Mensual"},{value:"quarterly",label:"Trimestral"},{value:"biannual",label:"Semestral"},{value:"annual",label:"Anual"}];Pe(async()=>{await q()});async function q(){d(z,!0);try{const n=await fetch("/api/insurance-companies"),u=await n.json();n.ok&&d(g,u.companies||[],!0)}catch(n){console.error("Error loading insurers:",n)}finally{d(z,!1)}}function K(){if(!e.expiry_date){Qe({type:"error",message:"Primero ingresa la fecha de vencimiento"});return}const n=new Date(e.expiry_date);n.setDate(n.getDate()-30),e.review_date=n.toISOString().split("T")[0]}function oe(n){n.preventDefault();const u={...e,insured_sum:e.insured_sum?parseFloat(e.insured_sum):null,premium:e.premium?parseFloat(e.premium):null,insurer_id:e.insurer_id||null,review_date:e.review_date||null,accessories:e.accessories||null,endorsement:e.endorsement||null,observations:e.observations||null,payment_mode:e.payment_mode||null,vehicle_plate:e.vehicle_plate||null};t.onSubmit(u)}var Y=Ca(),re=l(Y);ce(re,{children:(n,u)=>{var x=ha(),w=r(j(x),2),b=l(w),U=r(l(b),2);ga(U,{placeholder:"Buscar cliente por nombre, email o documento...",get error(){return y().client_id},required:!0,get value(){return e.client_id},set value(f){e.client_id=f}}),s(b);var P=r(b,2),M=r(l(P),2);W(M,{id:"policy_number",placeholder:"POL-2024-001",get error(){return y().policy_number},required:!0,get value(){return e.policy_number},set value(f){e.policy_number=f}}),s(P);var F=r(P,2),X=r(l(F),2);he(X,{id:"policy_type",get options(){return N},placeholder:"Selecciona un tipo",get error(){return y().policy_type},required:!0,get value(){return e.policy_type},set value(f){e.policy_type=f}}),s(F);var V=r(F,2),te=r(l(V),2);he(te,{id:"payment_mode",get options(){return A},placeholder:"Selecciona modalidad",get error(){return y().payment_mode},get value(){return e.payment_mode},set value(f){e.payment_mode=f}}),s(V);var a=r(V,2),i=r(l(a),2);{var k=f=>{W(f,{disabled:!0,placeholder:"Cargando aseguradoras..."})},S=f=>{var me=ue(),_e=j(me);{var $=J=>{var ee=ba(),ae=j(ee);W(ae,{disabled:!0,placeholder:"Sin compañías creadas"}),de(2),v(J,ee)},ne=J=>{{let ee=Ce(()=>o(g).map(ae=>({value:ae.id,label:ae.name})));he(J,{id:"insurer_id",get options(){return o(ee)},placeholder:"Selecciona aseguradora",get error(){return y().insurer_id},get value(){return e.insurer_id},set value(ae){e.insurer_id=ae}})}};D(_e,J=>{o(g).length===0?J($):J(ne,!1)},!0)}v(f,me)};D(i,f=>{o(z)?f(k):f(S,!1)})}s(a);var C=r(a,2),E=r(l(C),2);W(E,{id:"vehicle_plate",placeholder:"ABC1234",get error(){return y().vehicle_plate},get value(){return e.vehicle_plate},set value(f){e.vehicle_plate=f}}),s(C),s(w),v(n,x)},$$slots:{default:!0}});var p=r(re,2);ce(p,{children:(n,u)=>{var x=xa(),w=r(j(x),2),b=l(w),U=r(l(b),2);W(U,{id:"insured_sum",type:"number",step:"0.01",placeholder:"0.00",get error(){return y().insured_sum},get value(){return e.insured_sum},set value(C){e.insured_sum=C}}),s(b);var P=r(b,2),M=r(l(P),2);W(M,{id:"premium",type:"number",step:"0.01",placeholder:"0.00",get error(){return y().premium},get value(){return e.premium},set value(C){e.premium=C}}),s(P);var F=r(P,2),X=r(l(F),2);fe(X);var V=r(X,2),te=l(V);s(V),s(F);var a=r(F,2),i=r(l(a),2);fe(i);var k=r(i,2),S=l(k);s(k),s(a),s(w),G(()=>{var C,E;L(te,`${(((C=e.accessories)==null?void 0:C.length)||0)??""}/2000 caracteres`),L(S,`${(((E=e.endorsement)==null?void 0:E.length)||0)??""}/2000 caracteres`)}),ge(X,()=>e.accessories,C=>e.accessories=C),ge(i,()=>e.endorsement,C=>e.endorsement=C),v(n,x)},$$slots:{default:!0}});var h=r(p,2);ce(h,{children:(n,u)=>{var x=ya(),w=r(j(x),2),b=l(w),U=r(l(b),2);W(U,{id:"start_date",type:"date",get error(){return y().start_date},required:!0,get value(){return e.start_date},set value(a){e.start_date=a}}),s(b);var P=r(b,2),M=r(l(P),2);W(M,{id:"expiry_date",type:"date",get error(){return y().expiry_date},required:!0,get value(){return e.expiry_date},set value(a){e.expiry_date=a}}),s(P);var F=r(P,2),X=r(l(F),2),V=l(X);W(V,{id:"review_date",type:"date",get error(){return y().review_date},style:"flex: 1;",get value(){return e.review_date},set value(a){e.review_date=a}});var te=r(V,2);{let a=Ce(()=>!e.expiry_date);be(te,{type:"button",variant:"outline",onclick:K,get disabled(){return o(a)},children:(i,k)=>{de();var S=Se("Sugerir (30 días antes)");v(i,S)},$$slots:{default:!0}})}s(X),de(2),s(F),s(w),v(n,x)},$$slots:{default:!0}});var B=r(h,2);ce(B,{children:(n,u)=>{var x=wa(),w=r(j(x),2),b=r(l(w),2);fe(b);var U=r(b,2),P=l(U);s(U),s(w),G(()=>{var M;return L(P,`${(((M=e.observations)==null?void 0:M.length)||0)??""}/1000 caracteres`)}),ge(b,()=>e.observations,M=>e.observations=M),v(n,x)},$$slots:{default:!0}});var ve=r(B,2);{var H=n=>{ce(n,{children:(u,x)=>{var w=ka();de(2),v(u,w)},$$slots:{default:!0}})};D(ve,n=>{_()==="create"&&n(H)})}var T=r(ve,2),Z=l(T);be(Z,{type:"button",variant:"outline",get onclick(){return t.onCancel},get disabled(){return I()},children:(n,u)=>{de();var x=Se("Cancelar");v(n,x)},$$slots:{default:!0}});var Q=r(Z,2);be(Q,{type:"submit",variant:"primary",get disabled(){return I()},children:(n,u)=>{var x=Sa(),w=j(x);$e(w,{size:18});var b=r(w);G(()=>L(b,` ${I()?"Guardando...":_()==="create"?"Guardar Póliza":"Guardar Cambios"}`)),v(n,x)},$$slots:{default:!0}}),s(T),s(Y),ye("submit",Y,oe),v(R,Y),ke()}export{Ua as P,he as S};
