import"../chunks/CWj6FrbW.js";import{o as la}from"../chunks/DFUbiISE.js";import{ag as Ct,a7 as It,b as f,d as a,r as t,U as r,af as et,ak as Le,t as F,ah as h,a3 as e,ae as H,a as n,ab as jt,a8 as j,a9 as Ie,c as Ye,ai as Nt,f as W,bm as Ht,ad as i,B as Ot,aj as ia,aa as oa,ac as na,aB as va}from"../chunks/BKJL6YfG.js";import{i as E}from"../chunks/CX_YFbLR.js";import{e as je,r as ct,b as St,i as Me,d as Et,s as ca}from"../chunks/BpKyf_Cv.js";import{s as qt}from"../chunks/Dk1W01op.js";import{b as Kt,a as da}from"../chunks/DFnROSPn.js";import{p as _a,a as Xt,b as Jt}from"../chunks/B-WhYZDZ.js";import{g as $e}from"../chunks/EB3MSLgs.js";import{p as Zt}from"../chunks/DVeIWuaj.js";import{B as ht}from"../chunks/PkYitcBM.js";import{T as ua}from"../chunks/DJ5sZ6zs.js";import{E as pa}from"../chunks/BgyM9Zwg.js";import{F as fa,A as ya,a as ma,S as ga,I as ba}from"../chunks/BlODj10C.js";/* empty css                */import{B as Qt}from"../chunks/D97hAcun.js";import{U as Ut}from"../chunks/D_oucVYi.js";import{C as Wt}from"../chunks/DsZoCF9s.js";import{E as Yt}from"../chunks/Cpkq0bLj.js";import{T as $t}from"../chunks/C0O21K1o.js";import{X as Lt}from"../chunks/CdLs7B8i.js";import{C as ha,P as xa}from"../chunks/Bao387do.js";import{I as vt}from"../chunks/B3SDN7PV.js";import{s as ze}from"../chunks/CqXjdqoA.js";import{F as ea}from"../chunks/Cb1H4-Fo.js";import{A as ka}from"../chunks/cKUVvFVp.js";import{S as wa}from"../chunks/BscbxjZa.js";import{d as Pa,S as za}from"../chunks/7b1KgCNQ.js";import{P as Sa}from"../chunks/CMz8jQQe.js";var Ea=f('<span class="expiry-badge svelte-1jbgj2g"> </span>'),Ca=(P,s)=>s.onView(s.policy.id),Ia=(P,s)=>s.onDelete(s.policy.id,s.policy.policy_number||"esta póliza"),ja=f('<div class="policy-card svelte-1jbgj2g"><div class="card-header svelte-1jbgj2g"><span class="card-number svelte-1jbgj2g"> </span> <!></div> <div class="card-body svelte-1jbgj2g"><div class="policy-number svelte-1jbgj2g"> </div> <div class="policy-type svelte-1jbgj2g"> </div> <div class="card-info svelte-1jbgj2g"><div class="info-item svelte-1jbgj2g"><!> <span> </span></div> <div class="info-item svelte-1jbgj2g"><!> <span> </span> <!></div></div></div> <div class="card-actions svelte-1jbgj2g"><button class="action-btn svelte-1jbgj2g" title="Ver"><!></button> <button class="action-btn danger svelte-1jbgj2g" title="Eliminar"><!></button></div></div>');function Ma(P,s){It(s,!0);function u(w,ae){return w?new Date(ae)<new Date?{variant:"warning",label:"Vencida"}:{variant:"success",label:"Activa"}:{variant:"error",label:"Inactiva"}}function z(w){const ae=new Date,J=new Date(w);return Math.ceil((J.getTime()-ae.getTime())/(1e3*60*60*24))}function D(w){return new Date(w).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}const g=H(()=>u(s.policy.active,s.policy.expiry_date)),o=H(()=>z(s.policy.expiry_date)),ee=H(()=>s.policy.client?`${s.policy.client.first_name} ${s.policy.client.last_name}`:"Cliente no disponible");var N=ja(),x=a(N),re=a(x),se=a(re);t(re);var p=r(re,2);Qt(p,{get variant(){return e(g).variant},children:(w,ae)=>{et();var J=Le();F(()=>h(J,e(g).label)),n(w,J)},$$slots:{default:!0}}),t(x);var O=r(x,2),pe=a(O),he=a(pe,!0);t(pe);var ne=r(pe,2),U=a(ne,!0);t(ne);var Ae=r(ne,2),xe=a(Ae),Se=a(xe);Ut(Se,{size:14});var Te=r(Se,2),K=a(Te,!0);t(Te),t(xe);var C=r(xe,2),V=a(C);Wt(V,{size:14});var te=r(V,2),b=a(te,!0);t(te);var B=r(te,2);{var R=w=>{var ae=Ea(),J=a(ae);t(ae),F(()=>h(J,`${e(o)??""}d`)),n(w,ae)};E(B,w=>{e(o)<=30&&e(o)>0&&w(R)})}t(C),t(Ae),t(O);var ve=r(O,2),X=a(ve);X.__click=[Ca,s];var le=a(X);Yt(le,{size:16}),t(X);var ce=r(X,2);ce.__click=[Ia,s];var Y=a(ce);$t(Y,{size:16}),t(ce),t(ve),t(N),F(w=>{h(se,`#${s.index+1}`),h(he,s.policy.policy_number||"S/N"),h(U,s.policy.policy_type),h(K,e(ee)),h(b,w)},[()=>D(s.policy.expiry_date)]),n(P,N),jt()}Ct(["click"]);var Aa=(P,s,u)=>s(e(u).value),Ta=f('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),Fa=(P,s,u)=>s(e(u).value),Da=f('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),Va=(P,s,u)=>s(e(u)),Ba=f('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),Na=(P,s,u)=>s(e(u).value),Oa=f('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),Ua=f("<!> Aplicar <!>",1),La=f('<button class="backdrop svelte-1cif4vt" aria-label="Close filter panel"></button> <div class="filter-panel svelte-1cif4vt"><div class="filter-header svelte-1cif4vt"><h3 class="svelte-1cif4vt">Filtros</h3> <button class="close-btn svelte-1cif4vt"><!></button></div> <div class="filter-content svelte-1cif4vt"><div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Tipo de Póliza</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Forma de Pago</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Aseguradora</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Estado</h4> <div class="checkbox-list svelte-1cif4vt"></div></div></div> <div class="filter-footer svelte-1cif4vt"><!> <!></div></div>',1);function Ra(P,s){var K,C,V,te;It(s,!0);const u={policyTypes:[],paymentModes:[],insurers:[],statuses:[]};let z=j(Ie(((K=s.initialFilters)==null?void 0:K.policyTypes)||u.policyTypes)),D=j(Ie(((C=s.initialFilters)==null?void 0:C.paymentModes)||u.paymentModes)),g=j(Ie(((V=s.initialFilters)==null?void 0:V.insurers)||u.insurers)),o=j(Ie(((te=s.initialFilters)==null?void 0:te.statuses)||u.statuses));const ee=[{value:"auto",label:"Auto"},{value:"home",label:"Hogar"},{value:"life",label:"Vida"},{value:"health",label:"Salud"},{value:"business",label:"Empresa"},{value:"other",label:"Otro"}],N=[{value:"monthly",label:"Mensual"},{value:"quarterly",label:"Trimestral"},{value:"semi-annual",label:"Semestral"},{value:"annual",label:"Anual"}],x=[{value:"active",label:"Activa"},{value:"inactive",label:"Inactiva"},{value:"expiring_soon",label:"Por vencer"},{value:"expired",label:"Vencida"}],re=["Mapfre","AXA","Allianz","Generali","Zurich"];function se(b){e(z).includes(b)?i(z,e(z).filter(B=>B!==b),!0):i(z,[...e(z),b],!0)}function p(b){e(D).includes(b)?i(D,e(D).filter(B=>B!==b),!0):i(D,[...e(D),b],!0)}function O(b){e(g).includes(b)?i(g,e(g).filter(B=>B!==b),!0):i(g,[...e(g),b],!0)}function pe(b){e(o).includes(b)?i(o,e(o).filter(B=>B!==b),!0):i(o,[...e(o),b],!0)}function he(){i(z,[],!0),i(D,[],!0),i(g,[],!0),i(o,[],!0)}function ne(){s.onApply({policyTypes:e(z),paymentModes:e(D),insurers:e(g),statuses:e(o)}),s.onClose()}const U=H(()=>()=>e(z).length+e(D).length+e(g).length+e(o).length);function Ae(b){b.key==="Escape"&&s.onClose()}var xe=Ye();Nt("keydown",Ht,Ae);var Se=W(xe);{var Te=b=>{var B=La(),R=W(B);R.__click=function(...M){var k;(k=s.onClose)==null||k.apply(this,M)};var ve=r(R,2),X=a(ve),le=r(a(X),2);le.__click=function(...M){var k;(k=s.onClose)==null||k.apply(this,M)};var ce=a(le);Lt(ce,{size:20}),t(le),t(X);var Y=r(X,2),w=a(Y),ae=r(a(w),2);je(ae,21,()=>ee,Me,(M,k)=>{var I=Ta(),S=a(I);ct(S),S.__change=[Aa,se,k];var G=r(S,2),de=a(G,!0);t(G),t(I),F(v=>{St(S,v),h(de,e(k).label)},[()=>e(z).includes(e(k).value)]),n(M,I)}),t(ae),t(w);var J=r(w,2),ke=r(a(J),2);je(ke,21,()=>N,Me,(M,k)=>{var I=Da(),S=a(I);ct(S),S.__change=[Fa,p,k];var G=r(S,2),de=a(G,!0);t(G),t(I),F(v=>{St(S,v),h(de,e(k).label)},[()=>e(D).includes(e(k).value)]),n(M,I)}),t(ke),t(J);var Fe=r(J,2),Re=r(a(Fe),2);je(Re,21,()=>re,Me,(M,k)=>{var I=Ba(),S=a(I);ct(S),S.__change=[Va,O,k];var G=r(S,2),de=a(G,!0);t(G),t(I),F(v=>{St(S,v),h(de,e(k))},[()=>e(g).includes(e(k))]),n(M,I)}),t(Re),t(Fe);var De=r(Fe,2),Ee=r(a(De),2);je(Ee,21,()=>x,Me,(M,k)=>{var I=Oa(),S=a(I);ct(S),S.__change=[Na,pe,k];var G=r(S,2),de=a(G,!0);t(G),t(I),F(v=>{St(S,v),h(de,e(k).label)},[()=>e(o).includes(e(k).value)]),n(M,I)}),t(Ee),t(De),t(Y);var Ge=r(Y,2),we=a(Ge);ht(we,{variant:"ghost",size:"sm",onclick:he,children:(M,k)=>{et();var I=Le("Limpiar todo");n(M,I)},$$slots:{default:!0}});var Ce=r(we,2);ht(Ce,{variant:"primary",onclick:ne,children:(M,k)=>{var I=Ua(),S=W(I);ha(S,{size:18});var G=r(S,2);{var de=v=>{var y=Le();F(L=>h(y,`(${L??""})`),[()=>e(U)()]),n(v,y)};E(G,v=>{e(U)()>0&&v(de)})}n(M,I)},$$slots:{default:!0}}),t(Ge),t(ve),n(b,B)};E(Se,b=>{s.open&&b(Te)})}n(P,xe),jt()}Ct(["click","change"]);var Ga=(P,s)=>s.onClose(),qa=(P,s,u)=>{const z=s().url.searchParams.get("fromId");z&&(u.onClose(),$e(`/clientes?clientId=${z}&mode=view`))},Ha=f('<button class="back-btn svelte-1yt9re3" title="Volver a cliente"><!></button>'),Ka=f('<p class="subtitle svelte-1yt9re3"> </p>'),Xa=f('<button class="icon-btn svelte-1yt9re3" title="Edit policy"><!></button>'),Ja=(P,s)=>s.onClose(),Za=f('<div class="loading-state svelte-1yt9re3"><p class="svelte-1yt9re3">Cargando detalles de póliza...</p></div>'),Qa=f('<option class="svelte-1yt9re3">Cargando...</option>'),Wa=f('<option class="svelte-1yt9re3">No hay aseguradoras disponibles</option>'),Ya=f('<option class="svelte-1yt9re3"> </option>'),$a=f('<option class="svelte-1yt9re3">Seleccionar aseguradora</option> <!>',1),er=f('<span class="error-text svelte-1yt9re3"> </span>'),tr=f('<section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Información del Vehículo</h3> <div class="form-field svelte-1yt9re3"><label for="vehicle_plate" class="svelte-1yt9re3">Patente</label> <!></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="vehicle_brand" class="svelte-1yt9re3">Marca</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="vehicle_model" class="svelte-1yt9re3">Modelo</label> <!></div></div></section>'),ar=(P,s)=>e(s)&&$e(`/clientes?clientId=${e(s).client_id}`),rr=f('<section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Cliente</h3> <div class="client-card svelte-1yt9re3"><div class="client-icon svelte-1yt9re3"><!></div> <div class="client-info svelte-1yt9re3"><div class="client-name svelte-1yt9re3"> </div> <button type="button" class="link-btn svelte-1yt9re3">Ver cliente →</button></div></div></section>'),sr=f('<textarea id="observations" rows="4" placeholder="Observaciones adicionales..." class="svelte-1yt9re3"></textarea>'),lr=f('<p class="field-value preserve-whitespace svelte-1yt9re3"> </p>'),ir=f('<form class="svelte-1yt9re3"><section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Información de la Póliza</h3> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="policy_number" class="svelte-1yt9re3">Número de Póliza</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="policy_type" class="svelte-1yt9re3">Tipo de Póliza</label> <select id="policy_type" class="svelte-1yt9re3"><option class="svelte-1yt9re3">Auto</option><option class="svelte-1yt9re3">Hogar</option><option class="svelte-1yt9re3">Vida</option><option class="svelte-1yt9re3">Salud</option><option class="svelte-1yt9re3">Empresa</option><option class="svelte-1yt9re3">Otro</option></select></div></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="insurer" class="svelte-1yt9re3">Aseguradora</label> <select id="insurer" class="svelte-1yt9re3"><!></select> <!></div> <div class="form-field svelte-1yt9re3"><label for="payment_mode" class="svelte-1yt9re3">Forma de Pago</label> <select id="payment_mode" class="svelte-1yt9re3"><option class="svelte-1yt9re3">Mensual</option><option class="svelte-1yt9re3">Trimestral</option><option class="svelte-1yt9re3">Semestral</option><option class="svelte-1yt9re3">Anual</option></select></div></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="start_date" class="svelte-1yt9re3">Fecha de Inicio</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="expiry_date" class="svelte-1yt9re3">Fecha de Vencimiento</label> <!></div></div></section> <!>  <!> <section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Observaciones</h3> <div class="form-field svelte-1yt9re3"><!></div></section></form>'),or=f("<!> Guardar Cambios",1),nr=f('<div class="modal-footer svelte-1yt9re3"><!> <!></div>'),vr=f('<button class="backdrop svelte-1yt9re3" aria-label="Close modal"></button> <div class="modal-panel svelte-1yt9re3"><div class="modal-header svelte-1yt9re3"><div class="header-content svelte-1yt9re3"><!> <div class="icon-wrapper svelte-1yt9re3"><!></div> <div class="svelte-1yt9re3"><h2 class="svelte-1yt9re3"><!></h2> <!></div></div> <div class="header-actions svelte-1yt9re3"><!> <button class="icon-btn svelte-1yt9re3" title="Close"><!></button></div></div> <div class="modal-content svelte-1yt9re3"><!></div> <!></div>',1);function cr(P,s){It(s,!0);const u=()=>Jt(Zt,"$page",z),[z,D]=Xt();let g=_a(s,"mode",3,"view"),o=j(null),ee=j(!1),N=j(!1),x=j(g()==="edit"),re=j(Ie([])),se=j(!1),p=j(Ie({policy_number:"",policy_type:"auto",insurer:"",payment_mode:"monthly",start_date:"",expiry_date:"",vehicle_plate:"",vehicle_brand:"",vehicle_model:"",observations:""})),O=j(Ie({}));Ot(()=>{pe()}),Ot(()=>{s.policyId&&(i(x,g()==="edit"),he())});async function pe(){i(se,!0);try{const C=await fetch("/api/insurance-companies"),V=await C.json();C.ok?i(re,V.companies||[],!0):console.error("Error loading insurers:",V.message)}catch(C){console.error("Error loading insurers:",C)}finally{i(se,!1)}}async function he(){var C,V,te,b,B,R,ve,X,le,ce;if(s.policyId){i(ee,!0);try{const Y=await fetch(`/api/policies/${s.policyId}`),w=await Y.json();Y.ok?(i(o,w.policy,!0),i(p,{policy_number:((C=e(o))==null?void 0:C.policy_number)||"",policy_type:((V=e(o))==null?void 0:V.policy_type)||"auto",insurer:((te=e(o))==null?void 0:te.insurer)||"",payment_mode:((b=e(o))==null?void 0:b.payment_mode)||"monthly",start_date:((B=e(o))==null?void 0:B.start_date)||"",expiry_date:((R=e(o))==null?void 0:R.expiry_date)||"",vehicle_plate:((ve=e(o))==null?void 0:ve.vehicle_plate)||"",vehicle_brand:((X=e(o))==null?void 0:X.vehicle_brand)||"",vehicle_model:((le=e(o))==null?void 0:le.vehicle_model)||"",observations:((ce=e(o))==null?void 0:ce.observations)||""},!0)):(ze({type:"error",message:"Error loading policy"}),s.onClose())}catch{ze({type:"error",message:"Error loading policy"}),s.onClose()}finally{i(ee,!1)}}}async function ne(){if(s.policyId){i(N,!0),i(O,{},!0);try{const C=await fetch(`/api/policies/${s.policyId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e(p))}),V=await C.json();C.ok?(ze({type:"success",message:"Policy updated successfully"}),i(x,!1),await he(),s.onClose(!0)):(V.errors&&i(O,V.errors,!0),ze({type:"error",message:V.message||"Error updating policy"}))}catch{ze({type:"error",message:"Error updating policy"})}finally{i(N,!1)}}}function U(){i(x,!e(x)),!e(x)&&e(o)&&(i(p,{policy_number:e(o).policy_number||"",policy_type:e(o).policy_type||"auto",insurer:e(o).insurer||"",payment_mode:e(o).payment_mode||"monthly",start_date:e(o).start_date||"",expiry_date:e(o).expiry_date||"",vehicle_plate:e(o).vehicle_plate||"",vehicle_brand:e(o).vehicle_brand||"",vehicle_model:e(o).vehicle_model||"",observations:e(o).observations||""},!0),i(O,{},!0))}const Ae={auto:"Auto",home:"Hogar",life:"Vida",health:"Salud",business:"Empresa",other:"Otro"};function xe(C){C.key==="Escape"&&s.onClose()}var Se=Ye();Nt("keydown",Ht,xe);var Te=W(Se);{var K=C=>{var V=vr(),te=W(V);te.__click=[Ga,s];var b=r(te,2),B=a(b),R=a(B),ve=a(R);{var X=v=>{var y=Ha();y.__click=[qa,u,s];var L=a(y);ka(L,{size:20}),t(y),n(v,y)};E(ve,v=>{u().url.searchParams.get("from")==="client"&&v(X)})}var le=r(ve,2),ce=a(le);ea(ce,{size:24}),t(le);var Y=r(le,2),w=a(Y),ae=a(w);{var J=v=>{var y=Le("Cargando...");n(v,y)},ke=v=>{var y=Ye(),L=W(y);{var qe=_e=>{var fe=Le();F(()=>h(fe,e(o).policy_number||"Sin número")),n(_e,fe)};E(L,_e=>{e(o)&&_e(qe)},!0)}n(v,y)};E(ae,v=>{e(ee)?v(J):v(ke,!1)})}t(w);var Fe=r(w,2);{var Re=v=>{var y=Ka(),L=a(y,!0);t(y),F(()=>h(L,Ae[e(o).policy_type])),n(v,y)};E(Fe,v=>{e(o)&&!e(ee)&&v(Re)})}t(Y),t(R);var De=r(R,2),Ee=a(De);{var Ge=v=>{var y=Xa();y.__click=U;var L=a(y);xa(L,{size:18}),t(y),n(v,y)};E(Ee,v=>{!e(x)&&!e(ee)&&v(Ge)})}var we=r(Ee,2);we.__click=[Ja,s];var Ce=a(we);Lt(Ce,{size:20}),t(we),t(De),t(B);var M=r(B,2),k=a(M);{var I=v=>{var y=Za();n(v,y)},S=v=>{var y=Ye(),L=W(y);{var qe=_e=>{var fe=ir(),ye=a(fe),He=r(a(ye),2),Ke=a(He),dt=r(a(Ke),2);{let _=H(()=>!e(x));vt(dt,{id:"policy_number",get error(){return e(O).policy_number},get disabled(){return e(_)},get value(){return e(p).policy_number},set value(m){e(p).policy_number=m}})}t(Ke);var me=r(Ke,2),ge=r(a(me),2),Xe=a(ge);Xe.value=Xe.__value="auto";var tt=r(Xe);tt.value=tt.__value="home";var _t=r(tt);_t.value=_t.__value="life";var l=r(_t);l.value=l.__value="health";var c=r(l);c.value=c.__value="business";var d=r(c);d.value=d.__value="other",t(ge),t(me),t(He);var A=r(He,2),Z=a(A),T=r(a(Z),2),at=a(T);{var Je=_=>{var m=Qa();m.value=m.__value="",n(_,m)},ut=_=>{var m=Ye(),$=W(m);{var be=Q=>{var ie=Wa();ie.value=ie.__value="",n(Q,ie)},Ne=Q=>{var ie=$a(),ue=W(ie);ue.value=ue.__value="";var Oe=r(ue,2);je(Oe,17,()=>e(re),Me,(Pe,oe)=>{var Ue=Ya(),Dt=a(Ue,!0);t(Ue);var Pt={};F(()=>{h(Dt,e(oe).name),Pt!==(Pt=e(oe).name)&&(Ue.value=(Ue.__value=e(oe).name)??"")}),n(Pe,Ue)}),n(Q,ie)};E($,Q=>{e(re).length===0?Q(be):Q(Ne,!1)},!0)}n(_,m)};E(at,_=>{e(se)?_(Je):_(ut,!1)})}t(T);var Mt=r(T,2);{var At=_=>{var m=er(),$=a(m,!0);t(m),F(()=>h($,e(O).insurer)),n(_,m)};E(Mt,_=>{e(O).insurer&&_(At)})}t(Z);var rt=r(Z,2),Ze=r(a(rt),2),Ve=a(Ze);Ve.value=Ve.__value="monthly";var Be=r(Ve);Be.value=Be.__value="quarterly";var pt=r(Be);pt.value=pt.__value="semi-annual";var q=r(pt);q.value=q.__value="annual",t(Ze),t(rt),t(A);var xt=r(A,2),st=a(xt),Qe=r(a(st),2);{let _=H(()=>!e(x));vt(Qe,{id:"start_date",type:"date",get error(){return e(O).start_date},get disabled(){return e(_)},get value(){return e(p).start_date},set value(m){e(p).start_date=m}})}t(st);var kt=r(st,2),ft=r(a(kt),2);{let _=H(()=>!e(x));vt(ft,{id:"expiry_date",type:"date",get error(){return e(O).expiry_date},get disabled(){return e(_)},get value(){return e(p).expiry_date},set value(m){e(p).expiry_date=m}})}t(kt),t(xt),t(ye);var yt=r(ye,2);{var mt=_=>{var m=tr(),$=r(a(m),2),be=r(a($),2);{let Pe=H(()=>!e(x));vt(be,{id:"vehicle_plate",get error(){return e(O).vehicle_plate},get disabled(){return e(Pe)},get value(){return e(p).vehicle_plate},set value(oe){e(p).vehicle_plate=oe}})}t($);var Ne=r($,2),Q=a(Ne),ie=r(a(Q),2);{let Pe=H(()=>!e(x));vt(ie,{id:"vehicle_brand",get error(){return e(O).vehicle_brand},get disabled(){return e(Pe)},get value(){return e(p).vehicle_brand},set value(oe){e(p).vehicle_brand=oe}})}t(Q);var ue=r(Q,2),Oe=r(a(ue),2);{let Pe=H(()=>!e(x));vt(Oe,{id:"vehicle_model",get error(){return e(O).vehicle_model},get disabled(){return e(Pe)},get value(){return e(p).vehicle_model},set value(oe){e(p).vehicle_model=oe}})}t(ue),t(Ne),t(m),n(_,m)};E(yt,_=>{(e(o).policy_type==="auto"||e(x))&&_(mt)})}var lt=r(yt,2);{var Tt=_=>{var m=rr(),$=r(a(m),2),be=a($),Ne=a(be);Ut(Ne,{size:20}),t(be);var Q=r(be,2),ie=a(Q),ue=a(ie,!0);t(ie);var Oe=r(ie,2);Oe.__click=[ar,o],t(Q),t($),t(m),F(()=>h(ue,e(o).client_full_name||"Sin nombre")),n(_,m)};E(lt,_=>{!e(x)&&e(o).client&&!u().url.searchParams.get("from")&&_(Tt)})}var it=r(lt,2),gt=r(a(it),2),wt=a(gt);{var bt=_=>{var m=sr();ia(m),Kt(m,()=>e(p).observations,$=>e(p).observations=$),n(_,m)},Ft=_=>{var m=lr(),$=a(m,!0);t(m),F(()=>h($,e(o).observations||"Sin observaciones")),n(_,m)};E(wt,_=>{e(x)?_(bt):_(Ft,!1)})}t(gt),t(it),t(fe),F(()=>{ge.disabled=!e(x),T.disabled=!e(x)||e(se),Ze.disabled=!e(x)}),Nt("submit",fe,_=>{_.preventDefault(),ne()}),Et(ge,()=>e(p).policy_type,_=>e(p).policy_type=_),Et(T,()=>e(p).insurer,_=>e(p).insurer=_),Et(Ze,()=>e(p).payment_mode,_=>e(p).payment_mode=_),n(_e,fe)};E(L,_e=>{e(o)&&_e(qe)},!0)}n(v,y)};E(k,v=>{e(ee)?v(I):v(S,!1)})}t(M);var G=r(M,2);{var de=v=>{var y=nr(),L=a(y);ht(L,{variant:"ghost",onclick:U,get disabled(){return e(N)},children:(_e,fe)=>{et();var ye=Le("Cancelar");n(_e,ye)},$$slots:{default:!0}});var qe=r(L,2);ht(qe,{variant:"primary",onclick:ne,get disabled(){return e(N)},children:(_e,fe)=>{var ye=Ye(),He=W(ye);{var Ke=me=>{var ge=Le("Guardando...");n(me,ge)},dt=me=>{var ge=or(),Xe=W(ge);wa(Xe,{size:18}),et(),n(me,ge)};E(He,me=>{e(N)?me(Ke):me(dt,!1)})}n(_e,ye)},$$slots:{default:!0}}),t(y),n(v,y)};E(G,v=>{e(x)&&!e(ee)&&v(de)})}t(b),n(C,V)};E(Te,C=>{s.policyId&&C(K)})}n(P,Se),jt(),D()}Ct(["click"]);function dr(P,s,u,z,D){i(s,e(s)==="asc"?"desc":"asc",!0),i(u,1),i(z,[],!0),D()}function _r(P,s,u,z,D){i(s,{policyTypes:[],paymentModes:[],insurers:[],statuses:[]},!0),i(u,1),i(z,[],!0),D()}var ur=f("<!> Nueva Póliza",1),pr=(P,s,u,z,D)=>{localStorage.setItem("policies_show_inactive",e(s).toString()),i(u,1),i(z,[],!0),D()},fr=(P,s)=>i(s,!e(s)),yr=f('<span class="filter-badge svelte-17pngxe"> </span>'),mr=f('<button class="clear-filters-btn svelte-17pngxe" title="Limpiar filtros"><!></button>'),gr=(P,s,u,z)=>{i(s,1),i(u,[],!0),z()},br=f('<option class="svelte-17pngxe"> </option>'),hr=f('<span class="count-skeleton svelte-17pngxe"></span>'),xr=f('<span class="count-text svelte-17pngxe"> </span> <span class="count-separator svelte-17pngxe">/</span> <span class="count-total svelte-17pngxe"> </span>',1),kr=f('<div class="skeleton-list svelte-17pngxe"></div>'),wr=(P,s,u)=>s(e(u).id,"view"),Pr=(P,s)=>$e(`/clientes?clientId=${e(s).client_id}&mode=view&from=policy&fromId=${e(s).id}`),zr=f('<span class="expiry-badge svelte-17pngxe"> </span>'),Sr=(P,s,u)=>s(e(u).id,"view"),Er=(P,s,u)=>s(e(u).id,e(u).policy_number||"esta póliza"),Cr=f('<tr class="svelte-17pngxe"><td class="row-number svelte-17pngxe"></td><td class="svelte-17pngxe"><button class="policy-number-btn svelte-17pngxe"> </button></td><td class="svelte-17pngxe"><div class="client-info svelte-17pngxe"><!> <button class="client-link-btn svelte-17pngxe"> </button></div></td><td class="svelte-17pngxe"><span class="insurer-name svelte-17pngxe"> </span></td><td class="svelte-17pngxe"> </td><td class="svelte-17pngxe"><!></td><td class="svelte-17pngxe"><div class="expiry-info svelte-17pngxe"><!> <span> </span> <!></div></td><td class="text-nowrap svelte-17pngxe"> </td><td class="text-right svelte-17pngxe"><div class="actions svelte-17pngxe"><button class="action-btn svelte-17pngxe" title="Ver"><!></button> <button class="action-btn danger svelte-17pngxe" title="Eliminar"><!></button></div></td></tr>'),Ir=f('<thead class="sticky-header svelte-17pngxe"><tr class="svelte-17pngxe"><th style="width: 60px" class="svelte-17pngxe">#</th><th class="svelte-17pngxe">N° Póliza</th><th class="svelte-17pngxe">Cliente</th><th class="svelte-17pngxe">Aseguradora</th><th class="svelte-17pngxe">Tipo</th><th class="svelte-17pngxe">Estado</th><th class="svelte-17pngxe">Vencimiento</th><th class="svelte-17pngxe">Creado</th><th class="text-right svelte-17pngxe">Acciones</th></tr></thead> <tbody class="svelte-17pngxe"></tbody>',1),jr=f('<div class="cards-grid svelte-17pngxe"></div> <div class="table-container svelte-17pngxe"><!></div> <!>',1),Mr=f('<div class="page svelte-17pngxe"><div class="page-header svelte-17pngxe"><div class="svelte-17pngxe"><h1 class="svelte-17pngxe">Pólizas</h1> <p class="svelte-17pngxe">Gestiona todas las pólizas de seguros</p></div> <!></div> <div class="filters-toolbar svelte-17pngxe"><div class="search-box svelte-17pngxe"><!> <input type="text" placeholder="Buscar pólizas..." class="svelte-17pngxe"/></div> <div class="toolbar-actions svelte-17pngxe"><div class="filter-checkbox svelte-17pngxe"><label class="checkbox-label svelte-17pngxe"><input type="checkbox" class="svelte-17pngxe"/> <span class="svelte-17pngxe">Mostrar inactivas</span></label></div> <button title="Filtros"><!> <!></button> <!> <div class="sort-select svelte-17pngxe"><label for="sort-by" class="svelte-17pngxe">Ordenar por:</label> <select id="sort-by" class="svelte-17pngxe"></select> <button class="sort-order-btn svelte-17pngxe"><!></button></div> <div class="results-count svelte-17pngxe"><!></div></div></div> <!></div> <!> <!>',1);function os(P,s){It(s,!0);const u=()=>Jt(Zt,"$page",z),[z,D]=Xt();let g=j(Ie([])),o=j(!0),ee=j(!1),N=j(""),x=j("created_at"),re=j("desc"),se=j(!1),p=j(1),O=30,pe=j(0),he=j(!0),ne=j(!1),U=j(Ie({policyTypes:[],paymentModes:[],insurers:[],statuses:[]})),Ae=H(()=>u().url.searchParams.get("policyId")),xe=H(()=>u().url.searchParams.get("mode")||"view");const Se=[{value:"created_at",label:"Fecha de creación"},{value:"expiry_date",label:"Fecha de vencimiento"},{value:"policy_number",label:"Número de póliza"},{value:"policy_type",label:"Tipo de póliza"},{value:"insurer",label:"Aseguradora"},{value:"payment_mode",label:"Forma de pago"}];la(()=>{const l=localStorage.getItem("policies_show_inactive");l!==null&&i(se,l==="true"),K()});const Te=Pa(()=>{i(p,1),i(g,[],!0),K()},300);Ot(()=>{e(N)!==void 0&&Te()});async function K(l=!1){var c;l?i(ee,!0):i(o,!0);try{const d=new URLSearchParams({page:e(p).toString(),limit:O.toString(),sortBy:e(x),sortOrder:e(re)});e(N)&&d.append("search",e(N)),e(se)||d.append("active_only","true"),e(U).policyTypes.forEach(T=>{d.append("policy_type",T)}),e(U).paymentModes.forEach(T=>{d.append("payment_mode",T)}),e(U).insurers.forEach(T=>{d.append("insurer",T)}),e(U).statuses.forEach(T=>{d.append("status",T)});const A=await fetch(`/api/policies?${d}`);console.log("Response status:",A.status);const Z=await A.json();console.log("Result:",Z),A.ok?(l?i(g,[...e(g),...Z.policies||[]],!0):i(g,Z.policies||[],!0),i(pe,((c=Z.pagination)==null?void 0:c.total)||0,!0),i(he,e(g).length<e(pe))):(ze({type:"error",message:Z.message||"Error al cargar pólizas"}),i(g,[],!0))}catch(d){console.error("Error loading policies:",d),ze({type:"error",message:"Error al cargar pólizas"}),i(g,[],!0)}finally{i(o,!1),i(ee,!1)}}function C(){!e(o)&&!e(ee)&&e(he)&&(va(p),K(!0))}async function V(l,c){if(confirm(`¿Seguro que deseas eliminar la póliza ${c}?`))try{const d=await fetch(`/api/policies/${l}`,{method:"DELETE"});if(d.ok)ze({type:"success",message:"Póliza eliminada"}),K();else{const A=await d.json();ze({type:"error",message:A.message})}}catch{ze({type:"error",message:"Error al eliminar"})}}function te(l){return new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}function b(l,c){return l?new Date(c)<new Date?{variant:"warning",label:"Vencida"}:{variant:"success",label:"Activa"}:{variant:"error",label:"Inactiva"}}function B(l){const c=new Date,d=new Date(l);return Math.ceil((d.getTime()-c.getTime())/(1e3*60*60*24))}const R=H(()=>()=>{let l=0;return l+=e(U).policyTypes.length,l+=e(U).paymentModes.length,l+=e(U).insurers.length,l+=e(U).statuses.length,l});function ve(l){i(U,l,!0),i(p,1),i(g,[],!0),K()}function X(l,c="view"){const d=new URL(window.location.href);d.searchParams.set("policyId",l),d.searchParams.set("mode",c),$e(d.pathname+d.search,{replaceState:!1,noScroll:!0})}function le(l){const c=new URL(window.location.href);c.searchParams.delete("policyId"),c.searchParams.delete("mode"),$e(c.pathname+c.search,{replaceState:!1,noScroll:!0}),l&&(i(p,1),i(g,[],!0),K())}var ce=Mr();oa(l=>{na.title="Pólizas - PAS Manager"});var Y=W(ce),w=a(Y),ae=r(a(w),2);ht(ae,{variant:"primary",onclick:()=>$e("/polizas/nuevo"),children:(l,c)=>{var d=ur(),A=W(d);Sa(A,{size:18}),et(),n(l,d)},$$slots:{default:!0}}),t(w);var J=r(w,2),ke=a(J),Fe=a(ke);za(Fe,{size:20});var Re=r(Fe,2);ct(Re),t(ke);var De=r(ke,2),Ee=a(De),Ge=a(Ee),we=a(Ge);ct(we),we.__change=[pr,se,p,g,K],et(2),t(Ge),t(Ee);var Ce=r(Ee,2);let M;Ce.__click=[fr,ne];var k=a(Ce);fa(k,{size:18});var I=r(k,2);{var S=l=>{var c=yr(),d=a(c,!0);t(c),F(A=>h(d,A),[()=>e(R)()]),n(l,c)};E(I,l=>{e(R)()>0&&l(S)})}t(Ce);var G=r(Ce,2);{var de=l=>{var c=mr();c.__click=[_r,U,p,g,K];var d=a(c);Lt(d,{size:18}),t(c),n(l,c)};E(G,l=>{e(R)()>0&&l(de)})}var v=r(G,2),y=r(a(v),2);y.__change=[gr,p,g,K],je(y,21,()=>Se,Me,(l,c)=>{var d=br(),A=a(d,!0);t(d);var Z={};F(()=>{h(A,e(c).label),Z!==(Z=e(c).value)&&(d.value=(d.__value=e(c).value)??"")}),n(l,d)}),t(y);var L=r(y,2);L.__click=[dr,re,p,g,K];var qe=a(L);{var _e=l=>{ya(l,{size:16})},fe=l=>{ma(l,{size:16})};E(qe,l=>{e(re)==="asc"?l(_e):l(fe,!1)})}t(L),t(v);var ye=r(v,2),He=a(ye);{var Ke=l=>{var c=hr();n(l,c)},dt=l=>{var c=xr(),d=W(c),A=a(d,!0);t(d);var Z=r(d,4),T=a(Z,!0);t(Z),F(()=>{h(A,e(g).length),h(T,e(pe))}),n(l,c)};E(He,l=>{e(o)&&e(g).length===0?l(Ke):l(dt,!1)})}t(ye),t(De),t(J);var me=r(J,2);{var ge=l=>{var c=kr();je(c,20,()=>Array(5),Me,(d,A)=>{ga(d,{height:"60px"})}),t(c),n(l,c)},Xe=l=>{var c=Ye(),d=W(c);{var A=T=>{{let at=H(()=>e(N)||e(R)()>0?"No se encontraron resultados":"Comienza agregando tu primera póliza"),Je=H(()=>e(N)||e(R)()>0?void 0:{label:"Nueva Póliza",onclick:()=>$e("/polizas/nuevo")});pa(T,{get icon(){return ea},title:"No hay pólizas",get description(){return e(at)},get action(){return e(Je)}})}},Z=T=>{var at=jr(),Je=W(at);je(Je,21,()=>e(g),Me,(rt,Ze,Ve)=>{Ma(rt,{get policy(){return e(Ze)},index:Ve,onView:Be=>X(Be,"view"),onDelete:V})}),t(Je);var ut=r(Je,2),Mt=a(ut);ua(Mt,{children:(rt,Ze)=>{var Ve=Ir(),Be=r(W(Ve),2);je(Be,21,()=>e(g),Me,(pt,q,xt)=>{const st=H(()=>b(e(q).active,e(q).expiry_date)),Qe=H(()=>B(e(q).expiry_date)),kt=H(()=>e(q).client?`${e(q).client.first_name} ${e(q).client.last_name}`:"Cliente no disponible");var ft=Cr(),yt=a(ft);yt.textContent=xt+1;var mt=r(yt),lt=a(mt);lt.__click=[wr,X,q];var Tt=a(lt,!0);t(lt),t(mt);var it=r(mt),gt=a(it),wt=a(gt);Ut(wt,{size:14});var bt=r(wt,2);bt.__click=[Pr,q];var Ft=a(bt,!0);t(bt),t(gt),t(it);var _=r(it),m=a(_),$=a(m,!0);t(m),t(_);var be=r(_),Ne=a(be,!0);t(be);var Q=r(be),ie=a(Q);Qt(ie,{get variant(){return e(st).variant},children:(We,ot)=>{et();var nt=Le();F(()=>h(nt,e(st).label)),n(We,nt)},$$slots:{default:!0}}),t(Q);var ue=r(Q),Oe=a(ue),Pe=a(Oe);Wt(Pe,{size:14});var oe=r(Pe,2);let Ue;var Dt=a(oe,!0);t(oe);var Pt=r(oe,2);{var ta=We=>{var ot=zr(),nt=a(ot);t(ot),F(()=>h(nt,`${e(Qe)??""}d`)),n(We,ot)};E(Pt,We=>{e(Qe)<=30&&e(Qe)>0&&We(ta)})}t(Oe),t(ue);var Vt=r(ue),aa=a(Vt,!0);t(Vt);var Rt=r(Vt),Gt=a(Rt),zt=a(Gt);zt.__click=[Sr,X,q];var ra=a(zt);Yt(ra,{size:16}),t(zt);var Bt=r(zt,2);Bt.__click=[Er,V,q];var sa=a(Bt);$t(sa,{size:16}),t(Bt),t(Gt),t(Rt),t(ft),F((We,ot,nt)=>{h(Tt,e(q).policy_number||"S/N"),h(Ft,e(kt)),h($,e(q).insurer||"-"),h(Ne,e(q).policy_type),Ue=qt(oe,1,"svelte-17pngxe",null,Ue,We),h(Dt,ot),h(aa,nt)},[()=>({warning:e(Qe)<=30&&e(Qe)>0}),()=>te(e(q).expiry_date),()=>te(e(q).created_at)]),n(pt,ft)}),t(Be),n(rt,Ve)},$$slots:{default:!0}}),t(ut);var At=r(ut,2);ba(At,{get hasMore(){return e(he)},onLoadMore:C}),n(T,at)};E(d,T=>{e(g).length===0?T(A):T(Z,!1)},!0)}n(l,c)};E(me,l=>{e(o)?l(ge):l(Xe,!1)})}t(Y);var tt=r(Y,2);Ra(tt,{get open(){return e(ne)},onClose:()=>i(ne,!1),onApply:ve,get initialFilters(){return e(U)}});var _t=r(tt,2);cr(_t,{get policyId(){return e(Ae)},get mode(){return e(xe)},onClose:le}),F(l=>{M=qt(Ce,1,"filter-btn svelte-17pngxe",null,M,l),ca(L,"title",e(re)==="asc"?"Ascendente":"Descendente")},[()=>({active:e(ne)||e(R)()>0})]),Kt(Re,()=>e(N),l=>i(N,l)),da(we,()=>e(se),l=>i(se,l)),Et(y,()=>e(x),l=>i(x,l)),n(P,ce),jt(),D()}Ct(["change","click"]);export{os as component};
