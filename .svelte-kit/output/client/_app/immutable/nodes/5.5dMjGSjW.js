import"../chunks/CWj6FrbW.js";import{o as Ct}from"../chunks/P-h-QmmT.js";import{af as st,a6 as lt,a7 as T,a8 as Se,o as vt,ac as i,a2 as e,c as ra,aE as et,f as G,a as n,aa as ot,bm as dt,N as f,P as r,Q as t,T as a,aD as sa,ag as N,ah as $,ae as Ce,ad as F,aF as zt,a9 as xt,ab as wt,ay as Pt}from"../chunks/DXalFYC5.js";import{i as k}from"../chunks/DgS_HarA.js";import{s as at,e as Na,i as Ma,r as qe,c as Za,b as St}from"../chunks/CCesXY4h.js";import{s as ct}from"../chunks/CiAFSiaO.js";import{b as Da,a as Et}from"../chunks/Bf-8v-H5.js";import{p as It,a as _t,b as ut}from"../chunks/BkTacmYQ.js";import{g as $e}from"../chunks/DboXdvGe.js";import{p as pt}from"../chunks/MzzRNa-k.js";import{B as Ca}from"../chunks/ey38HHQe.js";import{I as q}from"../chunks/DYUOFKwE.js";import{P as tt,T as At}from"../chunks/BE3yFpjr.js";import{E as Ft}from"../chunks/BjdX1nSD.js";import{F as Tt,A as $t,a as Nt,S as Mt,I as Dt}from"../chunks/DbJVzCiZ.js";import{P as Ut}from"../chunks/2KaYzSf5.js";import{s as ue}from"../chunks/ejPKeNiZ.js";import{i as mt,M as ht,g as ft,P as nt}from"../chunks/C5GPauD2.js";import{U as Lt}from"../chunks/DGbCUdBR.js";import{X as it}from"../chunks/C90WgwIi.js";import{A as jt}from"../chunks/CNwQjRCr.js";import{P as Rt,C as Bt,T as Ot}from"../chunks/CSUxE8_x.js";import{S as qt}from"../chunks/-aJssGs5.js";import{F as rt}from"../chunks/B2p_ebVs.js";import{d as Gt,S as Jt}from"../chunks/DUFLD2a0.js";import{U as Vt}from"../chunks/BtQN14_f.js";import{E as Wt}from"../chunks/BM1HQ7Uf.js";import{M as Kt}from"../chunks/CfGZx9bz.js";var Ht=(z,s)=>s.onClose(),Qt=(z,s,_)=>{const C=s().url.searchParams.get("fromId");C&&(_.onClose(),$e(`/polizas?policyId=${C}&mode=view`))},Xt=f('<button class="back-btn svelte-mh26do" title="Volver a póliza"><!></button>'),Yt=f('<p class="subtitle svelte-mh26do"> </p>'),Zt=f('<button class="icon-btn svelte-mh26do" title="Edit client"><!></button>'),er=(z,s)=>s.onClose(),ar=f('<div class="loading-state svelte-mh26do"><p class="svelte-mh26do">Cargando datos del cliente...</p></div>'),tr=f('<a target="_blank" rel="noopener noreferrer" class="whatsapp-btn svelte-mh26do" title="Abrir en WhatsApp"><!></a>'),rr=f('<textarea id="observations" rows="4" placeholder="Additional notes..." class="svelte-mh26do"></textarea>'),sr=f('<p class="field-value preserve-whitespace svelte-mh26do"> </p>'),lr=(z,s,_)=>{s.onClose(),$e(`/polizas/nuevo?client_id=${e(_).id}`)},or=(z,s,_,C)=>{s.onClose(),$e(`/polizas?policyId=${e(_).id}&mode=view&from=client&fromId=${e(C).id}`)},ir=f('<span class="policy-separator svelte-mh26do">•</span> <span class="policy-insurer svelte-mh26do"> </span>',1),nr=f('<div class="policy-date svelte-mh26do"> </div>'),vr=f('<button type="button" class="policy-card svelte-mh26do"><div class="policy-info svelte-mh26do"><div class="policy-header svelte-mh26do"><strong class="policy-number svelte-mh26do"> </strong> <span> </span></div> <div class="policy-meta svelte-mh26do"><span class="policy-type svelte-mh26do"> </span> <!></div> <!></div> <div class="policy-arrow svelte-mh26do">→</div></button>'),dr=f('<div class="policies-list svelte-mh26do"></div>'),cr=(z,s,_)=>{s.onClose(),$e(`/polizas/nuevo?client_id=${e(_).id}`)},_r=f('<div class="no-policies svelte-mh26do"><!> <p class="svelte-mh26do">Este cliente no tiene pólizas registradas</p> <button type="button" class="create-first-btn svelte-mh26do"><!> Crear primera póliza</button></div>'),ur=f('<section class="form-section policies-section svelte-mh26do"><div class="section-header-row svelte-mh26do"><h3 class="svelte-mh26do"><!> </h3> <button type="button" class="add-policy-btn svelte-mh26do"><!> Nueva Póliza</button></div> <!></section>'),pr=f('<form class="svelte-mh26do"><section class="form-section svelte-mh26do"><h3 class="svelte-mh26do">Información Personal</h3> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="first_name" class="svelte-mh26do">Nombre *</label> <!></div> <div class="form-field svelte-mh26do"><label for="last_name" class="svelte-mh26do">Apellido *</label> <!></div></div> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="document_number" class="svelte-mh26do">DNI/CUIT</label> <!></div> <div class="form-field svelte-mh26do"><label for="birth_date" class="svelte-mh26do">Fecha de Nacimiento</label> <!></div></div></section> <section class="form-section svelte-mh26do"><h3 class="svelte-mh26do">Información de Contacto</h3> <div class="form-field svelte-mh26do"><label for="email_primary" class="svelte-mh26do">Email Principal</label> <!></div> <div class="form-field svelte-mh26do"><label for="email_secondary" class="svelte-mh26do">Email Secundario</label> <!></div> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="phone" class="svelte-mh26do">Celular</label> <div class="phone-input-wrapper svelte-mh26do"><!> <!></div></div> <div class="form-field svelte-mh26do"><label for="phone_landline" class="svelte-mh26do">Teléfono</label> <!></div></div></section> <section class="form-section svelte-mh26do"><h3 class="svelte-mh26do">Dirección</h3> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="street" class="svelte-mh26do">Calle</label> <!></div> <div class="form-field svelte-mh26do"><label for="street_number" class="svelte-mh26do">Número</label> <!></div> <div class="form-field svelte-mh26do"><label for="floor" class="svelte-mh26do">Piso</label> <!></div> <div class="form-field svelte-mh26do"><label for="apartment" class="svelte-mh26do">Depto</label> <!></div></div> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="city" class="svelte-mh26do">Ciudad</label> <!></div> <div class="form-field svelte-mh26do"><label for="province" class="svelte-mh26do">Provincia</label> <!></div> <div class="form-field svelte-mh26do"><label for="postal_code" class="svelte-mh26do">Código Postal</label> <!></div></div></section> <section class="form-section svelte-mh26do"><h3 class="svelte-mh26do">Información Adicional</h3> <div class="form-field svelte-mh26do"><label for="alias_pas" class="svelte-mh26do">Alias PAS</label> <!></div> <div class="form-field svelte-mh26do"><label for="referred_by" class="svelte-mh26do">Referido Por</label> <!></div> <div class="form-field svelte-mh26do"><label for="observations" class="svelte-mh26do">Observaciones</label> <!></div></section>  <!></form>'),mr=f("<!> Guardar Cambios",1),hr=f('<div class="modal-footer svelte-mh26do"><!> <!></div>'),fr=f('<button class="backdrop svelte-mh26do" aria-label="Cerrar modal"></button> <div class="modal-panel svelte-mh26do"><div class="modal-header svelte-mh26do"><div class="header-content svelte-mh26do"><!> <div class="icon-wrapper svelte-mh26do"><!></div> <div class="svelte-mh26do"><h2 class="svelte-mh26do"><!></h2> <!></div></div> <div class="header-actions svelte-mh26do"><!> <button class="icon-btn svelte-mh26do" title="Close"><!></button></div></div> <div class="modal-content svelte-mh26do"><!></div> <!></div>',1);function br(z,s){lt(s,!0);const _=()=>ut(pt,"$page",C),[C,J]=_t();let S=It(s,"mode",3,"view"),o=T(null),B=T(!1),V=T(!1),y=T(S()==="edit"),u=T(Se({first_name:"",last_name:"",document_number:"",birth_date:"",email_primary:"",email_secondary:"",phone:"",phone_landline:"",address:"",street:"",street_number:"",floor:"",apartment:"",postal_code:"",city:"",province:"",alias_pas:"",referred_by:"",observations:""})),x=T(Se({}));vt(()=>{s.clientId&&(i(y,S()==="edit"),H())});async function H(){var M,I,A,re,pe,me,he,ee,se,W,le,ae,oe,xe,ie,ne,ge,ve,fe;if(s.clientId){i(B,!0);try{const Q=await fetch(`/api/clients/${s.clientId}`),de=await Q.json();Q.ok?(i(o,de.client,!0),i(u,{first_name:((M=e(o))==null?void 0:M.first_name)||"",last_name:((I=e(o))==null?void 0:I.last_name)||"",document_number:((A=e(o))==null?void 0:A.document_number)||"",birth_date:((re=e(o))==null?void 0:re.birth_date)||"",email_primary:((pe=e(o))==null?void 0:pe.email_primary)||"",email_secondary:((me=e(o))==null?void 0:me.email_secondary)||"",phone:((he=e(o))==null?void 0:he.phone)||"",phone_landline:((ee=e(o))==null?void 0:ee.phone_landline)||"",address:((se=e(o))==null?void 0:se.address)||"",street:((W=e(o))==null?void 0:W.street)||"",street_number:((le=e(o))==null?void 0:le.street_number)||"",floor:((ae=e(o))==null?void 0:ae.floor)||"",apartment:((oe=e(o))==null?void 0:oe.apartment)||"",postal_code:((xe=e(o))==null?void 0:xe.postal_code)||"",city:((ie=e(o))==null?void 0:ie.city)||"",province:((ne=e(o))==null?void 0:ne.province)||"",alias_pas:((ge=e(o))==null?void 0:ge.alias_pas)||"",referred_by:((ve=e(o))==null?void 0:ve.referred_by)||"",observations:((fe=e(o))==null?void 0:fe.observations)||""},!0)):(ue({type:"error",message:"Error loading client"}),s.onClose())}catch{ue({type:"error",message:"Error loading client"}),s.onClose()}finally{i(B,!1)}}}async function Ge(){if(s.clientId){i(V,!0),i(x,{},!0);try{const M=await fetch(`/api/clients/${s.clientId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e(u))}),I=await M.json();M.ok?(ue({type:"success",message:"Client updated successfully"}),i(y,!1),await H(),s.onClose(!0)):(I.errors&&i(x,I.errors,!0),ue({type:"error",message:I.message||"Error updating client"}))}catch{ue({type:"error",message:"Error updating client"})}finally{i(V,!1)}}}function ze(){i(y,!e(y)),!e(y)&&e(o)&&(i(u,{first_name:e(o).first_name||"",last_name:e(o).last_name||"",document_number:e(o).document_number||"",birth_date:e(o).birth_date||"",email_primary:e(o).email_primary||"",email_secondary:e(o).email_secondary||"",phone:e(o).phone||"",phone_landline:e(o).phone_landline||"",address:e(o).address||"",street:e(o).street||"",street_number:e(o).street_number||"",floor:e(o).floor||"",apartment:e(o).apartment||"",postal_code:e(o).postal_code||"",city:e(o).city||"",province:e(o).province||"",alias_pas:e(o).alias_pas||"",referred_by:e(o).referred_by||"",observations:e(o).observations||""},!0),i(x,{},!0))}function Ne(M){return M?new Date(M).toLocaleDateString("es-ES"):"N/A"}function Ee(M){M.key==="Escape"&&s.onClose()}var E=ra();et("keydown",dt,Ee);var Je=G(E);{var Ve=M=>{var I=fr(),A=G(I);A.__click=[Ht,s];var re=r(A,2),pe=t(re),me=t(pe),he=t(me);{var ee=p=>{var b=Xt();b.__click=[Qt,_,s];var w=t(b);jt(w,{size:20}),a(b),n(p,b)};k(he,p=>{_().url.searchParams.get("from")==="policy"&&p(ee)})}var se=r(he,2),W=t(se);Lt(W,{size:24}),a(se);var le=r(se,2),ae=t(le),oe=t(ae);{var xe=p=>{var b=sa("Cargando...");n(p,b)},ie=p=>{var b=ra(),w=G(b);{var X=D=>{var U=sa();N(()=>$(U,`${e(o).first_name??""} ${e(o).last_name??""}`)),n(D,U)};k(w,D=>{e(o)&&D(X)},!0)}n(p,b)};k(oe,p=>{e(B)?p(xe):p(ie,!1)})}a(ae);var ne=r(ae,2);{var ge=p=>{var b=Yt(),w=t(b,!0);a(b),N(()=>$(w,e(o).email_primary||"No email")),n(p,b)};k(ne,p=>{e(o)&&!e(B)&&p(ge)})}a(le),a(me);var ve=r(me,2),fe=t(ve);{var Q=p=>{var b=Zt();b.__click=ze;var w=t(b);Rt(w,{size:18}),a(b),n(p,b)};k(fe,p=>{!e(y)&&!e(B)&&p(Q)})}var de=r(fe,2);de.__click=[er,s];var Me=t(de);it(Me,{size:20}),a(de),a(ve),a(pe);var Ie=r(pe,2),We=t(Ie);{var De=p=>{var b=ar();n(p,b)},Ke=p=>{var b=ra(),w=G(b);{var X=D=>{var U=pr(),K=t(U),ye=r(t(K),2),ke=t(ye),la=r(t(ke),2);{let v=F(()=>!e(y));q(la,{id:"first_name",get error(){return e(x).first_name},required:!0,get disabled(){return e(v)},get value(){return e(u).first_name},set value(d){e(u).first_name=d}})}a(ke);var be=r(ke,2),Ae=r(t(be),2);{let v=F(()=>!e(y));q(Ae,{id:"last_name",get error(){return e(x).last_name},required:!0,get disabled(){return e(v)},get value(){return e(u).last_name},set value(d){e(u).last_name=d}})}a(be),a(ye);var Le=r(ye,2),oa=t(Le),Ua=r(t(oa),2);{let v=F(()=>!e(y));q(Ua,{id:"document_number",get error(){return e(x).document_number},get disabled(){return e(v)},get value(){return e(u).document_number},set value(d){e(u).document_number=d}})}a(oa);var za=r(oa,2),La=r(t(za),2);{let v=F(()=>!e(y));q(La,{id:"birth_date",type:"date",get error(){return e(x).birth_date},get disabled(){return e(v)},get value(){return e(u).birth_date},set value(d){e(u).birth_date=d}})}a(za),a(Le),a(K);var ia=r(K,2),na=r(t(ia),2),xa=r(t(na),2);{let v=F(()=>!e(y));q(xa,{id:"email_primary",type:"email",get error(){return e(x).email_primary},get disabled(){return e(v)},get value(){return e(u).email_primary},set value(d){e(u).email_primary=d}})}a(na);var va=r(na,2),l=r(t(va),2);{let v=F(()=>!e(y));q(l,{id:"email_secondary",type:"email",get error(){return e(x).email_secondary},get disabled(){return e(v)},get value(){return e(u).email_secondary},set value(d){e(u).email_secondary=d}})}a(va);var m=r(va,2),c=t(m),j=r(t(c),2),Y=t(j);{let v=F(()=>!e(y));Ut(Y,{get error(){return e(x).phone},get disabled(){return e(v)},get value(){return e(u).phone},set value(d){e(u).phone=d}})}var ce=r(Y,2);{var He=v=>{var d=tr(),te=t(d);ht(te,{size:14}),a(d),N(Oe=>at(d,"href",Oe),[()=>ft(e(o).phone)]),n(v,d)};k(ce,v=>{!e(y)&&e(o).phone&&mt(e(o).phone)&&v(He)})}a(j),a(c);var je=r(c,2),ja=r(t(je),2);{let v=F(()=>!e(y));q(ja,{id:"phone_landline",type:"tel",get error(){return e(x).phone_landline},get disabled(){return e(v)},get value(){return e(u).phone_landline},set value(d){e(u).phone_landline=d}})}a(je),a(m),a(ia);var da=r(ia,2),wa=r(t(da),2),Qe=t(wa),Pa=r(t(Qe),2);{let v=F(()=>!e(y));q(Pa,{id:"street",get error(){return e(x).street},get disabled(){return e(v)},placeholder:"Nombre de la calle",get value(){return e(u).street},set value(d){e(u).street=d}})}a(Qe);var ca=r(Qe,2),P=r(t(ca),2);{let v=F(()=>!e(y));q(P,{id:"street_number",get error(){return e(x).street_number},get disabled(){return e(v)},placeholder:"1234",get value(){return e(u).street_number},set value(d){e(u).street_number=d}})}a(ca);var Re=r(ca,2),_a=r(t(Re),2);{let v=F(()=>!e(y));q(_a,{id:"floor",get error(){return e(x).floor},get disabled(){return e(v)},placeholder:"5",get value(){return e(u).floor},set value(d){e(u).floor=d}})}a(Re);var Xe=r(Re,2),Ra=r(t(Xe),2);{let v=F(()=>!e(y));q(Ra,{id:"apartment",get error(){return e(x).apartment},get disabled(){return e(v)},placeholder:"A",get value(){return e(u).apartment},set value(d){e(u).apartment=d}})}a(Xe),a(wa);var Ye=r(wa,2),ua=t(Ye),Ba=r(t(ua),2);{let v=F(()=>!e(y));q(Ba,{id:"city",get error(){return e(x).city},get disabled(){return e(v)},placeholder:"Ciudad",get value(){return e(u).city},set value(d){e(u).city=d}})}a(ua);var pa=r(ua,2),ma=r(t(pa),2);{let v=F(()=>!e(y));q(ma,{id:"province",get error(){return e(x).province},get disabled(){return e(v)},placeholder:"Provincia",get value(){return e(u).province},set value(d){e(u).province=d}})}a(pa);var Sa=r(pa,2),Oa=r(t(Sa),2);{let v=F(()=>!e(y));q(Oa,{id:"postal_code",get error(){return e(x).postal_code},get disabled(){return e(v)},placeholder:"1234",get value(){return e(u).postal_code},set value(d){e(u).postal_code=d}})}a(Sa),a(Ye),a(da);var ha=r(da,2),Be=r(t(ha),2),qa=r(t(Be),2);{let v=F(()=>!e(y));q(qa,{id:"alias_pas",get error(){return e(x).alias_pas},get disabled(){return e(v)},get value(){return e(u).alias_pas},set value(d){e(u).alias_pas=d}})}a(Be);var fa=r(Be,2),Ga=r(t(fa),2);{let v=F(()=>!e(y));q(Ga,{id:"referred_by",get error(){return e(x).referred_by},get disabled(){return e(v)},get value(){return e(u).referred_by},set value(d){e(u).referred_by=d}})}a(fa);var Ze=r(fa,2),Ja=r(t(Ze),2);{var Va=v=>{var d=rr();zt(d),Da(d,()=>e(u).observations,te=>e(u).observations=te),n(v,d)},Wa=v=>{var d=sr(),te=t(d,!0);a(d),N(()=>$(te,e(o).observations||"Sin observaciones")),n(v,d)};k(Ja,v=>{e(y)?v(Va):v(Wa,!1)})}a(Ze),a(ha);var ba=r(ha,2);{var Ka=v=>{var d=ur(),te=t(d),Oe=t(te),ea=t(Oe);rt(ea,{size:20});var Ea=r(ea);a(Oe);var aa=r(Oe,2);aa.__click=[lr,s,o];var Ia=t(aa);tt(Ia,{size:16}),Ce(),a(aa),a(te);var Ha=r(te,2);{var Aa=Z=>{var we=dr();Na(we,21,()=>e(o).policies,Ma,(Fe,O)=>{var h=vr();h.__click=[or,s,O,o];var g=t(h),R=t(g),_e=t(R),Qa=t(_e,!0);a(_e);var ga=r(_e,2);let Ta;var ya=t(ga,!0);a(ga),a(R);var Te=r(R,2),ka=t(Te),Xa=t(ka,!0);a(ka);var bt=r(ka,2);{var gt=Pe=>{var ta=ir(),$a=r(G(ta),2),Ya=t($a,!0);a($a),N(()=>$(Ya,e(O).insurer)),n(Pe,ta)};k(bt,Pe=>{e(O).insurer&&Pe(gt)})}a(Te);var yt=r(Te,2);{var kt=Pe=>{var ta=nr(),$a=t(ta);a(ta),N(Ya=>$($a,`Vence: ${Ya??""}`),[()=>Ne(e(O).renewal_date)]),n(Pe,ta)};k(yt,Pe=>{e(O).renewal_date&&Pe(kt)})}a(g),Ce(2),a(h),N(Pe=>{$(Qa,e(O).policy_number||"S/N"),Ta=ct(ga,1,"policy-status svelte-mh26do",null,Ta,Pe),$(ya,e(O).status==="active"?"Activa":"Inactiva"),$(Xa,e(O).policy_type)},[()=>({active:e(O).status,inactive:!e(O).status})]),n(Fe,h)}),a(we),n(Z,we)},Fa=Z=>{var we=_r(),Fe=t(we);rt(Fe,{size:32});var O=r(Fe,4);O.__click=[cr,s,o];var h=t(O);tt(h,{size:16}),Ce(),a(O),a(we),n(Z,we)};k(Ha,Z=>{e(o).policies&&e(o).policies.length>0?Z(Aa):Z(Fa,!1)})}a(d),N(()=>{var Z;return $(Ea,` Pólizas (${(((Z=e(o).policies)==null?void 0:Z.length)||0)??""})`)}),n(v,d)};k(ba,v=>{!e(y)&&!_().url.searchParams.get("from")&&v(Ka)})}a(U),et("submit",U,v=>{v.preventDefault(),Ge()}),n(D,U)};k(w,D=>{e(o)&&D(X)},!0)}n(p,b)};k(We,p=>{e(B)?p(De):p(Ke,!1)})}a(Ie);var Ue=r(Ie,2);{var L=p=>{var b=hr(),w=t(b);Ca(w,{variant:"ghost",onclick:ze,get disabled(){return e(V)},children:(D,U)=>{Ce();var K=sa("Cancelar");n(D,K)},$$slots:{default:!0}});var X=r(w,2);Ca(X,{variant:"primary",onclick:Ge,get disabled(){return e(V)},children:(D,U)=>{var K=ra(),ye=G(K);{var ke=be=>{var Ae=sa("Guardando...");n(be,Ae)},la=be=>{var Ae=mr(),Le=G(Ae);qt(Le,{size:18}),Ce(),n(be,Ae)};k(ye,be=>{e(V)?be(ke):be(la,!1)})}n(D,K)},$$slots:{default:!0}}),a(b),n(p,b)};k(Ue,p=>{e(y)&&!e(B)&&p(L)})}a(re),n(M,I)};k(Je,M=>{s.clientId&&M(Ve)})}n(z,E),ot(),J()}st(["click"]);var gr=(z,s,_)=>s(e(_)),yr=f('<label class="checkbox-item svelte-eza58y"><input type="checkbox" class="svelte-eza58y"/> <span class="svelte-eza58y"> </span></label>'),kr=(z,s)=>i(s,e(s)===!0?void 0:!0,!0),Cr=(z,s)=>i(s,e(s)===!0?void 0:!0,!0),zr=f("<!> Aplicar <!>",1),xr=f('<button class="backdrop svelte-eza58y" aria-label="Close filter panel"></button> <div class="filter-panel svelte-eza58y"><div class="filter-header svelte-eza58y"><h3 class="svelte-eza58y">Filtros</h3> <button class="close-btn svelte-eza58y"><!></button></div> <div class="filter-content svelte-eza58y"><div class="filter-section svelte-eza58y"><h4 class="svelte-eza58y">Ciudad</h4> <div class="checkbox-list svelte-eza58y"></div></div> <div class="filter-section svelte-eza58y"><h4 class="svelte-eza58y">Información de Contacto</h4> <div class="checkbox-list svelte-eza58y"><label class="checkbox-item svelte-eza58y"><input type="checkbox" class="svelte-eza58y"/> <span class="svelte-eza58y">Con email</span></label> <label class="checkbox-item svelte-eza58y"><input type="checkbox" class="svelte-eza58y"/> <span class="svelte-eza58y">Con teléfono</span></label></div></div> <div class="filter-section svelte-eza58y"><h4 class="svelte-eza58y">Fecha de Creación</h4> <div class="date-inputs svelte-eza58y"><div class="input-group svelte-eza58y"><label for="date-from" class="svelte-eza58y">Desde</label> <input id="date-from" type="date" class="svelte-eza58y"/></div> <div class="input-group svelte-eza58y"><label for="date-to" class="svelte-eza58y">Hasta</label> <input id="date-to" type="date" class="svelte-eza58y"/></div></div></div></div> <div class="filter-footer svelte-eza58y"><!> <!></div></div>',1);function wr(z,s){var E,Je,Ve,M,I;lt(s,!0);const _={cities:[]};let C=T(Se(((E=s.initialFilters)==null?void 0:E.cities)||_.cities)),J=T(Se((Je=s.initialFilters)==null?void 0:Je.hasEmail)),S=T(Se((Ve=s.initialFilters)==null?void 0:Ve.hasPhone)),o=T(Se(((M=s.initialFilters)==null?void 0:M.dateFrom)||"")),B=T(Se(((I=s.initialFilters)==null?void 0:I.dateTo)||""));const V=["Buenos Aires","Córdoba","Rosario","Mendoza","San Miguel de Tucumán","La Plata","Mar del Plata","Salta","Santa Fe","San Juan","Resistencia","Santiago del Estero","Corrientes","Posadas","San Salvador de Jujuy"];function y(A){e(C).includes(A)?i(C,e(C).filter(re=>re!==A),!0):i(C,[...e(C),A],!0)}function u(){i(C,[],!0),i(J,void 0),i(S,void 0),i(o,""),i(B,"")}function x(){s.onApply({cities:e(C),hasEmail:e(J),hasPhone:e(S),dateFrom:e(o),dateTo:e(B)}),s.onClose()}const H=F(()=>()=>{let A=e(C).length;return e(J)!==void 0&&A++,e(S)!==void 0&&A++,e(o)&&A++,e(B)&&A++,A});function Ge(A){A.key==="Escape"&&s.onClose()}var ze=ra();et("keydown",dt,Ge);var Ne=G(ze);{var Ee=A=>{var re=xr(),pe=G(re);pe.__click=function(...L){var p;(p=s.onClose)==null||p.apply(this,L)};var me=r(pe,2),he=t(me),ee=r(t(he),2);ee.__click=function(...L){var p;(p=s.onClose)==null||p.apply(this,L)};var se=t(ee);it(se,{size:20}),a(ee),a(he);var W=r(he,2),le=t(W),ae=r(t(le),2);Na(ae,21,()=>V,Ma,(L,p)=>{var b=yr(),w=t(b);qe(w),w.__change=[gr,y,p];var X=r(w,2),D=t(X,!0);a(X),a(b),N(U=>{Za(w,U),$(D,e(p))},[()=>e(C).includes(e(p))]),n(L,b)}),a(ae),a(le);var oe=r(le,2),xe=r(t(oe),2),ie=t(xe),ne=t(ie);qe(ne),ne.__change=[kr,J],Ce(2),a(ie);var ge=r(ie,2),ve=t(ge);qe(ve),ve.__change=[Cr,S],Ce(2),a(ge),a(xe),a(oe);var fe=r(oe,2),Q=r(t(fe),2),de=t(Q),Me=r(t(de),2);qe(Me),a(de);var Ie=r(de,2),We=r(t(Ie),2);qe(We),a(Ie),a(Q),a(fe),a(W);var De=r(W,2),Ke=t(De);Ca(Ke,{variant:"ghost",size:"sm",onclick:u,children:(L,p)=>{Ce();var b=sa("Limpiar todo");n(L,b)},$$slots:{default:!0}});var Ue=r(Ke,2);Ca(Ue,{variant:"primary",onclick:x,children:(L,p)=>{var b=zr(),w=G(b);Bt(w,{size:18});var X=r(w,2);{var D=U=>{var K=sa();N(ye=>$(K,`(${ye??""})`),[()=>e(H)()]),n(U,K)};k(X,U=>{e(H)()>0&&U(D)})}n(L,b)},$$slots:{default:!0}}),a(De),a(me),N(()=>{Za(ne,e(J)===!0),Za(ve,e(S)===!0)}),Da(Me,()=>e(o),L=>i(o,L)),Da(We,()=>e(B),L=>i(B,L)),n(A,re)};k(Ne,A=>{s.open&&A(Ee)})}n(z,ze),ot()}st(["click","change"]);function Pr(z,s,_,C,J){i(s,e(s)==="asc"?"desc":"asc",!0),i(_,1),i(C,[],!0),J()}function Sr(z,s,_,C,J){i(s,{cities:[],hasEmail:void 0,hasPhone:void 0,dateFrom:"",dateTo:""},!0),i(_,1),i(C,[],!0),J()}var Er=f("<!> Nuevo Cliente",1),Ir=(z,s)=>i(s,!e(s)),Ar=f('<span class="filter-badge svelte-1hp9571"> </span>'),Fr=f('<button class="clear-filters-btn svelte-1hp9571" title="Limpiar filtros"><!></button>'),Tr=(z,s,_,C,J)=>{localStorage.setItem("clients_show_inactive",e(s).toString()),i(_,1),i(C,[],!0),J()},$r=(z,s,_,C)=>{i(s,1),i(_,[],!0),C()},Nr=f('<span class="count-skeleton svelte-1hp9571"></span>'),Mr=f('<span class="count-text svelte-1hp9571"> </span> <span class="count-separator svelte-1hp9571">/</span> <span class="count-total svelte-1hp9571"> </span>',1),Dr=f('<div class="skeleton-list svelte-1hp9571"></div>'),Ur=(z,s,_)=>s(`${e(_).first_name} ${e(_).last_name}`,"Nombre"),Lr=(z,s,_)=>s(e(_).document_number,"DNI/CUIT"),jr=f('<button class="copyable-btn id-cell svelte-1hp9571" title="Click para copiar DNI/CUIT"> </button>'),Rr=f('<span class="text-muted svelte-1hp9571">-</span>'),Br=(z,s,_)=>s(e(_).email_primary,"Email"),Or=f('<button class="copyable-btn email svelte-1hp9571" title="Click para copiar"><!> </button>'),qr=f('<span class="text-muted svelte-1hp9571">-</span>'),Gr=(z,s,_)=>s(e(_).phone,"Celular"),Jr=f('<a target="_blank" rel="noopener noreferrer" class="whatsapp-btn svelte-1hp9571" title="Abrir en WhatsApp"><!></a>'),Vr=f('<div class="phone-cell svelte-1hp9571"><button class="copyable-btn phone svelte-1hp9571" title="Click para copiar"><!> </button> <!></div>'),Wr=f('<span class="text-muted svelte-1hp9571">-</span>'),Kr=(z,s,_)=>s(e(_).phone_landline,"Teléfono"),Hr=f('<button class="copyable-btn phone svelte-1hp9571" title="Click para copiar"><!> </button>'),Qr=f('<span class="text-muted svelte-1hp9571">-</span>'),Xr=(z,s,_,C)=>s(_(e(C)),"Dirección"),Yr=f('<button class="copyable-btn address-cell svelte-1hp9571" title="Click para copiar"> </button>'),Zr=f('<span class="text-muted svelte-1hp9571">-</span>'),es=(z,s,_)=>s(e(_).id,"view"),as=(z,s,_)=>s(e(_).id,e(_).first_name,e(_).last_name),ts=f('<tr class="svelte-1hp9571"><td class="svelte-1hp9571"><button class="copyable-btn name-cell svelte-1hp9571" title="Click para copiar nombre"> </button></td><td class="svelte-1hp9571"><!></td><td class="svelte-1hp9571"><!></td><td class="svelte-1hp9571"><!></td><td class="svelte-1hp9571"><!></td><td class="svelte-1hp9571"><!></td><td class="text-nowrap svelte-1hp9571"> </td><td class="text-center svelte-1hp9571"><div class="policies-count svelte-1hp9571"><!> <span class="svelte-1hp9571"> </span></div></td><td class="text-right svelte-1hp9571"><div class="actions svelte-1hp9571"><button class="action-btn view-btn svelte-1hp9571" title="Ver detalles"><!></button> <button class="action-btn danger svelte-1hp9571" title="Eliminar"><!></button></div></td></tr>'),rs=f('<thead class="svelte-1hp9571"><tr class="svelte-1hp9571"><th class="svelte-1hp9571">Nombre</th><th class="svelte-1hp9571">DNI/CUIT</th><th class="svelte-1hp9571">Email</th><th class="svelte-1hp9571">Celular</th><th class="svelte-1hp9571">Teléfono</th><th class="svelte-1hp9571">Domicilio</th><th class="svelte-1hp9571">Creado</th><th class="text-center svelte-1hp9571">Pólizas</th><th class="text-right svelte-1hp9571">Acciones</th></tr></thead> <tbody class="svelte-1hp9571"></tbody>',1),ss=f("<!> <!>",1),ls=f('<div class="page svelte-1hp9571"><div class="page-header svelte-1hp9571"><div class="svelte-1hp9571"><h1 class="svelte-1hp9571">Clientes</h1> <p class="svelte-1hp9571">Gestiona tus clientes y su información</p></div> <!></div> <div class="filters-toolbar svelte-1hp9571"><div class="search-box svelte-1hp9571"><!> <input type="text" placeholder="Buscar clientes..." class="svelte-1hp9571"/></div> <div class="toolbar-actions svelte-1hp9571"><button title="Filtros"><!> <!></button> <!> <div class="filter-checkbox svelte-1hp9571"><label class="checkbox-label svelte-1hp9571"><input type="checkbox" class="svelte-1hp9571"/> <span class="svelte-1hp9571">Mostrar inactivos</span></label></div> <div class="sort-select svelte-1hp9571"><label for="sort-by" class="svelte-1hp9571">Ordenar por:</label> <select id="sort-by" class="svelte-1hp9571"><option class="svelte-1hp9571">Nombre</option><option class="svelte-1hp9571">Apellido</option><option class="svelte-1hp9571">Cantidad de pólizas</option><option class="svelte-1hp9571">Fecha creación</option><option class="svelte-1hp9571">Última actualización</option></select> <button class="sort-order-btn svelte-1hp9571"><!></button></div> <div class="results-count svelte-1hp9571"><!></div></div></div> <!></div> <!> <!>',1);function Ns(z,s){lt(s,!0);const _=()=>ut(pt,"$page",C),[C,J]=_t();let S=T(Se([])),o=T(!0),B=T(!1),V=T(""),y=T(!1),u=T("first_name"),x=T("asc"),H=T(1),Ge=30,ze=T(0),Ne=T(!0),Ee=T(!1),E=T(Se({cities:[],hasEmail:void 0,hasPhone:void 0,dateFrom:"",dateTo:""})),Je=F(()=>_().url.searchParams.get("clientId")),Ve=F(()=>_().url.searchParams.get("mode")||"view");Ct(()=>{const l=localStorage.getItem("clients_show_inactive");l!==null&&i(y,l==="true"),I()});const M=Gt(()=>{i(H,1),i(S,[],!0),I()},300);vt(()=>{e(V)!==void 0&&M()});async function I(l=!1){var m;l?i(B,!0):i(o,!0);try{const c=new URLSearchParams({page:e(H).toString(),limit:Ge.toString()});e(V)&&c.append("search",e(V)),e(y)||c.append("active_only","true"),c.append("sort_by",e(u)),c.append("sort_order",e(x)),e(E).cities.forEach(ce=>{c.append("city",ce)}),e(E).hasEmail!==void 0&&c.append("has_email",e(E).hasEmail.toString()),e(E).hasPhone!==void 0&&c.append("has_phone",e(E).hasPhone.toString()),e(E).dateFrom&&c.append("date_from",e(E).dateFrom),e(E).dateTo&&c.append("date_to",e(E).dateTo);const j=await fetch(`/api/clients?${c}`),Y=await j.json();j.ok?(l?i(S,[...e(S),...Y.clients||[]],!0):i(S,Y.clients||[],!0),i(ze,((m=Y.pagination)==null?void 0:m.total)||0,!0),i(Ne,e(S).length<e(ze))):(ue({type:"error",message:Y.message||"Error al cargar clientes"}),i(S,[],!0))}catch(c){console.error("Error loading clients:",c),ue({type:"error",message:"Error al cargar clientes"}),i(S,[],!0)}finally{i(o,!1),i(B,!1)}}function A(){!e(o)&&!e(B)&&e(Ne)&&(Pt(H),I(!0))}async function re(l,m,c){if(confirm(`¿Seguro que deseas eliminar a ${m} ${c}?`))try{const j=await fetch(`/api/clients/${l}`,{method:"DELETE"});if(j.ok)ue({type:"success",message:"Cliente eliminado"}),I();else{const Y=await j.json();ue({type:"error",message:Y.message})}}catch{ue({type:"error",message:"Error al eliminar"})}}function pe(l,m="view"){const c=new URL(window.location.href);c.searchParams.set("clientId",l),c.searchParams.set("mode",m),$e(c.pathname+c.search,{replaceState:!1,noScroll:!0})}function me(l){const m=new URL(window.location.href);m.searchParams.delete("clientId"),m.searchParams.delete("mode"),$e(m.pathname+m.search,{replaceState:!1,noScroll:!0}),l&&I()}function he(l){i(E,l,!0),i(H,1),i(S,[],!0),I()}const ee=F(()=>()=>{let l=e(E).cities.length;return e(E).hasEmail!==void 0&&l++,e(E).hasPhone!==void 0&&l++,e(E).dateFrom&&l++,e(E).dateTo&&l++,l});function se(l){const m=[],c=[];return l.street&&c.push(l.street),l.street_number&&c.push(l.street_number),l.floor&&c.push(`Piso ${l.floor}`),l.apartment&&c.push(`Depto ${l.apartment}`),c.length>0&&m.push(c.join(" ")),l.city&&m.push(l.city),l.province&&m.push(l.province),l.postal_code&&m.push(`(CP ${l.postal_code})`),m.length>0?m.join(", "):"-"}async function W(l,m){try{await navigator.clipboard.writeText(l),ue({type:"success",message:`${m} copiado al portapapeles`})}catch{ue({type:"error",message:"Error al copiar"})}}var le=ls();xt(l=>{wt.title="Clientes - PAS Manager"});var ae=G(le),oe=t(ae),xe=r(t(oe),2);Ca(xe,{variant:"primary",onclick:()=>$e("/clientes/nuevo"),children:(l,m)=>{var c=Er(),j=G(c);tt(j,{size:18}),Ce(),n(l,c)},$$slots:{default:!0}}),a(oe);var ie=r(oe,2),ne=t(ie),ge=t(ne);Jt(ge,{size:20});var ve=r(ge,2);qe(ve),a(ne);var fe=r(ne,2),Q=t(fe);let de;Q.__click=[Ir,Ee];var Me=t(Q);Tt(Me,{size:18});var Ie=r(Me,2);{var We=l=>{var m=Ar(),c=t(m,!0);a(m),N(j=>$(c,j),[()=>e(ee)()]),n(l,m)};k(Ie,l=>{e(ee)()>0&&l(We)})}a(Q);var De=r(Q,2);{var Ke=l=>{var m=Fr();m.__click=[Sr,E,H,S,I];var c=t(m);it(c,{size:18}),a(m),n(l,m)};k(De,l=>{e(ee)()>0&&l(Ke)})}var Ue=r(De,2),L=t(Ue),p=t(L);qe(p),p.__change=[Tr,y,H,S,I],Ce(2),a(L),a(Ue);var b=r(Ue,2),w=r(t(b),2);w.__change=[$r,H,S,I];var X=t(w);X.value=X.__value="first_name";var D=r(X);D.value=D.__value="last_name";var U=r(D);U.value=U.__value="policy_count";var K=r(U);K.value=K.__value="created_at";var ye=r(K);ye.value=ye.__value="updated_at",a(w);var ke=r(w,2);ke.__click=[Pr,x,H,S,I];var la=t(ke);{var be=l=>{$t(l,{size:16})},Ae=l=>{Nt(l,{size:16})};k(la,l=>{e(x)==="asc"?l(be):l(Ae,!1)})}a(ke),a(b);var Le=r(b,2),oa=t(Le);{var Ua=l=>{var m=Nr();n(l,m)},za=l=>{var m=Mr(),c=G(m),j=t(c,!0);a(c);var Y=r(c,4),ce=t(Y,!0);a(Y),N(()=>{$(j,e(S).length),$(ce,e(ze))}),n(l,m)};k(oa,l=>{e(o)&&e(S).length===0?l(Ua):l(za,!1)})}a(Le),a(fe),a(ie);var La=r(ie,2);{var ia=l=>{var m=Dr();Na(m,20,()=>Array(5),Ma,(c,j)=>{Mt(c,{height:"60px"})}),a(m),n(l,m)},na=l=>{var m=ra(),c=G(m);{var j=ce=>{{let He=F(()=>e(V)?"No se encontraron resultados":"Comienza agregando tu primer cliente"),je=F(()=>e(V)?void 0:{label:"Nuevo Cliente",onclick:()=>$e("/clientes/nuevo")});Ft(ce,{get icon(){return Vt},title:"No hay clientes",get description(){return e(He)},get action(){return e(je)}})}},Y=ce=>{var He=ss(),je=G(He);At(je,{children:(da,wa)=>{var Qe=rs(),Pa=r(G(Qe),2);Na(Pa,21,()=>e(S),Ma,(ca,P)=>{var Re=ts(),_a=t(Re),Xe=t(_a);Xe.__click=[Ur,W,P];var Ra=t(Xe);a(Xe),a(_a);var Ye=r(_a),ua=t(Ye);{var Ba=h=>{var g=jr();g.__click=[Lr,W,P];var R=t(g,!0);a(g),N(()=>$(R,e(P).document_number)),n(h,g)},pa=h=>{var g=Rr();n(h,g)};k(ua,h=>{e(P).document_number?h(Ba):h(pa,!1)})}a(Ye);var ma=r(Ye),Sa=t(ma);{var Oa=h=>{var g=Or();g.__click=[Br,W,P];var R=t(g);Kt(R,{size:14});var _e=r(R);a(g),N(()=>$(_e,` ${e(P).email_primary??""}`)),n(h,g)},ha=h=>{var g=qr();n(h,g)};k(Sa,h=>{e(P).email_primary?h(Oa):h(ha,!1)})}a(ma);var Be=r(ma),qa=t(Be);{var fa=h=>{var g=Vr(),R=t(g);R.__click=[Gr,W,P];var _e=t(R);nt(_e,{size:14});var Qa=r(_e);a(R);var ga=r(R,2);{var Ta=ya=>{var Te=Jr(),ka=t(Te);ht(ka,{size:20,fill:"#25d36690"}),a(Te),N(Xa=>at(Te,"href",Xa),[()=>ft(e(P).phone)]),n(ya,Te)};k(ga,ya=>{mt(e(P).phone)&&ya(Ta)})}a(g),N(()=>$(Qa,` ${e(P).phone??""}`)),n(h,g)},Ga=h=>{var g=Wr();n(h,g)};k(qa,h=>{e(P).phone?h(fa):h(Ga,!1)})}a(Be);var Ze=r(Be),Ja=t(Ze);{var Va=h=>{var g=Hr();g.__click=[Kr,W,P];var R=t(g);nt(R,{size:14});var _e=r(R);a(g),N(()=>$(_e,` ${e(P).phone_landline??""}`)),n(h,g)},Wa=h=>{var g=Qr();n(h,g)};k(Ja,h=>{e(P).phone_landline?h(Va):h(Wa,!1)})}a(Ze);var ba=r(Ze),Ka=t(ba);{var v=h=>{var g=Yr();g.__click=[Xr,W,se,P];var R=t(g,!0);a(g),N(_e=>$(R,_e),[()=>se(e(P))]),n(h,g)},d=h=>{var g=Zr();n(h,g)};k(Ka,h=>{se(e(P))!=="-"?h(v):h(d,!1)})}a(ba);var te=r(ba),Oe=t(te,!0);a(te);var ea=r(te),Ea=t(ea),aa=t(Ea);rt(aa,{size:14});var Ia=r(aa,2),Ha=t(Ia,!0);a(Ia),a(Ea),a(ea);var Aa=r(ea),Fa=t(Aa),Z=t(Fa);Z.__click=[es,pe,P];var we=t(Z);Wt(we,{size:16}),a(Z);var Fe=r(Z,2);Fe.__click=[as,re,P];var O=t(Fe);Ot(O,{size:16}),a(Fe),a(Fa),a(Aa),a(Re),N(h=>{$(Ra,`${e(P).first_name??""}
                ${e(P).last_name??""}`),$(Oe,h),$(Ha,e(P).active_policies_count||0)},[()=>new Date(e(P).created_at).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})]),n(ca,Re)}),a(Pa),n(da,Qe)},$$slots:{default:!0}});var ja=r(je,2);Dt(ja,{get hasMore(){return e(Ne)},onLoadMore:A}),n(ce,He)};k(c,ce=>{e(S).length===0?ce(j):ce(Y,!1)},!0)}n(l,m)};k(La,l=>{e(o)?l(ia):l(na,!1)})}a(ae);var xa=r(ae,2);br(xa,{get clientId(){return e(Je)},get mode(){return e(Ve)},onClose:me});var va=r(xa,2);wr(va,{get open(){return e(Ee)},onClose:()=>i(Ee,!1),onApply:he,get initialFilters(){return e(E)}}),N(l=>{de=ct(Q,1,"filter-btn svelte-1hp9571",null,de,l),at(ke,"title",e(x)==="asc"?"Ascendente":"Descendente")},[()=>({active:e(Ee)||e(ee)()>0})]),Da(ve,()=>e(V),l=>i(V,l)),Et(p,()=>e(y),l=>i(y,l)),St(w,()=>e(u),l=>i(u,l)),n(z,le),ot(),J()}st(["click","change"]);export{Ns as component};
