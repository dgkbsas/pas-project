import"../chunks/CWj6FrbW.js";import{c as fa,o as ja}from"../chunks/P-h-QmmT.js";import{c as ke,f as G,a as i,af as Mt,a6 as Qe,N as c,Q as a,T as t,P as l,ae as Ce,aD as Ge,ag as I,ah as w,a2 as e,ad as ve,aa as Ze,a7 as L,a8 as Ee,aE as Ft,bm as ia,ac as o,aF as ra,O as Ia,R as Fa,o as la,a9 as Ma,ab as Aa,ay as Da}from"../chunks/DXalFYC5.js";import{i as z}from"../chunks/DgS_HarA.js";import{e as je,r as yt,c as Lt,i as Ie,a as da,C as ua,b as Vt,s as $a}from"../chunks/CCesXY4h.js";import{s as sa}from"../chunks/CiAFSiaO.js";import{b as Bt,a as Na}from"../chunks/Bf-8v-H5.js";import{l as ma,s as ya,p as Oe,r as Oa,a as ga,b as ha}from"../chunks/BkTacmYQ.js";import{g as it}from"../chunks/DboXdvGe.js";import{p as ba}from"../chunks/MzzRNa-k.js";import{B as Le}from"../chunks/ey38HHQe.js";import{P as xa,T as La}from"../chunks/BE3yFpjr.js";import{E as wa}from"../chunks/BjdX1nSD.js";import{F as Va,A as Ba,a as Ra,S as Ua,I as qa}from"../chunks/DbJVzCiZ.js";import{S as Ga}from"../chunks/CUzdHB_b.js";import{B as oa,C as na}from"../chunks/BQnzrsda.js";import{U as va}from"../chunks/DGbCUdBR.js";import{E as ka}from"../chunks/BM1HQ7Uf.js";import{T as za,C as Ha,P as Ja}from"../chunks/CSUxE8_x.js";import{X as Ut}from"../chunks/C90WgwIi.js";import{I as qe}from"../chunks/DYUOFKwE.js";import{S as Ka,T as Xa}from"../chunks/CsaozLtE.js";import{F as Rt}from"../chunks/B2p_ebVs.js";import"../chunks/D3fhBnoc.js";import{I as Sa,s as Pa}from"../chunks/Wd1UXAwi.js";import{b as _a}from"../chunks/BjGM86Mo.js";import{t as pa,s as Qa,f as Za}from"../chunks/CXQWPrWa.js";import{q as Wa}from"../chunks/iVSWiVfi.js";import{S as Ea}from"../chunks/-aJssGs5.js";import{s as Ne}from"../chunks/ejPKeNiZ.js";import{A as Ya}from"../chunks/CNwQjRCr.js";import{d as er,S as tr}from"../chunks/DUFLD2a0.js";function Ca(S,r){const u=ma(r,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.545.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const _=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326"}]];Sa(S,ya({name:"bell"},()=>u,{get iconNode(){return _},children:(T,d)=>{var n=ke(),O=G(n);Pa(O,r,"default",{}),i(T,n)},$$slots:{default:!0}}))}function ar(S,r){const u=ma(r,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.545.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const _=[["path",{d:"M10 11v6"}],["path",{d:"M14 11v6"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];Sa(S,ya({name:"trash-2"},()=>u,{get iconNode(){return _},children:(T,d)=>{var n=ke(),O=G(n);Pa(O,r,"default",{}),i(T,n)},$$slots:{default:!0}}))}var rr=c('<span class="expiry-badge svelte-1jbgj2g"> </span>'),lr=(S,r)=>r.onView(r.policy.id),sr=(S,r)=>r.onDelete(r.policy.id,r.policy.policy_number||"esta póliza"),ir=c('<div class="policy-card svelte-1jbgj2g"><div class="card-header svelte-1jbgj2g"><span class="card-number svelte-1jbgj2g"> </span> <!></div> <div class="card-body svelte-1jbgj2g"><div class="policy-number svelte-1jbgj2g"> </div> <div class="policy-type svelte-1jbgj2g"> </div> <div class="card-info svelte-1jbgj2g"><div class="info-item svelte-1jbgj2g"><!> <span> </span></div> <div class="info-item svelte-1jbgj2g"><!> <span> </span> <!></div></div></div> <div class="card-actions svelte-1jbgj2g"><button class="action-btn svelte-1jbgj2g" title="Ver"><!></button> <button class="action-btn danger svelte-1jbgj2g" title="Eliminar"><!></button></div></div>');function or(S,r){Qe(r,!0);function u(J,g){return J?new Date(g)<new Date?{variant:"warning",label:"Vencida"}:{variant:"success",label:"Activa"}:{variant:"error",label:"Inactiva"}}function _(J){const g=new Date,E=new Date(J);return Math.ceil((E.getTime()-g.getTime())/(1e3*60*60*24))}function T(J){return new Date(J).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}const d=ve(()=>u(r.policy.active,r.policy.expiry_date)),n=ve(()=>_(r.policy.expiry_date)),O=ve(()=>r.policy.client?`${r.policy.client.first_name} ${r.policy.client.last_name}`:"Cliente no disponible");var K=ir(),k=a(K),U=a(k),N=a(U);t(U);var F=l(U,2);oa(F,{get variant(){return e(d).variant},children:(J,g)=>{Ce();var E=Ge();I(()=>w(E,e(d).label)),i(J,E)},$$slots:{default:!0}}),t(k);var X=l(k,2),B=a(X),Q=a(B,!0);t(B);var m=l(B,2),f=a(m,!0);t(m);var v=l(m,2),y=a(v),H=a(y);va(H,{size:14});var Y=l(H,2),q=a(Y,!0);t(Y),t(y);var le=l(y,2),D=a(le);na(D,{size:14});var se=l(D,2),M=a(se,!0);t(se);var te=l(se,2);{var ie=J=>{var g=rr(),E=a(g);t(g),I(()=>w(E,`${e(n)??""}d`)),i(J,g)};z(te,J=>{e(n)<=30&&e(n)>0&&J(ie)})}t(le),t(v),t(X);var xe=l(X,2),ue=a(xe);ue.__click=[lr,r];var me=a(ue);ka(me,{size:16}),t(ue);var ye=l(ue,2);ye.__click=[sr,r];var ge=a(ye);za(ge,{size:16}),t(ye),t(xe),t(K),I(J=>{w(N,`#${r.index+1}`),w(Q,r.policy.policy_number||"S/N"),w(f,r.policy.policy_type),w(q,e(O)),w(M,J)},[()=>T(r.policy.expiry_date)]),i(S,K),Ze()}Mt(["click"]);var nr=(S,r,u)=>r(e(u).value),vr=c('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),cr=(S,r,u)=>r(e(u).value),dr=c('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),ur=(S,r,u)=>r(e(u)),_r=c('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),pr=(S,r,u)=>r(e(u).value),fr=c('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),mr=c("<!> Aplicar <!>",1),yr=c('<button class="backdrop svelte-1cif4vt" aria-label="Close filter panel"></button> <div class="filter-panel svelte-1cif4vt"><div class="filter-header svelte-1cif4vt"><h3 class="svelte-1cif4vt">Filtros</h3> <button class="close-btn svelte-1cif4vt"><!></button></div> <div class="filter-content svelte-1cif4vt"><div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Tipo de Póliza</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Forma de Pago</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Aseguradora</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Estado</h4> <div class="checkbox-list svelte-1cif4vt"></div></div></div> <div class="filter-footer svelte-1cif4vt"><!> <!></div></div>',1);function gr(S,r){var q,le,D,se;Qe(r,!0);const u={policyTypes:[],paymentModes:[],insurers:[],statuses:[]};let _=L(Ee(((q=r.initialFilters)==null?void 0:q.policyTypes)||u.policyTypes)),T=L(Ee(((le=r.initialFilters)==null?void 0:le.paymentModes)||u.paymentModes)),d=L(Ee(((D=r.initialFilters)==null?void 0:D.insurers)||u.insurers)),n=L(Ee(((se=r.initialFilters)==null?void 0:se.statuses)||u.statuses));const O=[{value:"auto",label:"Auto"},{value:"home",label:"Hogar"},{value:"life",label:"Vida"},{value:"health",label:"Salud"},{value:"business",label:"Empresa"},{value:"other",label:"Otro"}],K=[{value:"monthly",label:"Mensual"},{value:"quarterly",label:"Trimestral"},{value:"semi-annual",label:"Semestral"},{value:"annual",label:"Anual"}],k=[{value:"active",label:"Activa"},{value:"inactive",label:"Inactiva"},{value:"expiring_soon",label:"Por vencer"},{value:"expired",label:"Vencida"}],U=["Mapfre","AXA","Allianz","Generali","Zurich"];function N(M){e(_).includes(M)?o(_,e(_).filter(te=>te!==M),!0):o(_,[...e(_),M],!0)}function F(M){e(T).includes(M)?o(T,e(T).filter(te=>te!==M),!0):o(T,[...e(T),M],!0)}function X(M){e(d).includes(M)?o(d,e(d).filter(te=>te!==M),!0):o(d,[...e(d),M],!0)}function B(M){e(n).includes(M)?o(n,e(n).filter(te=>te!==M),!0):o(n,[...e(n),M],!0)}function Q(){o(_,[],!0),o(T,[],!0),o(d,[],!0),o(n,[],!0)}function m(){r.onApply({policyTypes:e(_),paymentModes:e(T),insurers:e(d),statuses:e(n)}),r.onClose()}const f=ve(()=>()=>e(_).length+e(T).length+e(d).length+e(n).length);function v(M){M.key==="Escape"&&r.onClose()}var y=ke();Ft("keydown",ia,v);var H=G(y);{var Y=M=>{var te=yr(),ie=G(te);ie.__click=function(...h){var b;(b=r.onClose)==null||b.apply(this,h)};var xe=l(ie,2),ue=a(xe),me=l(a(ue),2);me.__click=function(...h){var b;(b=r.onClose)==null||b.apply(this,h)};var ye=a(me);Ut(ye,{size:20}),t(me),t(ue);var ge=l(ue,2),J=a(ge),g=l(a(J),2);je(g,21,()=>O,Ie,(h,b)=>{var $=vr(),V=a($);yt(V),V.__change=[nr,N,b];var re=l(V,2),be=a(re,!0);t(re),t($),I(ce=>{Lt(V,ce),w(be,e(b).label)},[()=>e(_).includes(e(b).value)]),i(h,$)}),t(g),t(J);var E=l(J,2),_e=l(a(E),2);je(_e,21,()=>K,Ie,(h,b)=>{var $=dr(),V=a($);yt(V),V.__change=[cr,F,b];var re=l(V,2),be=a(re,!0);t(re),t($),I(ce=>{Lt(V,ce),w(be,e(b).label)},[()=>e(T).includes(e(b).value)]),i(h,$)}),t(_e),t(E);var j=l(E,2),ae=l(a(j),2);je(ae,21,()=>U,Ie,(h,b)=>{var $=_r(),V=a($);yt(V),V.__change=[ur,X,b];var re=l(V,2),be=a(re,!0);t(re),t($),I(ce=>{Lt(V,ce),w(be,e(b))},[()=>e(d).includes(e(b))]),i(h,$)}),t(ae),t(j);var W=l(j,2),ee=l(a(W),2);je(ee,21,()=>k,Ie,(h,b)=>{var $=fr(),V=a($);yt(V),V.__change=[pr,B,b];var re=l(V,2),be=a(re,!0);t(re),t($),I(ce=>{Lt(V,ce),w(be,e(b).label)},[()=>e(n).includes(e(b).value)]),i(h,$)}),t(ee),t(W),t(ge);var he=l(ge,2),fe=a(he);Le(fe,{variant:"ghost",size:"sm",onclick:Q,children:(h,b)=>{Ce();var $=Ge("Limpiar todo");i(h,$)},$$slots:{default:!0}});var pe=l(fe,2);Le(pe,{variant:"primary",onclick:m,children:(h,b)=>{var $=mr(),V=G($);Ha(V,{size:18});var re=l(V,2);{var be=ce=>{var Te=Ge();I(Ve=>w(Te,`(${Ve??""})`),[()=>e(f)()]),i(ce,Te)};z(re,ce=>{e(f)()>0&&ce(be)})}i(h,$)},$$slots:{default:!0}}),t(he),t(xe),i(M,te)};z(H,M=>{r.open&&M(Y)})}i(S,y),Ze()}Mt(["click","change"]);var hr=c("<!> Nuevo Seguimiento",1),br=c('<div class="loading svelte-yb8ym1">Cargando seguimientos...</div>'),xr=c('<div class="followup-status svelte-yb8ym1"><!></div>'),wr=c('<p class="followup-description svelte-yb8ym1"> </p>'),kr=c('<div class="followup-alert svelte-yb8ym1"><!> <span class="svelte-yb8ym1"> </span></div>'),zr=c('<div class="followup-card svelte-yb8ym1"><div class="followup-header svelte-yb8ym1"><div class="followup-type svelte-yb8ym1"><!> <span class="svelte-yb8ym1"> </span></div> <div class="followup-actions svelte-yb8ym1"><!> <!></div></div> <div class="followup-content svelte-yb8ym1"><div class="followup-date svelte-yb8ym1"><!> <span class="svelte-yb8ym1"> </span></div> <!> <!> <!></div></div>'),Sr=c('<div class="followups-list svelte-yb8ym1"></div>'),Pr=c('<div class="followups-container svelte-yb8ym1"><div class="followups-header svelte-yb8ym1"><h2 class="svelte-yb8ym1">Seguimientos</h2> <!></div> <!></div>');function Er(S,r){Qe(r,!0);let u=Oe(r,"loading",3,!1);const _=fa();function T(m){return new Date(m).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}function d(m){_("edit",m)}async function n(m){if(confirm("¿Estás seguro de eliminar este seguimiento?"))try{const f=await fetch(`/api/followups/${m.id}`,{method:"DELETE"}),v=await f.json();if(!f.ok)throw new Error(v.message||"Error al eliminar seguimiento");_("delete",m.id)}catch(f){alert(f.message||"Error al eliminar seguimiento")}}function O(){_("create")}function K(m){if(!m)return"default";const f=m.toLowerCase();return f.includes("completado")||f.includes("resuelto")?"success":f.includes("pendiente")?"warning":f.includes("cancelado")?"error":"info"}function k(m){if(!m.alert_date)return!1;const f=new Date(m.alert_date),v=new Date;return v.setHours(0,0,0,0),f>=v}var U=Pr(),N=a(U),F=l(a(N),2);Le(F,{variant:"primary",size:"sm",onclick:O,children:(m,f)=>{var v=hr(),y=G(v);xa(y,{size:16}),Ce(),i(m,v)},$$slots:{default:!0}}),t(N);var X=l(N,2);{var B=m=>{var f=br();i(m,f)},Q=m=>{var f=ke(),v=G(f);{var y=Y=>{wa(Y,{get icon(){return Rt},title:"Sin seguimientos",description:"No hay seguimientos registrados para esta póliza",action:{label:"Crear Seguimiento",onclick:O}})},H=Y=>{var q=Sr();je(q,21,()=>r.followups,Ie,(le,D)=>{var se=zr(),M=a(se),te=a(M),ie=a(te);Rt(ie,{size:18});var xe=l(ie,2),ue=a(xe,!0);t(xe),t(te);var me=l(te,2),ye=a(me);Le(ye,{variant:"ghost",size:"sm",onclick:()=>d(e(D)),children:(h,b)=>{Ka(h,{size:16})},$$slots:{default:!0}});var ge=l(ye,2);Le(ge,{variant:"ghost",size:"sm",onclick:()=>n(e(D)),children:(h,b)=>{ar(h,{size:16})},$$slots:{default:!0}}),t(me),t(M);var J=l(M,2),g=a(J),E=a(g);na(E,{size:14});var _e=l(E,2),j=a(_e,!0);t(_e),t(g);var ae=l(g,2);{var W=h=>{var b=xr(),$=a(b);{let V=ve(()=>K(e(D).status));oa($,{get variant(){return e(V)},children:(re,be)=>{Ce();var ce=Ge();I(()=>w(ce,e(D).status)),i(re,ce)},$$slots:{default:!0}})}t(b),i(h,b)};z(ae,h=>{e(D).status&&h(W)})}var ee=l(ae,2);{var he=h=>{var b=wr(),$=a(b,!0);t(b),I(()=>w($,e(D).description)),i(h,b)};z(ee,h=>{e(D).description&&h(he)})}var fe=l(ee,2);{var pe=h=>{var b=kr(),$=a(b);Ca($,{size:14});var V=l($,2),re=a(V);t(V),t(b),I(be=>w(re,`Alerta: ${be??""}`),[()=>T(e(D).alert_date)]),i(h,b)};z(fe,h=>{k(e(D))&&h(pe)})}t(J),t(se),I(h=>{w(ue,e(D).followup_type),w(j,h)},[()=>T(e(D).date)]),i(le,se)}),t(q),i(Y,q)};z(v,Y=>{r.followups.length===0?Y(y):Y(H,!1)},!0)}i(m,f)};z(X,m=>{u()?m(B):m(Q,!1)})}t(U),i(S,U),Ze()}var Cr=c('<span class="help-text svelte-1kmjmx"> </span>'),Tr=c('<span class="error-text svelte-1kmjmx"> </span>'),jr=c('<label class="textarea-label svelte-1kmjmx"> <textarea></textarea> <!> <!></label>'),Ir=c('<span class="help-text svelte-1kmjmx"> </span>'),Fr=c('<span class="error-text svelte-1kmjmx"> </span>'),Mr=c("<textarea></textarea> <!> <!>",1);function Ar(S,r){Qe(r,!0);let u=Oe(r,"value",15,""),_=Oe(r,"error",3,!1),T=Oe(r,"textareaRef",15),d=Oe(r,"class",3,""),n=Oa(r,["$$slots","$$events","$$legacy","label","value","error","textareaRef","help","class","children"]);var O=ke(),K=G(O);{var k=N=>{var F=jr(),X=a(F),B=l(X);ra(B),da(B,y=>({class:`textarea ${d()??""}`,...n,[ua]:y}),[()=>({error:_()})],void 0,"svelte-1kmjmx"),_a(B,y=>T(y),()=>T());var Q=l(B,2);{var m=y=>{var H=Cr(),Y=a(H,!0);t(H),I(()=>w(Y,r.help)),i(y,H)};z(Q,y=>{r.help&&y(m)})}var f=l(Q,2);{var v=y=>{var H=Tr(),Y=a(H,!0);t(H),I(()=>w(Y,_())),i(y,H)};z(f,y=>{_()&&typeof _()=="string"&&y(v)})}t(F),I(()=>w(X,`${r.label??""} `)),Bt(B,u),i(N,F)},U=N=>{var F=Mr(),X=G(F);ra(X),da(X,v=>({class:`textarea ${d()??""}`,...n,[ua]:v}),[()=>({error:_()})],void 0,"svelte-1kmjmx"),_a(X,v=>T(v),()=>T());var B=l(X,2);{var Q=v=>{var y=Ir(),H=a(y,!0);t(y),I(()=>w(H,r.help)),i(v,y)};z(B,v=>{r.help&&v(Q)})}var m=l(B,2);{var f=v=>{var y=Fr(),H=a(y,!0);t(y),I(()=>w(H,_())),i(v,y)};z(m,v=>{_()&&typeof _()=="string"&&v(f)})}Bt(X,u),i(N,F)};z(K,N=>{r.label?N(k):N(U,!1)})}i(S,O),Ze()}function Dr(S,r){S.target===S.currentTarget&&r()}var $r=c('<h2 class="dialog-title svelte-1cplwtb"> </h2>'),Nr=c('<p class="dialog-description svelte-1cplwtb"> </p>'),Or=c('<div class="dialog-header svelte-1cplwtb"><!> <!> <button type="button" class="dialog-close svelte-1cplwtb" aria-label="Cerrar"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="svelte-1cplwtb"><path d="M5 5L15 15M5 15L15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="svelte-1cplwtb"></path></svg></button></div>'),Lr=c('<div class="dialog-backdrop svelte-1cplwtb" role="presentation"><div role="dialog" aria-modal="true" tabindex="-1"><!> <div class="dialog-content svelte-1cplwtb"><!></div></div></div>');function Vr(S,r){Qe(r,!0);let u=Oe(r,"open",15,!1),_=Oe(r,"size",3,"md");function T(k){k.key==="Escape"&&u()&&d()}function d(){var k;u(!1),(k=r.onClose)==null||k.call(r)}var n=ke();Ft("keydown",ia,T);var O=G(n);{var K=k=>{var U=Lr();U.__click=[Dr,d];var N=a(U),F=a(N);{var X=m=>{var f=Or(),v=a(f);{var y=le=>{var D=$r(),se=a(D,!0);t(D),I(()=>w(se,r.title)),i(le,D)};z(v,le=>{r.title&&le(y)})}var H=l(v,2);{var Y=le=>{var D=Nr(),se=a(D,!0);t(D),I(()=>w(se,r.description)),i(le,D)};z(H,le=>{r.description&&le(Y)})}var q=l(H,2);q.__click=d,t(f),i(m,f)};z(F,m=>{(r.title||r.description)&&m(X)})}var B=l(F,2),Q=a(B);Ia(Q,()=>r.children??Fa),t(B),t(N),t(U),I(()=>sa(N,1,`dialog dialog-${_()??""}`,"svelte-1cplwtb")),pa(3,N,()=>Qa,()=>({duration:200,easing:Wa,start:.95})),pa(3,U,()=>Za,()=>({duration:200})),i(k,U)};z(O,k=>{u()&&k(K)})}i(S,n),Ze()}Mt(["click"]);var Br=c('<div class="error-message svelte-1efuezy"> </div>'),Rr=c('<option class="svelte-1efuezy"> </option>'),Ur=c('<option class="svelte-1efuezy">Seleccionar tipo</option> <!>',1),qr=c("<!> Cancelar",1),Gr=c("<!> ",1),Hr=c('<form class="svelte-1efuezy"><div class="form-content svelte-1efuezy"><!> <div class="form-row svelte-1efuezy"><!></div> <div class="form-row svelte-1efuezy"><!></div> <div class="form-row svelte-1efuezy"><!></div> <div class="form-row svelte-1efuezy"><!></div> <div class="alert-section svelte-1efuezy"><div class="alert-header svelte-1efuezy"><!> <h3 class="svelte-1efuezy">Alerta (Opcional)</h3></div> <div class="form-field svelte-1efuezy"><!> <span class="help-text svelte-1efuezy">Si seleccionas una fecha, recibirás una notificación</span></div></div></div> <div class="modal-actions svelte-1efuezy"><!> <!></div></form>');function Jr(S,r){var U,N,F,X,B;Qe(r,!0);let u=Oe(r,"open",15,!1),_=Oe(r,"followup",3,null);const T=fa();let d=Ee({followup_type:((U=_())==null?void 0:U.followup_type)||"",date:((N=_())==null?void 0:N.date)||new Date().toISOString().split("T")[0],description:((F=_())==null?void 0:F.description)||"",status:((X=_())==null?void 0:X.status)||"",alert_date:((B=_())==null?void 0:B.alert_date)||""}),n=L(!1),O=L(null);async function K(){o(O,null),o(n,!0);try{const Q=_()?"PUT":"POST",m=_()?`/api/followups/${_().id}`:`/api/policies/${r.policyId}/followups`,f=await fetch(m,{method:Q,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),v=await f.json();if(!f.ok)throw new Error(v.message||"Error al guardar seguimiento");T("success",v.followup),u(!1)}catch(Q){o(O,Q.message||"Error al guardar seguimiento",!0)}finally{o(n,!1)}}function k(){u(!1)}{let Q=ve(()=>_()?"Editar Seguimiento":"Nuevo Seguimiento");Vr(S,{get title(){return e(Q)},get open(){return u()},set open(m){u(m)},children:(m,f)=>{var v=Hr(),y=a(v),H=a(y);{var Y=j=>{var ae=Br(),W=a(ae,!0);t(ae),I(()=>w(W,e(O))),i(j,ae)};z(H,j=>{e(O)&&j(Y)})}var q=l(H,2),le=a(q);Ga(le,{label:"Tipo de Seguimiento",required:!0,get value(){return d.followup_type},set value(j){d.followup_type=j},children:(j,ae)=>{var W=Ur(),ee=G(W);ee.value=ee.__value="";var he=l(ee,2);je(he,17,()=>r.followupTypes,Ie,(fe,pe)=>{var h=Rr(),b=a(h,!0);t(h);var $={};I(()=>{w(b,e(pe)),$!==($=e(pe))&&(h.value=(h.__value=e(pe))??"")}),i(fe,h)}),i(j,W)},$$slots:{default:!0}}),t(q);var D=l(q,2),se=a(D);qe(se,{type:"date",label:"Fecha del Seguimiento",required:!0,get value(){return d.date},set value(j){d.date=j}}),t(D);var M=l(D,2),te=a(M);qe(te,{label:"Estado",placeholder:"Ej: Pendiente, Completado, En proceso...",get value(){return d.status},set value(j){d.status=j}}),t(M);var ie=l(M,2),xe=a(ie);Ar(xe,{label:"Descripción",placeholder:"Detalles del seguimiento...",rows:4,get value(){return d.description},set value(j){d.description=j}}),t(ie);var ue=l(ie,2),me=a(ue),ye=a(me);Ca(ye,{size:18}),Ce(2),t(me);var ge=l(me,2),J=a(ge);qe(J,{type:"date",label:"Fecha de Alerta",placeholder:"Selecciona una fecha para recibir alerta",get value(){return d.alert_date},set value(j){d.alert_date=j}}),Ce(2),t(ge),t(ue),t(y);var g=l(y,2),E=a(g);Le(E,{type:"button",variant:"ghost",onclick:k,get disabled(){return e(n)},children:(j,ae)=>{var W=qr(),ee=G(W);Ut(ee,{size:18}),Ce(),i(j,W)},$$slots:{default:!0}});var _e=l(E,2);Le(_e,{type:"submit",variant:"primary",get disabled(){return e(n)},children:(j,ae)=>{var W=Gr(),ee=G(W);Ea(ee,{size:18});var he=l(ee);I(()=>w(he,` ${e(n)?"Guardando...":_()?"Actualizar":"Crear"}`)),i(j,W)},$$slots:{default:!0}}),t(g),t(v),Ft("submit",v,j=>{j.preventDefault(),K()}),i(m,v)},$$slots:{default:!0}})}Ze()}var Kr=(S,r)=>r.onClose(),Xr=(S,r,u)=>{const _=r().url.searchParams.get("fromId");_&&(u.onClose(),it(`/clientes?clientId=${_}&mode=view`))},Qr=c('<button class="back-btn svelte-1yt9re3" title="Volver a cliente"><!></button>'),Zr=c('<p class="subtitle svelte-1yt9re3"> </p>'),Wr=c('<button class="icon-btn svelte-1yt9re3" title="Edit policy"><!></button>'),Yr=(S,r)=>r.onClose(),el=c('<div class="loading-state svelte-1yt9re3"><p class="svelte-1yt9re3">Cargando detalles de póliza...</p></div>'),tl=c('<option class="svelte-1yt9re3">Cargando...</option>'),al=c('<option class="svelte-1yt9re3">No hay aseguradoras disponibles</option>'),rl=c('<option class="svelte-1yt9re3"> </option>'),ll=c('<option class="svelte-1yt9re3">Seleccionar aseguradora</option> <!>',1),sl=c('<span class="error-text svelte-1yt9re3"> </span>'),il=c('<section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Información del Vehículo</h3> <div class="form-field svelte-1yt9re3"><label for="vehicle_plate" class="svelte-1yt9re3">Patente</label> <!></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="vehicle_brand" class="svelte-1yt9re3">Marca</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="vehicle_model" class="svelte-1yt9re3">Modelo</label> <!></div></div></section>'),ol=(S,r)=>e(r)&&it(`/clientes?clientId=${e(r).client_id}`),nl=c('<section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Cliente</h3> <div class="client-card svelte-1yt9re3"><div class="client-icon svelte-1yt9re3"><!></div> <div class="client-info svelte-1yt9re3"><div class="client-name svelte-1yt9re3"> </div> <button type="button" class="link-btn svelte-1yt9re3">Ver cliente →</button></div></div></section>'),vl=c('<textarea id="observations" rows="4" placeholder="Observaciones adicionales..." class="svelte-1yt9re3"></textarea>'),cl=c('<p class="field-value preserve-whitespace svelte-1yt9re3"> </p>'),dl=c('<form class="svelte-1yt9re3"><section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Información de la Póliza</h3> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="policy_number" class="svelte-1yt9re3">Número de Póliza</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="policy_type" class="svelte-1yt9re3">Tipo de Póliza</label> <select id="policy_type" class="svelte-1yt9re3"><option class="svelte-1yt9re3">Auto</option><option class="svelte-1yt9re3">Hogar</option><option class="svelte-1yt9re3">Vida</option><option class="svelte-1yt9re3">Salud</option><option class="svelte-1yt9re3">Empresa</option><option class="svelte-1yt9re3">Otro</option></select></div></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="insurer" class="svelte-1yt9re3">Aseguradora</label> <select id="insurer" class="svelte-1yt9re3"><!></select> <!></div> <div class="form-field svelte-1yt9re3"><label for="payment_mode" class="svelte-1yt9re3">Forma de Pago</label> <select id="payment_mode" class="svelte-1yt9re3"><option class="svelte-1yt9re3">Mensual</option><option class="svelte-1yt9re3">Trimestral</option><option class="svelte-1yt9re3">Semestral</option><option class="svelte-1yt9re3">Anual</option></select></div></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="start_date" class="svelte-1yt9re3">Fecha de Inicio</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="expiry_date" class="svelte-1yt9re3">Fecha de Vencimiento</label> <!></div></div></section> <!>  <!> <section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Observaciones</h3> <div class="form-field svelte-1yt9re3"><!></div></section></form>'),ul=c('<div class="followups-container svelte-1yt9re3"><!></div>'),_l=c("<!> Guardar Cambios",1),pl=c('<div class="modal-footer svelte-1yt9re3"><!> <!></div>'),fl=c('<button class="backdrop svelte-1yt9re3" aria-label="Close modal"></button> <div class="modal-panel svelte-1yt9re3"><div class="modal-header svelte-1yt9re3"><div class="header-content svelte-1yt9re3"><!> <div class="icon-wrapper svelte-1yt9re3"><!></div> <div class="svelte-1yt9re3"><h2 class="svelte-1yt9re3"><!></h2> <!></div></div> <div class="header-actions svelte-1yt9re3"><!> <button class="icon-btn svelte-1yt9re3" title="Close"><!></button></div></div> <div class="modal-content svelte-1yt9re3"><!></div> <!></div> <!>',1);function ml(S,r){Qe(r,!0);const u=()=>ha(ba,"$page",_),[_,T]=ga();let d=Oe(r,"mode",3,"view"),n=L(null),O=L(!1),K=L(!1),k=L(d()==="edit"),U=L(Ee([])),N=L(!1),F=L("info"),X=L(Ee([])),B=L(!1),Q=L(!1),m=L(null),f=L(Ee([])),v=L(Ee({policy_number:"",policy_type:"auto",insurer:"",payment_mode:"monthly",start_date:"",expiry_date:"",vehicle_plate:"",vehicle_brand:"",vehicle_model:"",observations:""})),y=L(Ee({}));la(()=>{H()}),la(()=>{r.policyId&&(o(k,d()==="edit"),o(F,"info"),Y(),q(),le())});async function H(){o(N,!0);try{const g=await fetch("/api/insurance-companies"),E=await g.json();g.ok?o(U,E.companies||[],!0):console.error("Error loading insurers:",E.message)}catch(g){console.error("Error loading insurers:",g)}finally{o(N,!1)}}async function Y(){var g,E,_e,j,ae,W,ee,he,fe,pe;if(r.policyId){o(O,!0);try{const h=await fetch(`/api/policies/${r.policyId}`),b=await h.json();h.ok?(o(n,b.policy,!0),o(v,{policy_number:((g=e(n))==null?void 0:g.policy_number)||"",policy_type:((E=e(n))==null?void 0:E.policy_type)||"auto",insurer:((_e=e(n))==null?void 0:_e.insurer)||"",payment_mode:((j=e(n))==null?void 0:j.payment_mode)||"monthly",start_date:((ae=e(n))==null?void 0:ae.start_date)||"",expiry_date:((W=e(n))==null?void 0:W.expiry_date)||"",vehicle_plate:((ee=e(n))==null?void 0:ee.vehicle_plate)||"",vehicle_brand:((he=e(n))==null?void 0:he.vehicle_brand)||"",vehicle_model:((fe=e(n))==null?void 0:fe.vehicle_model)||"",observations:((pe=e(n))==null?void 0:pe.observations)||""},!0)):(Ne({type:"error",message:"Error loading policy"}),r.onClose())}catch{Ne({type:"error",message:"Error loading policy"}),r.onClose()}finally{o(O,!1)}}}async function q(){if(r.policyId){o(B,!0);try{const g=await fetch(`/api/policies/${r.policyId}/followups`),E=await g.json();g.ok?o(X,E.followups||[],!0):console.error("Error loading followups:",E.message)}catch(g){console.error("Error loading followups:",g)}finally{o(B,!1)}}}async function le(){try{const g=await fetch("/api/configuration?key=followup_types"),E=await g.json();g.ok&&E.config_value?o(f,E.config_value,!0):o(f,["Seguimiento","Reclamo","Siniestro","Renovación","Otro"],!0)}catch(g){console.error("Error loading followup types:",g),o(f,["Seguimiento","Reclamo","Siniestro","Renovación","Otro"],!0)}}function D(){o(m,null),o(Q,!0)}function se(g){o(m,g.detail,!0),o(Q,!0)}function M(){q()}function te(){q()}async function ie(){if(r.policyId){o(K,!0),o(y,{},!0);try{const g=await fetch(`/api/policies/${r.policyId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e(v))}),E=await g.json();g.ok?(Ne({type:"success",message:"Policy updated successfully"}),o(k,!1),await Y(),r.onClose(!0)):(E.errors&&o(y,E.errors,!0),Ne({type:"error",message:E.message||"Error updating policy"}))}catch{Ne({type:"error",message:"Error updating policy"})}finally{o(K,!1)}}}function xe(){o(k,!e(k)),!e(k)&&e(n)&&(o(v,{policy_number:e(n).policy_number||"",policy_type:e(n).policy_type||"auto",insurer:e(n).insurer||"",payment_mode:e(n).payment_mode||"monthly",start_date:e(n).start_date||"",expiry_date:e(n).expiry_date||"",vehicle_plate:e(n).vehicle_plate||"",vehicle_brand:e(n).vehicle_brand||"",vehicle_model:e(n).vehicle_model||"",observations:e(n).observations||""},!0),o(y,{},!0))}const ue={auto:"Auto",home:"Hogar",life:"Vida",health:"Salud",business:"Empresa",other:"Otro"};function me(g){g.key==="Escape"&&r.onClose()}var ye=ke();Ft("keydown",ia,me);var ge=G(ye);{var J=g=>{var E=fl(),_e=G(E);_e.__click=[Kr,r];var j=l(_e,2),ae=a(j),W=a(ae),ee=a(W);{var he=A=>{var s=Qr();s.__click=[Xr,u,r];var p=a(s);Ya(p,{size:20}),t(s),i(A,s)};z(ee,A=>{u().url.searchParams.get("from")==="client"&&A(he)})}var fe=l(ee,2),pe=a(fe);Rt(pe,{size:24}),t(fe);var h=l(fe,2),b=a(h),$=a(b);{var V=A=>{var s=Ge("Cargando...");i(A,s)},re=A=>{var s=ke(),p=G(s);{var x=R=>{var de=Ge();I(()=>w(de,e(n).policy_number||"Sin número")),i(R,de)};z(p,R=>{e(n)&&R(x)},!0)}i(A,s)};z($,A=>{e(O)?A(V):A(re,!1)})}t(b);var be=l(b,2);{var ce=A=>{var s=Zr(),p=a(s,!0);t(s),I(()=>w(p,ue[e(n).policy_type])),i(A,s)};z(be,A=>{e(n)&&!e(O)&&A(ce)})}t(h),t(W);var Te=l(W,2),Ve=a(Te);{var qt=A=>{var s=Wr();s.__click=xe;var p=a(s);Ja(p,{size:18}),t(s),i(A,s)};z(Ve,A=>{!e(k)&&!e(O)&&A(qt)})}var gt=l(Ve,2);gt.__click=[Yr,r];var Gt=a(gt);Ut(Gt,{size:20}),t(gt),t(Te),t(ae);var ot=l(ae,2),Ht=a(ot);{var Jt=A=>{var s=el();i(A,s)},Kt=A=>{var s=ke(),p=G(s);{var x=R=>{{let de=ve(()=>[{id:"info",label:"Información"},{id:"followups",label:`Seguimientos (${e(X).length})`}]);Xa(R,{get tabs(){return e(de)},get activeTab(){return e(F)},set activeTab(Z){o(F,Z,!0)},$$events:{change:Z=>o(F,Z.detail,!0)},children:(Z,We)=>{var Fe=ke(),Ye=G(Fe);{var Me=Se=>{var Ae=dl(),De=a(Ae),$e=l(a(De),2),Be=a($e),oe=l(a(Be),2);{let P=ve(()=>!e(k));qe(oe,{id:"policy_number",get error(){return e(y).policy_number},get disabled(){return e(P)},get value(){return e(v).policy_number},set value(C){e(v).policy_number=C}})}t(Be);var nt=l(Be,2),et=l(a(nt),2),Re=a(et);Re.value=Re.__value="auto";var ht=l(Re);ht.value=ht.__value="home";var tt=l(ht);tt.value=tt.__value="life";var vt=l(tt);vt.value=vt.__value="health";var at=l(vt);at.value=at.__value="business";var ct=l(at);ct.value=ct.__value="other",t(et),t(nt),t($e);var bt=l($e,2),rt=a(bt),Je=l(a(rt),2),Dt=a(Je);{var xt=P=>{var C=tl();C.value=C.__value="",i(P,C)},Wt=P=>{var C=ke(),ne=G(C);{var we=ze=>{var Pe=al();Pe.value=Pe.__value="",i(ze,Pe)},mt=ze=>{var Pe=ll(),Xe=G(Pe);Xe.value=Xe.__value="";var jt=l(Xe,2);je(jt,17,()=>e(U),Ie,(st,Ue)=>{var It=rl(),Ta=a(It,!0);t(It);var ca={};I(()=>{w(Ta,e(Ue).name),ca!==(ca=e(Ue).name)&&(It.value=(It.__value=e(Ue).name)??"")}),i(st,It)}),i(ze,Pe)};z(ne,ze=>{e(U).length===0?ze(we):ze(mt,!1)},!0)}i(P,C)};z(Dt,P=>{e(N)?P(xt):P(Wt,!1)})}t(Je);var wt=l(Je,2);{var $t=P=>{var C=sl(),ne=a(C,!0);t(C),I(()=>w(ne,e(y).insurer)),i(P,C)};z(wt,P=>{e(y).insurer&&P($t)})}t(rt);var Nt=l(rt,2),Ke=l(a(Nt),2),kt=a(Ke);kt.value=kt.__value="monthly";var lt=l(kt);lt.value=lt.__value="quarterly";var zt=l(lt);zt.value=zt.__value="semi-annual";var dt=l(zt);dt.value=dt.__value="annual",t(Ke),t(Nt),t(bt);var St=l(bt,2),ut=a(St),_t=l(a(ut),2);{let P=ve(()=>!e(k));qe(_t,{id:"start_date",type:"date",get error(){return e(y).start_date},get disabled(){return e(P)},get value(){return e(v).start_date},set value(C){e(v).start_date=C}})}t(ut);var Pt=l(ut,2),Yt=l(a(Pt),2);{let P=ve(()=>!e(k));qe(Yt,{id:"expiry_date",type:"date",get error(){return e(y).expiry_date},get disabled(){return e(P)},get value(){return e(v).expiry_date},set value(C){e(v).expiry_date=C}})}t(Pt),t(St),t(De);var Ot=l(De,2);{var ea=P=>{var C=il(),ne=l(a(C),2),we=l(a(ne),2);{let st=ve(()=>!e(k));qe(we,{id:"vehicle_plate",get error(){return e(y).vehicle_plate},get disabled(){return e(st)},get value(){return e(v).vehicle_plate},set value(Ue){e(v).vehicle_plate=Ue}})}t(ne);var mt=l(ne,2),ze=a(mt),Pe=l(a(ze),2);{let st=ve(()=>!e(k));qe(Pe,{id:"vehicle_brand",get error(){return e(y).vehicle_brand},get disabled(){return e(st)},get value(){return e(v).vehicle_brand},set value(Ue){e(v).vehicle_brand=Ue}})}t(ze);var Xe=l(ze,2),jt=l(a(Xe),2);{let st=ve(()=>!e(k));qe(jt,{id:"vehicle_model",get error(){return e(y).vehicle_model},get disabled(){return e(st)},get value(){return e(v).vehicle_model},set value(Ue){e(v).vehicle_model=Ue}})}t(Xe),t(mt),t(C),i(P,C)};z(Ot,P=>{(e(n).policy_type==="auto"||e(k))&&P(ea)})}var pt=l(Ot,2);{var ta=P=>{var C=nl(),ne=l(a(C),2),we=a(ne),mt=a(we);va(mt,{size:20}),t(we);var ze=l(we,2),Pe=a(ze),Xe=a(Pe,!0);t(Pe);var jt=l(Pe,2);jt.__click=[ol,n],t(ze),t(ne),t(C),I(()=>w(Xe,e(n).client_full_name||"Sin nombre")),i(P,C)};z(pt,P=>{!e(k)&&e(n).client&&!u().url.searchParams.get("from")&&P(ta)})}var Et=l(pt,2),Ct=l(a(Et),2),ft=a(Ct);{var aa=P=>{var C=vl();ra(C),Bt(C,()=>e(v).observations,ne=>e(v).observations=ne),i(P,C)},Tt=P=>{var C=cl(),ne=a(C,!0);t(C),I(()=>w(ne,e(n).observations||"Sin observaciones")),i(P,C)};z(ft,P=>{e(k)?P(aa):P(Tt,!1)})}t(Ct),t(Et),t(Ae),I(()=>{et.disabled=!e(k),Je.disabled=!e(k)||e(N),Ke.disabled=!e(k)}),Ft("submit",Ae,P=>{P.preventDefault(),ie()}),Vt(et,()=>e(v).policy_type,P=>e(v).policy_type=P),Vt(Je,()=>e(v).insurer,P=>e(v).insurer=P),Vt(Ke,()=>e(v).payment_mode,P=>e(v).payment_mode=P),i(Se,Ae)},He=Se=>{var Ae=ke(),De=G(Ae);{var $e=Be=>{var oe=ul(),nt=a(oe);Er(nt,{get followups(){return e(X)},get loading(){return e(B)},$$events:{create:D,edit:se,delete:te}}),t(oe),i(Be,oe)};z(De,Be=>{e(F)==="followups"&&Be($e)},!0)}i(Se,Ae)};z(Ye,Se=>{e(F)==="info"?Se(Me):Se(He,!1)})}i(Z,Fe)},$$slots:{default:!0}})}};z(p,R=>{e(n)&&R(x)},!0)}i(A,s)};z(Ht,A=>{e(O)?A(Jt):A(Kt,!1)})}t(ot);var Xt=l(ot,2);{var Qt=A=>{var s=pl(),p=a(s);Le(p,{variant:"ghost",onclick:xe,get disabled(){return e(K)},children:(R,de)=>{Ce();var Z=Ge("Cancelar");i(R,Z)},$$slots:{default:!0}});var x=l(p,2);Le(x,{variant:"primary",onclick:ie,get disabled(){return e(K)},children:(R,de)=>{var Z=ke(),We=G(Z);{var Fe=Me=>{var He=Ge("Guardando...");i(Me,He)},Ye=Me=>{var He=_l(),Se=G(He);Ea(Se,{size:18}),Ce(),i(Me,He)};z(We,Me=>{e(K)?Me(Fe):Me(Ye,!1)})}i(R,Z)},$$slots:{default:!0}}),t(s),i(A,s)};z(Xt,A=>{e(k)&&!e(O)&&A(Qt)})}t(j);var Zt=l(j,2);{var At=A=>{Jr(A,{get followup(){return e(m)},get followupTypes(){return e(f)},get policyId(){return r.policyId},get open(){return e(Q)},set open(s){o(Q,s,!0)},$$events:{success:M}})};z(Zt,A=>{r.policyId&&A(At)})}i(g,E)};z(ge,g=>{r.policyId&&g(J)})}i(S,ye),Ze(),T()}Mt(["click"]);function yl(S,r,u,_,T){o(r,e(r)==="asc"?"desc":"asc",!0),o(u,1),o(_,[],!0),T()}function gl(S,r,u,_,T){o(r,{policyTypes:[],paymentModes:[],insurers:[],statuses:[]},!0),o(u,1),o(_,[],!0),T()}var hl=c("<!> Nueva Póliza",1),bl=(S,r,u,_,T)=>{localStorage.setItem("policies_show_inactive",e(r).toString()),o(u,1),o(_,[],!0),T()},xl=(S,r)=>o(r,!e(r)),wl=c('<span class="filter-badge svelte-17pngxe"> </span>'),kl=c('<button class="clear-filters-btn svelte-17pngxe" title="Limpiar filtros"><!></button>'),zl=(S,r,u,_)=>{o(r,1),o(u,[],!0),_()},Sl=c('<option class="svelte-17pngxe"> </option>'),Pl=c('<span class="count-skeleton svelte-17pngxe"></span>'),El=c('<span class="count-text svelte-17pngxe"> </span> <span class="count-separator svelte-17pngxe">/</span> <span class="count-total svelte-17pngxe"> </span>',1),Cl=c('<div class="skeleton-list svelte-17pngxe"></div>'),Tl=(S,r,u)=>r(e(u).id,"view"),jl=(S,r)=>it(`/clientes?clientId=${e(r).client_id}&mode=view&from=policy&fromId=${e(r).id}`),Il=c('<span class="expiry-badge svelte-17pngxe"> </span>'),Fl=(S,r,u)=>r(e(u).id,"view"),Ml=(S,r,u)=>r(e(u).id,e(u).policy_number||"esta póliza"),Al=c('<tr class="svelte-17pngxe"><td class="row-number svelte-17pngxe"></td><td class="svelte-17pngxe"><button class="policy-number-btn svelte-17pngxe"> </button></td><td class="svelte-17pngxe"><div class="client-info svelte-17pngxe"><!> <button class="client-link-btn svelte-17pngxe"> </button></div></td><td class="svelte-17pngxe"><span class="insurer-name svelte-17pngxe"> </span></td><td class="svelte-17pngxe"> </td><td class="svelte-17pngxe"><!></td><td class="svelte-17pngxe"><div class="expiry-info svelte-17pngxe"><!> <span> </span> <!></div></td><td class="text-nowrap svelte-17pngxe"> </td><td class="text-right svelte-17pngxe"><div class="actions svelte-17pngxe"><button class="action-btn svelte-17pngxe" title="Ver"><!></button> <button class="action-btn danger svelte-17pngxe" title="Eliminar"><!></button></div></td></tr>'),Dl=c('<thead class="sticky-header svelte-17pngxe"><tr class="svelte-17pngxe"><th style="width: 60px" class="svelte-17pngxe">#</th><th class="svelte-17pngxe">N° Póliza</th><th class="svelte-17pngxe">Cliente</th><th class="svelte-17pngxe">Aseguradora</th><th class="svelte-17pngxe">Tipo</th><th class="svelte-17pngxe">Estado</th><th class="svelte-17pngxe">Vencimiento</th><th class="svelte-17pngxe">Creado</th><th class="text-right svelte-17pngxe">Acciones</th></tr></thead> <tbody class="svelte-17pngxe"></tbody>',1),$l=c('<div class="cards-grid svelte-17pngxe"></div> <div class="table-container svelte-17pngxe"><!></div> <!>',1),Nl=c('<div class="page svelte-17pngxe"><div class="page-header svelte-17pngxe"><div class="svelte-17pngxe"><h1 class="svelte-17pngxe">Pólizas</h1> <p class="svelte-17pngxe">Gestiona todas las pólizas de seguros</p></div> <!></div> <div class="filters-toolbar svelte-17pngxe"><div class="search-box svelte-17pngxe"><!> <input type="text" placeholder="Buscar pólizas..." class="svelte-17pngxe"/></div> <div class="toolbar-actions svelte-17pngxe"><div class="filter-checkbox svelte-17pngxe"><label class="checkbox-label svelte-17pngxe"><input type="checkbox" class="svelte-17pngxe"/> <span class="svelte-17pngxe">Mostrar inactivas</span></label></div> <button title="Filtros"><!> <!></button> <!> <div class="sort-select svelte-17pngxe"><label for="sort-by" class="svelte-17pngxe">Ordenar por:</label> <select id="sort-by" class="svelte-17pngxe"></select> <button class="sort-order-btn svelte-17pngxe"><!></button></div> <div class="results-count svelte-17pngxe"><!></div></div></div> <!></div> <!> <!>',1);function ms(S,r){Qe(r,!0);const u=()=>ha(ba,"$page",_),[_,T]=ga();let d=L(Ee([])),n=L(!0),O=L(!1),K=L(""),k=L("created_at"),U=L("desc"),N=L(!1),F=L(1),X=30,B=L(0),Q=L(!0),m=L(!1),f=L(Ee({policyTypes:[],paymentModes:[],insurers:[],statuses:[]})),v=ve(()=>u().url.searchParams.get("policyId")),y=ve(()=>u().url.searchParams.get("mode")||"view");const H=[{value:"created_at",label:"Fecha de creación"},{value:"expiry_date",label:"Fecha de vencimiento"},{value:"policy_number",label:"Número de póliza"},{value:"policy_type",label:"Tipo de póliza"},{value:"insurer",label:"Aseguradora"},{value:"payment_mode",label:"Forma de pago"}];ja(()=>{const s=localStorage.getItem("policies_show_inactive");s!==null&&o(N,s==="true"),q()});const Y=er(()=>{o(F,1),o(d,[],!0),q()},300);la(()=>{e(K)!==void 0&&Y()});async function q(s=!1){var p;s?o(O,!0):o(n,!0);try{const x=new URLSearchParams({page:e(F).toString(),limit:X.toString(),sortBy:e(k),sortOrder:e(U)});e(K)&&x.append("search",e(K)),e(N)||x.append("active_only","true"),e(f).policyTypes.forEach(Z=>{x.append("policy_type",Z)}),e(f).paymentModes.forEach(Z=>{x.append("payment_mode",Z)}),e(f).insurers.forEach(Z=>{x.append("insurer",Z)}),e(f).statuses.forEach(Z=>{x.append("status",Z)});const R=await fetch(`/api/policies?${x}`);console.log("Response status:",R.status);const de=await R.json();console.log("Result:",de),R.ok?(s?o(d,[...e(d),...de.policies||[]],!0):o(d,de.policies||[],!0),o(B,((p=de.pagination)==null?void 0:p.total)||0,!0),o(Q,e(d).length<e(B))):(Ne({type:"error",message:de.message||"Error al cargar pólizas"}),o(d,[],!0))}catch(x){console.error("Error loading policies:",x),Ne({type:"error",message:"Error al cargar pólizas"}),o(d,[],!0)}finally{o(n,!1),o(O,!1)}}function le(){!e(n)&&!e(O)&&e(Q)&&(Da(F),q(!0))}async function D(s,p){if(confirm(`¿Seguro que deseas eliminar la póliza ${p}?`))try{const x=await fetch(`/api/policies/${s}`,{method:"DELETE"});if(x.ok)Ne({type:"success",message:"Póliza eliminada"}),q();else{const R=await x.json();Ne({type:"error",message:R.message})}}catch{Ne({type:"error",message:"Error al eliminar"})}}function se(s){return new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}function M(s,p){return s?new Date(p)<new Date?{variant:"warning",label:"Vencida"}:{variant:"success",label:"Activa"}:{variant:"error",label:"Inactiva"}}function te(s){const p=new Date,x=new Date(s);return Math.ceil((x.getTime()-p.getTime())/(1e3*60*60*24))}const ie=ve(()=>()=>{let s=0;return s+=e(f).policyTypes.length,s+=e(f).paymentModes.length,s+=e(f).insurers.length,s+=e(f).statuses.length,s});function xe(s){o(f,s,!0),o(F,1),o(d,[],!0),q()}function ue(s,p="view"){const x=new URL(window.location.href);x.searchParams.set("policyId",s),x.searchParams.set("mode",p),it(x.pathname+x.search,{replaceState:!1,noScroll:!0})}function me(s){const p=new URL(window.location.href);p.searchParams.delete("policyId"),p.searchParams.delete("mode"),it(p.pathname+p.search,{replaceState:!1,noScroll:!0}),s&&(o(F,1),o(d,[],!0),q())}var ye=Nl();Ma(s=>{Aa.title="Pólizas - PAS Manager"});var ge=G(ye),J=a(ge),g=l(a(J),2);Le(g,{variant:"primary",onclick:()=>it("/polizas/nuevo"),children:(s,p)=>{var x=hl(),R=G(x);xa(R,{size:18}),Ce(),i(s,x)},$$slots:{default:!0}}),t(J);var E=l(J,2),_e=a(E),j=a(_e);tr(j,{size:20});var ae=l(j,2);yt(ae),t(_e);var W=l(_e,2),ee=a(W),he=a(ee),fe=a(he);yt(fe),fe.__change=[bl,N,F,d,q],Ce(2),t(he),t(ee);var pe=l(ee,2);let h;pe.__click=[xl,m];var b=a(pe);Va(b,{size:18});var $=l(b,2);{var V=s=>{var p=wl(),x=a(p,!0);t(p),I(R=>w(x,R),[()=>e(ie)()]),i(s,p)};z($,s=>{e(ie)()>0&&s(V)})}t(pe);var re=l(pe,2);{var be=s=>{var p=kl();p.__click=[gl,f,F,d,q];var x=a(p);Ut(x,{size:18}),t(p),i(s,p)};z(re,s=>{e(ie)()>0&&s(be)})}var ce=l(re,2),Te=l(a(ce),2);Te.__change=[zl,F,d,q],je(Te,21,()=>H,Ie,(s,p)=>{var x=Sl(),R=a(x,!0);t(x);var de={};I(()=>{w(R,e(p).label),de!==(de=e(p).value)&&(x.value=(x.__value=e(p).value)??"")}),i(s,x)}),t(Te);var Ve=l(Te,2);Ve.__click=[yl,U,F,d,q];var qt=a(Ve);{var gt=s=>{Ba(s,{size:16})},Gt=s=>{Ra(s,{size:16})};z(qt,s=>{e(U)==="asc"?s(gt):s(Gt,!1)})}t(Ve),t(ce);var ot=l(ce,2),Ht=a(ot);{var Jt=s=>{var p=Pl();i(s,p)},Kt=s=>{var p=El(),x=G(p),R=a(x,!0);t(x);var de=l(x,4),Z=a(de,!0);t(de),I(()=>{w(R,e(d).length),w(Z,e(B))}),i(s,p)};z(Ht,s=>{e(n)&&e(d).length===0?s(Jt):s(Kt,!1)})}t(ot),t(W),t(E);var Xt=l(E,2);{var Qt=s=>{var p=Cl();je(p,20,()=>Array(5),Ie,(x,R)=>{Ua(x,{height:"60px"})}),t(p),i(s,p)},Zt=s=>{var p=ke(),x=G(p);{var R=Z=>{{let We=ve(()=>e(K)||e(ie)()>0?"No se encontraron resultados":"Comienza agregando tu primera póliza"),Fe=ve(()=>e(K)||e(ie)()>0?void 0:{label:"Nueva Póliza",onclick:()=>it("/polizas/nuevo")});wa(Z,{get icon(){return Rt},title:"No hay pólizas",get description(){return e(We)},get action(){return e(Fe)}})}},de=Z=>{var We=$l(),Fe=G(We);je(Fe,21,()=>e(d),Ie,(Se,Ae,De)=>{or(Se,{get policy(){return e(Ae)},index:De,onView:$e=>ue($e,"view"),onDelete:D})}),t(Fe);var Ye=l(Fe,2),Me=a(Ye);La(Me,{children:(Se,Ae)=>{var De=Dl(),$e=l(G(De),2);je($e,21,()=>e(d),Ie,(Be,oe,nt)=>{const et=ve(()=>M(e(oe).active,e(oe).expiry_date)),Re=ve(()=>te(e(oe).expiry_date)),ht=ve(()=>e(oe).client?`${e(oe).client.first_name} ${e(oe).client.last_name}`:"Cliente no disponible");var tt=Al(),vt=a(tt);vt.textContent=nt+1;var at=l(vt),ct=a(at);ct.__click=[Tl,ue,oe];var bt=a(ct,!0);t(ct),t(at);var rt=l(at),Je=a(rt),Dt=a(Je);va(Dt,{size:14});var xt=l(Dt,2);xt.__click=[jl,oe];var Wt=a(xt,!0);t(xt),t(Je),t(rt);var wt=l(rt),$t=a(wt),Nt=a($t,!0);t($t),t(wt);var Ke=l(wt),kt=a(Ke,!0);t(Ke);var lt=l(Ke),zt=a(lt);oa(zt,{get variant(){return e(et).variant},children:(C,ne)=>{Ce();var we=Ge();I(()=>w(we,e(et).label)),i(C,we)},$$slots:{default:!0}}),t(lt);var dt=l(lt),St=a(dt),ut=a(St);na(ut,{size:14});var _t=l(ut,2);let Pt;var Yt=a(_t,!0);t(_t);var Ot=l(_t,2);{var ea=C=>{var ne=Il(),we=a(ne);t(ne),I(()=>w(we,`${e(Re)??""}d`)),i(C,ne)};z(Ot,C=>{e(Re)<=30&&e(Re)>0&&C(ea)})}t(St),t(dt);var pt=l(dt),ta=a(pt,!0);t(pt);var Et=l(pt),Ct=a(Et),ft=a(Ct);ft.__click=[Fl,ue,oe];var aa=a(ft);ka(aa,{size:16}),t(ft);var Tt=l(ft,2);Tt.__click=[Ml,D,oe];var P=a(Tt);za(P,{size:16}),t(Tt),t(Ct),t(Et),t(tt),I((C,ne,we)=>{w(bt,e(oe).policy_number||"S/N"),w(Wt,e(ht)),w(Nt,e(oe).insurer||"-"),w(kt,e(oe).policy_type),Pt=sa(_t,1,"svelte-17pngxe",null,Pt,C),w(Yt,ne),w(ta,we)},[()=>({warning:e(Re)<=30&&e(Re)>0}),()=>se(e(oe).expiry_date),()=>se(e(oe).created_at)]),i(Be,tt)}),t($e),i(Se,De)},$$slots:{default:!0}}),t(Ye);var He=l(Ye,2);qa(He,{get hasMore(){return e(Q)},onLoadMore:le}),i(Z,We)};z(x,Z=>{e(d).length===0?Z(R):Z(de,!1)},!0)}i(s,p)};z(Xt,s=>{e(n)?s(Qt):s(Zt,!1)})}t(ge);var At=l(ge,2);gr(At,{get open(){return e(m)},onClose:()=>o(m,!1),onApply:xe,get initialFilters(){return e(f)}});var A=l(At,2);ml(A,{get policyId(){return e(v)},get mode(){return e(y)},onClose:me}),I(s=>{h=sa(pe,1,"filter-btn svelte-17pngxe",null,h,s),$a(Ve,"title",e(U)==="asc"?"Ascendente":"Descendente")},[()=>({active:e(m)||e(ie)()>0})]),Bt(ae,()=>e(K),s=>o(K,s)),Na(fe,()=>e(N),s=>o(N,s)),Vt(Te,()=>e(k),s=>o(k,s)),i(S,ye),Ze(),T()}Mt(["change","click"]);export{ms as component};
