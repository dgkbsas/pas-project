import"../chunks/CWj6FrbW.js";import{o as ra}from"../chunks/C_FCoYF_.js";import{ag as Ct,a7 as Mt,b as f,d as a,r as t,U as r,af as Ye,ak as qe,t as T,ah as x,a3 as e,ae as H,a as n,ab as At,a8 as C,a9 as Ae,c as Qe,f as K,ad as i,B as Bt,ai as sa,aj as la,aa as ia,ac as oa,aB as na}from"../chunks/dGHTYzhB.js";import{i as E}from"../chunks/_danfitL.js";import{e as Te,r as vt,b as It,i as Fe,d as jt,s as va}from"../chunks/X3gEIfGK.js";import{s as Rt}from"../chunks/BZZkyLtE.js";import{b as Gt,a as ca}from"../chunks/Bh6sXfGS.js";import{p as da,a as qt,b as Ht}from"../chunks/pnKjlpSc.js";import{g as We}from"../chunks/DmrR99iC.js";import{p as $t}from"../chunks/BKbJYTTl.js";import{B as mt}from"../chunks/DOI_CNwM.js";import{T as _a}from"../chunks/1h6XdPlc.js";import{E as ua}from"../chunks/CgF9W7Br.js";import{F as pa,A as fa,a as ya,S as ma,I as ga}from"../chunks/C2tzjyNj.js";/* empty css                */import{B as Xt}from"../chunks/CVV7PiZW.js";import{U as Nt}from"../chunks/D9OO-6zb.js";import{C as Jt}from"../chunks/v23htMxj.js";import{E as Zt}from"../chunks/Du7u80LR.js";import{T as Kt}from"../chunks/jg_9Tfj_.js";import{X as Ot}from"../chunks/Z30GsDLy.js";import{C as ba,P as ha}from"../chunks/B2ofbWwq.js";import{I as nt}from"../chunks/CFvsllsx.js";import{s as Se}from"../chunks/CXhoiRHA.js";import{F as Qt}from"../chunks/BOk7XFuN.js";import{A as xa}from"../chunks/BauqxaN6.js";import{S as ka}from"../chunks/sA2ACGqx.js";import{d as wa,S as Pa}from"../chunks/5fA7gCJ-.js";import{P as za}from"../chunks/iyOaMzGm.js";var Sa=f('<span class="expiry-badge svelte-1jbgj2g"> </span>'),Ea=(P,s)=>s.onView(s.policy.id),Ia=(P,s)=>s.onDelete(s.policy.id,s.policy.policy_number||"esta póliza"),ja=f('<div class="policy-card svelte-1jbgj2g"><div class="card-header svelte-1jbgj2g"><span class="card-number svelte-1jbgj2g"> </span> <!></div> <div class="card-body svelte-1jbgj2g"><div class="policy-number svelte-1jbgj2g"> </div> <div class="policy-type svelte-1jbgj2g"> </div> <div class="card-info svelte-1jbgj2g"><div class="info-item svelte-1jbgj2g"><!> <span> </span></div> <div class="info-item svelte-1jbgj2g"><!> <span> </span> <!></div></div></div> <div class="card-actions svelte-1jbgj2g"><button class="action-btn svelte-1jbgj2g" title="Ver"><!></button> <button class="action-btn danger svelte-1jbgj2g" title="Eliminar"><!></button></div></div>');function Ca(P,s){Mt(s,!0);function u(M,Q){return M?new Date(Q)<new Date?{variant:"warning",label:"Vencida"}:{variant:"success",label:"Activa"}:{variant:"error",label:"Inactiva"}}function z(M){const Q=new Date,W=new Date(M);return Math.ceil((W.getTime()-Q.getTime())/(1e3*60*60*24))}function F(M){return new Date(M).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}const m=H(()=>u(s.policy.active,s.policy.expiry_date)),o=H(()=>z(s.policy.expiry_date)),ee=H(()=>s.policy.client?`${s.policy.client.first_name} ${s.policy.client.last_name}`:"Cliente no disponible");var N=ja(),k=a(N),re=a(k),se=a(re);t(re);var p=r(re,2);Xt(p,{get variant(){return e(m).variant},children:(M,Q)=>{Ye();var W=qe();T(()=>x(W,e(m).label)),n(M,W)},$$slots:{default:!0}}),t(k);var O=r(k,2),_e=a(O),me=a(_e,!0);t(_e);var oe=r(_e,2),U=a(oe,!0);t(oe);var Ee=r(oe,2),ge=a(Ee),De=a(ge);Nt(De,{size:14});var Ie=r(De,2),h=a(Ie,!0);t(Ie),t(ge);var V=r(ge,2),le=a(V);Jt(le,{size:14});var b=r(le,2),D=a(b,!0);t(b);var ne=r(b,2);{var $=M=>{var Q=Sa(),W=a(Q);t(Q),T(()=>x(W,`${e(o)??""}d`)),n(M,Q)};E(ne,M=>{e(o)<=30&&e(o)>0&&M($)})}t(V),t(Ee),t(O);var ve=r(O,2),L=a(ve);L.__click=[Ea,s];var be=a(L);Zt(be,{size:16}),t(L);var X=r(L,2);X.__click=[Ia,s];var te=a(X);Kt(te,{size:16}),t(X),t(ve),t(N),T(M=>{x(se,`#${s.index+1}`),x(me,s.policy.policy_number||"S/N"),x(U,s.policy.policy_type),x(h,e(ee)),x(D,M)},[()=>F(s.policy.expiry_date)]),n(P,N),At()}Ct(["click"]);var Ma=(P,s,u)=>s(e(u).value),Aa=f('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),Ta=(P,s,u)=>s(e(u).value),Fa=f('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),Da=(P,s,u)=>s(e(u)),Va=f('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),Ba=(P,s,u)=>s(e(u).value),Na=f('<label class="checkbox-item svelte-1cif4vt"><input type="checkbox" class="svelte-1cif4vt"/> <span class="svelte-1cif4vt"> </span></label>'),Oa=f("<!> Aplicar <!>",1),Ua=f('<div class="backdrop svelte-1cif4vt"></div> <div class="filter-panel svelte-1cif4vt"><div class="filter-header svelte-1cif4vt"><h3 class="svelte-1cif4vt">Filtros</h3> <button class="close-btn svelte-1cif4vt"><!></button></div> <div class="filter-content svelte-1cif4vt"><div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Tipo de Póliza</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Forma de Pago</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Aseguradora</h4> <div class="checkbox-list svelte-1cif4vt"></div></div> <div class="filter-section svelte-1cif4vt"><h4 class="svelte-1cif4vt">Estado</h4> <div class="checkbox-list svelte-1cif4vt"></div></div></div> <div class="filter-footer svelte-1cif4vt"><!> <!></div></div>',1);function La(P,s){var Ie,h,V,le;Mt(s,!0);const u={policyTypes:[],paymentModes:[],insurers:[],statuses:[]};let z=C(Ae(((Ie=s.initialFilters)==null?void 0:Ie.policyTypes)||u.policyTypes)),F=C(Ae(((h=s.initialFilters)==null?void 0:h.paymentModes)||u.paymentModes)),m=C(Ae(((V=s.initialFilters)==null?void 0:V.insurers)||u.insurers)),o=C(Ae(((le=s.initialFilters)==null?void 0:le.statuses)||u.statuses));const ee=[{value:"auto",label:"Auto"},{value:"home",label:"Hogar"},{value:"life",label:"Vida"},{value:"health",label:"Salud"},{value:"business",label:"Empresa"},{value:"other",label:"Otro"}],N=[{value:"monthly",label:"Mensual"},{value:"quarterly",label:"Trimestral"},{value:"semi-annual",label:"Semestral"},{value:"annual",label:"Anual"}],k=[{value:"active",label:"Activa"},{value:"inactive",label:"Inactiva"},{value:"expiring_soon",label:"Por vencer"},{value:"expired",label:"Vencida"}],re=["Mapfre","AXA","Allianz","Generali","Zurich"];function se(b){e(z).includes(b)?i(z,e(z).filter(D=>D!==b),!0):i(z,[...e(z),b],!0)}function p(b){e(F).includes(b)?i(F,e(F).filter(D=>D!==b),!0):i(F,[...e(F),b],!0)}function O(b){e(m).includes(b)?i(m,e(m).filter(D=>D!==b),!0):i(m,[...e(m),b],!0)}function _e(b){e(o).includes(b)?i(o,e(o).filter(D=>D!==b),!0):i(o,[...e(o),b],!0)}function me(){i(z,[],!0),i(F,[],!0),i(m,[],!0),i(o,[],!0)}function oe(){s.onApply({policyTypes:e(z),paymentModes:e(F),insurers:e(m),statuses:e(o)}),s.onClose()}const U=H(()=>()=>e(z).length+e(F).length+e(m).length+e(o).length);var Ee=Qe(),ge=K(Ee);{var De=b=>{var D=Ua(),ne=K(D);ne.__click=function(...I){var w;(w=s.onClose)==null||w.apply(this,I)};var $=r(ne,2),ve=a($),L=r(a(ve),2);L.__click=function(...I){var w;(w=s.onClose)==null||w.apply(this,I)};var be=a(L);Ot(be,{size:20}),t(L),t(ve);var X=r(ve,2),te=a(X),M=r(a(te),2);Te(M,21,()=>ee,Fe,(I,w)=>{var j=Aa(),S=a(j);vt(S),S.__change=[Ma,se,w];var J=r(S,2),ie=a(J,!0);t(J),t(j),T(d=>{It(S,d),x(ie,e(w).label)},[()=>e(z).includes(e(w).value)]),n(I,j)}),t(M),t(te);var Q=r(te,2),W=r(a(Q),2);Te(W,21,()=>N,Fe,(I,w)=>{var j=Fa(),S=a(j);vt(S),S.__change=[Ta,p,w];var J=r(S,2),ie=a(J,!0);t(J),t(j),T(d=>{It(S,d),x(ie,e(w).label)},[()=>e(F).includes(e(w).value)]),n(I,j)}),t(W),t(Q);var ue=r(Q,2),He=r(a(ue),2);Te(He,21,()=>re,Fe,(I,w)=>{var j=Va(),S=a(j);vt(S),S.__change=[Da,O,w];var J=r(S,2),ie=a(J,!0);t(J),t(j),T(d=>{It(S,d),x(ie,e(w))},[()=>e(m).includes(e(w))]),n(I,j)}),t(He),t(ue);var Ve=r(ue,2),Be=r(a(Ve),2);Te(Be,21,()=>k,Fe,(I,w)=>{var j=Na(),S=a(j);vt(S),S.__change=[Ba,_e,w];var J=r(S,2),ie=a(J,!0);t(J),t(j),T(d=>{It(S,d),x(ie,e(w).label)},[()=>e(o).includes(e(w).value)]),n(I,j)}),t(Be),t(Ve),t(X);var Ne=r(X,2),je=a(Ne);mt(je,{variant:"ghost",size:"sm",onclick:me,children:(I,w)=>{Ye();var j=qe("Limpiar todo");n(I,j)},$$slots:{default:!0}});var $e=r(je,2);mt($e,{variant:"primary",onclick:oe,children:(I,w)=>{var j=Oa(),S=K(j);ba(S,{size:18});var J=r(S,2);{var ie=d=>{var g=qe();T(B=>x(g,`(${B??""})`),[()=>e(U)()]),n(d,g)};E(J,d=>{e(U)()>0&&d(ie)})}n(I,j)},$$slots:{default:!0}}),t(Ne),t($),n(b,D)};E(ge,b=>{s.open&&b(De)})}n(P,Ee),At()}Ct(["click","change"]);var Ra=(P,s)=>s.onClose(),Ga=(P,s,u)=>{const z=s().url.searchParams.get("fromId");z&&(u.onClose(),We(`/clientes?clientId=${z}&mode=view`))},qa=f('<button class="back-btn svelte-1yt9re3" title="Volver a cliente"><!></button>'),Ha=f('<p class="subtitle svelte-1yt9re3"> </p>'),$a=f('<button class="icon-btn svelte-1yt9re3" title="Edit policy"><!></button>'),Xa=(P,s)=>s.onClose(),Ja=f('<div class="loading-state svelte-1yt9re3"><p class="svelte-1yt9re3">Cargando detalles de póliza...</p></div>'),Za=f('<option class="svelte-1yt9re3">Cargando...</option>'),Ka=f('<option class="svelte-1yt9re3">No hay aseguradoras disponibles</option>'),Qa=f('<option class="svelte-1yt9re3"> </option>'),Wa=f('<option class="svelte-1yt9re3">Seleccionar aseguradora</option> <!>',1),Ya=f('<span class="error-text svelte-1yt9re3"> </span>'),er=f('<section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Información del Vehículo</h3> <div class="form-field svelte-1yt9re3"><label for="vehicle_plate" class="svelte-1yt9re3">Patente</label> <!></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="vehicle_brand" class="svelte-1yt9re3">Marca</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="vehicle_model" class="svelte-1yt9re3">Modelo</label> <!></div></div></section>'),tr=(P,s)=>e(s)&&We(`/clientes?clientId=${e(s).client_id}`),ar=f('<section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Cliente</h3> <div class="client-card svelte-1yt9re3"><div class="client-icon svelte-1yt9re3"><!></div> <div class="client-info svelte-1yt9re3"><div class="client-name svelte-1yt9re3"> </div> <button type="button" class="link-btn svelte-1yt9re3">Ver cliente →</button></div></div></section>'),rr=f('<textarea id="observations" rows="4" placeholder="Observaciones adicionales..." class="svelte-1yt9re3"></textarea>'),sr=f('<p class="field-value preserve-whitespace svelte-1yt9re3"> </p>'),lr=f('<form class="svelte-1yt9re3"><section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Información de la Póliza</h3> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="policy_number" class="svelte-1yt9re3">Número de Póliza</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="policy_type" class="svelte-1yt9re3">Tipo de Póliza</label> <select id="policy_type" class="svelte-1yt9re3"><option class="svelte-1yt9re3">Auto</option><option class="svelte-1yt9re3">Hogar</option><option class="svelte-1yt9re3">Vida</option><option class="svelte-1yt9re3">Salud</option><option class="svelte-1yt9re3">Empresa</option><option class="svelte-1yt9re3">Otro</option></select></div></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="insurer" class="svelte-1yt9re3">Aseguradora</label> <select id="insurer" class="svelte-1yt9re3"><!></select> <!></div> <div class="form-field svelte-1yt9re3"><label for="payment_mode" class="svelte-1yt9re3">Forma de Pago</label> <select id="payment_mode" class="svelte-1yt9re3"><option class="svelte-1yt9re3">Mensual</option><option class="svelte-1yt9re3">Trimestral</option><option class="svelte-1yt9re3">Semestral</option><option class="svelte-1yt9re3">Anual</option></select></div></div> <div class="form-row svelte-1yt9re3"><div class="form-field svelte-1yt9re3"><label for="start_date" class="svelte-1yt9re3">Fecha de Inicio</label> <!></div> <div class="form-field svelte-1yt9re3"><label for="expiry_date" class="svelte-1yt9re3">Fecha de Vencimiento</label> <!></div></div></section> <!>  <!> <section class="form-section svelte-1yt9re3"><h3 class="svelte-1yt9re3">Observaciones</h3> <div class="form-field svelte-1yt9re3"><!></div></section></form>'),ir=f("<!> Guardar Cambios",1),or=f('<div class="modal-footer svelte-1yt9re3"><!> <!></div>'),nr=f('<div class="backdrop svelte-1yt9re3"></div> <div class="modal-panel svelte-1yt9re3"><div class="modal-header svelte-1yt9re3"><div class="header-content svelte-1yt9re3"><!> <div class="icon-wrapper svelte-1yt9re3"><!></div> <div class="svelte-1yt9re3"><h2 class="svelte-1yt9re3"><!></h2> <!></div></div> <div class="header-actions svelte-1yt9re3"><!> <button class="icon-btn svelte-1yt9re3" title="Close"><!></button></div></div> <div class="modal-content svelte-1yt9re3"><!></div> <!></div>',1);function vr(P,s){Mt(s,!0);const u=()=>Ht($t,"$page",z),[z,F]=qt();let m=da(s,"mode",3,"view"),o=C(null),ee=C(!1),N=C(!1),k=C(m()==="edit"),re=C(Ae([])),se=C(!1),p=C(Ae({policy_number:"",policy_type:"auto",insurer:"",payment_mode:"monthly",start_date:"",expiry_date:"",vehicle_plate:"",vehicle_brand:"",vehicle_model:"",observations:""})),O=C(Ae({}));Bt(()=>{_e()}),Bt(()=>{s.policyId&&(i(k,m()==="edit"),me())});async function _e(){i(se,!0);try{const h=await fetch("/api/insurance-companies"),V=await h.json();h.ok?i(re,V.companies||[],!0):console.error("Error loading insurers:",V.message)}catch(h){console.error("Error loading insurers:",h)}finally{i(se,!1)}}async function me(){var h,V,le,b,D,ne,$,ve,L,be;if(s.policyId){i(ee,!0);try{const X=await fetch(`/api/policies/${s.policyId}`),te=await X.json();X.ok?(i(o,te.policy,!0),i(p,{policy_number:((h=e(o))==null?void 0:h.policy_number)||"",policy_type:((V=e(o))==null?void 0:V.policy_type)||"auto",insurer:((le=e(o))==null?void 0:le.insurer)||"",payment_mode:((b=e(o))==null?void 0:b.payment_mode)||"monthly",start_date:((D=e(o))==null?void 0:D.start_date)||"",expiry_date:((ne=e(o))==null?void 0:ne.expiry_date)||"",vehicle_plate:(($=e(o))==null?void 0:$.vehicle_plate)||"",vehicle_brand:((ve=e(o))==null?void 0:ve.vehicle_brand)||"",vehicle_model:((L=e(o))==null?void 0:L.vehicle_model)||"",observations:((be=e(o))==null?void 0:be.observations)||""},!0)):(Se({type:"error",message:"Error loading policy"}),s.onClose())}catch{Se({type:"error",message:"Error loading policy"}),s.onClose()}finally{i(ee,!1)}}}async function oe(){if(s.policyId){i(N,!0),i(O,{},!0);try{const h=await fetch(`/api/policies/${s.policyId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e(p))}),V=await h.json();h.ok?(Se({type:"success",message:"Policy updated successfully"}),i(k,!1),await me(),s.onClose(!0)):(V.errors&&i(O,V.errors,!0),Se({type:"error",message:V.message||"Error updating policy"}))}catch{Se({type:"error",message:"Error updating policy"})}finally{i(N,!1)}}}function U(){i(k,!e(k)),!e(k)&&e(o)&&(i(p,{policy_number:e(o).policy_number||"",policy_type:e(o).policy_type||"auto",insurer:e(o).insurer||"",payment_mode:e(o).payment_mode||"monthly",start_date:e(o).start_date||"",expiry_date:e(o).expiry_date||"",vehicle_plate:e(o).vehicle_plate||"",vehicle_brand:e(o).vehicle_brand||"",vehicle_model:e(o).vehicle_model||"",observations:e(o).observations||""},!0),i(O,{},!0))}const Ee={auto:"Auto",home:"Hogar",life:"Vida",health:"Salud",business:"Empresa",other:"Otro"};var ge=Qe(),De=K(ge);{var Ie=h=>{var V=nr(),le=K(V);le.__click=[Ra,s];var b=r(le,2),D=a(b),ne=a(D),$=a(ne);{var ve=d=>{var g=qa();g.__click=[Ga,u,s];var B=a(g);xa(B,{size:20}),t(g),n(d,g)};E($,d=>{u().url.searchParams.get("from")==="client"&&d(ve)})}var L=r($,2),be=a(L);Qt(be,{size:24}),t(L);var X=r(L,2),te=a(X),M=a(te);{var Q=d=>{var g=qe("Cargando...");n(d,g)},W=d=>{var g=Qe(),B=K(g);{var he=ce=>{var pe=qe();T(()=>x(pe,e(o).policy_number||"Sin número")),n(ce,pe)};E(B,ce=>{e(o)&&ce(he)},!0)}n(d,g)};E(M,d=>{e(ee)?d(Q):d(W,!1)})}t(te);var ue=r(te,2);{var He=d=>{var g=Ha(),B=a(g,!0);t(g),T(()=>x(B,Ee[e(o).policy_type])),n(d,g)};E(ue,d=>{e(o)&&!e(ee)&&d(He)})}t(X),t(ne);var Ve=r(ne,2),Be=a(Ve);{var Ne=d=>{var g=$a();g.__click=U;var B=a(g);ha(B,{size:18}),t(g),n(d,g)};E(Be,d=>{!e(k)&&!e(ee)&&d(Ne)})}var je=r(Be,2);je.__click=[Xa,s];var $e=a(je);Ot($e,{size:20}),t(je),t(Ve),t(D);var I=r(D,2),w=a(I);{var j=d=>{var g=Ja();n(d,g)},S=d=>{var g=Qe(),B=K(g);{var he=ce=>{var pe=lr(),xe=a(pe),Oe=r(a(xe),2),Xe=a(Oe),ct=r(a(Xe),2);{let _=H(()=>!e(k));nt(ct,{id:"policy_number",get error(){return e(O).policy_number},get disabled(){return e(_)},get value(){return e(p).policy_number},set value(y){e(p).policy_number=y}})}t(Xe);var fe=r(Xe,2),ye=r(a(fe),2),Je=a(ye);Je.value=Je.__value="auto";var dt=r(Je);dt.value=dt.__value="home";var et=r(dt);et.value=et.__value="life";var _t=r(et);_t.value=_t.__value="health";var l=r(_t);l.value=l.__value="business";var c=r(l);c.value=c.__value="other",t(ye),t(fe),t(Oe);var v=r(Oe,2),A=a(v),R=r(a(A),2),G=a(R);{var tt=_=>{var y=Za();y.value=y.__value="",n(_,y)},Ze=_=>{var y=Qe(),Z=K(y);{var Ce=ae=>{var Y=Ka();Y.value=Y.__value="",n(ae,Y)},ke=ae=>{var Y=Wa(),we=K(Y);we.value=we.__value="";var Me=r(we,2);Te(Me,17,()=>e(re),Fe,(Pe,de)=>{var ze=Qa(),zt=a(ze,!0);t(ze);var St={};T(()=>{x(zt,e(de).name),St!==(St=e(de).name)&&(ze.value=(ze.__value=e(de).name)??"")}),n(Pe,ze)}),n(ae,Y)};E(Z,ae=>{e(re).length===0?ae(Ce):ae(ke,!1)},!0)}n(_,y)};E(G,_=>{e(se)?_(tt):_(Ze,!1)})}t(R);var ut=r(R,2);{var Tt=_=>{var y=Ya(),Z=a(y,!0);t(y),T(()=>x(Z,e(O).insurer)),n(_,y)};E(ut,_=>{e(O).insurer&&_(Tt)})}t(A);var gt=r(A,2),Ue=r(a(gt),2),at=a(Ue);at.value=at.__value="monthly";var Le=r(at);Le.value=Le.__value="quarterly";var Re=r(Le);Re.value=Re.__value="semi-annual";var bt=r(Re);bt.value=bt.__value="annual",t(Ue),t(gt),t(v);var q=r(v,2),pt=a(q),ht=r(a(pt),2);{let _=H(()=>!e(k));nt(ht,{id:"start_date",type:"date",get error(){return e(O).start_date},get disabled(){return e(_)},get value(){return e(p).start_date},set value(y){e(p).start_date=y}})}t(pt);var Ge=r(pt,2),Ft=r(a(Ge),2);{let _=H(()=>!e(k));nt(Ft,{id:"expiry_date",type:"date",get error(){return e(O).expiry_date},get disabled(){return e(_)},get value(){return e(p).expiry_date},set value(y){e(p).expiry_date=y}})}t(Ge),t(q),t(xe);var rt=r(xe,2);{var xt=_=>{var y=er(),Z=r(a(y),2),Ce=r(a(Z),2);{let Pe=H(()=>!e(k));nt(Ce,{id:"vehicle_plate",get error(){return e(O).vehicle_plate},get disabled(){return e(Pe)},get value(){return e(p).vehicle_plate},set value(de){e(p).vehicle_plate=de}})}t(Z);var ke=r(Z,2),ae=a(ke),Y=r(a(ae),2);{let Pe=H(()=>!e(k));nt(Y,{id:"vehicle_brand",get error(){return e(O).vehicle_brand},get disabled(){return e(Pe)},get value(){return e(p).vehicle_brand},set value(de){e(p).vehicle_brand=de}})}t(ae);var we=r(ae,2),Me=r(a(we),2);{let Pe=H(()=>!e(k));nt(Me,{id:"vehicle_model",get error(){return e(O).vehicle_model},get disabled(){return e(Pe)},get value(){return e(p).vehicle_model},set value(de){e(p).vehicle_model=de}})}t(we),t(ke),t(y),n(_,y)};E(rt,_=>{(e(o).policy_type==="auto"||e(k))&&_(xt)})}var st=r(rt,2);{var ft=_=>{var y=ar(),Z=r(a(y),2),Ce=a(Z),ke=a(Ce);Nt(ke,{size:20}),t(Ce);var ae=r(Ce,2),Y=a(ae),we=a(Y,!0);t(Y);var Me=r(Y,2);Me.__click=[tr,o],t(ae),t(Z),t(y),T(()=>x(we,e(o).client_full_name||"Sin nombre")),n(_,y)};E(st,_=>{!e(k)&&e(o).client&&!u().url.searchParams.get("from")&&_(ft)})}var kt=r(st,2),lt=r(a(kt),2),wt=a(lt);{var Pt=_=>{var y=rr();la(y),Gt(y,()=>e(p).observations,Z=>e(p).observations=Z),n(_,y)},yt=_=>{var y=sr(),Z=a(y,!0);t(y),T(()=>x(Z,e(o).observations||"Sin observaciones")),n(_,y)};E(wt,_=>{e(k)?_(Pt):_(yt,!1)})}t(lt),t(kt),t(pe),T(()=>{ye.disabled=!e(k),R.disabled=!e(k)||e(se),Ue.disabled=!e(k)}),sa("submit",pe,_=>{_.preventDefault(),oe()}),jt(ye,()=>e(p).policy_type,_=>e(p).policy_type=_),jt(R,()=>e(p).insurer,_=>e(p).insurer=_),jt(Ue,()=>e(p).payment_mode,_=>e(p).payment_mode=_),n(ce,pe)};E(B,ce=>{e(o)&&ce(he)},!0)}n(d,g)};E(w,d=>{e(ee)?d(j):d(S,!1)})}t(I);var J=r(I,2);{var ie=d=>{var g=or(),B=a(g);mt(B,{variant:"ghost",onclick:U,get disabled(){return e(N)},children:(ce,pe)=>{Ye();var xe=qe("Cancelar");n(ce,xe)},$$slots:{default:!0}});var he=r(B,2);mt(he,{variant:"primary",onclick:oe,get disabled(){return e(N)},children:(ce,pe)=>{var xe=Qe(),Oe=K(xe);{var Xe=fe=>{var ye=qe("Guardando...");n(fe,ye)},ct=fe=>{var ye=ir(),Je=K(ye);ka(Je,{size:18}),Ye(),n(fe,ye)};E(Oe,fe=>{e(N)?fe(Xe):fe(ct,!1)})}n(ce,xe)},$$slots:{default:!0}}),t(g),n(d,g)};E(J,d=>{e(k)&&!e(ee)&&d(ie)})}t(b),n(h,V)};E(De,h=>{s.policyId&&h(Ie)})}n(P,ge),At(),F()}Ct(["click"]);function cr(P,s,u,z,F){i(s,e(s)==="asc"?"desc":"asc",!0),i(u,1),i(z,[],!0),F()}function dr(P,s,u,z,F){i(s,{policyTypes:[],paymentModes:[],insurers:[],statuses:[]},!0),i(u,1),i(z,[],!0),F()}var _r=f("<!> Nueva Póliza",1),ur=(P,s,u,z,F)=>{localStorage.setItem("policies_show_inactive",e(s).toString()),i(u,1),i(z,[],!0),F()},pr=(P,s)=>i(s,!e(s)),fr=f('<span class="filter-badge svelte-17pngxe"> </span>'),yr=f('<button class="clear-filters-btn svelte-17pngxe" title="Limpiar filtros"><!></button>'),mr=(P,s,u,z)=>{i(s,1),i(u,[],!0),z()},gr=f('<option class="svelte-17pngxe"> </option>'),br=f('<span class="count-skeleton svelte-17pngxe"></span>'),hr=f('<span class="count-text svelte-17pngxe"> </span> <span class="count-separator svelte-17pngxe">/</span> <span class="count-total svelte-17pngxe"> </span>',1),xr=f('<div class="skeleton-list svelte-17pngxe"></div>'),kr=(P,s,u)=>s(e(u).id,"view"),wr=(P,s)=>We(`/clientes?clientId=${e(s).client_id}&mode=view&from=policy&fromId=${e(s).id}`),Pr=f('<span class="expiry-badge svelte-17pngxe"> </span>'),zr=(P,s,u)=>s(e(u).id,"view"),Sr=(P,s,u)=>s(e(u).id,e(u).policy_number||"esta póliza"),Er=f('<tr class="svelte-17pngxe"><td class="row-number svelte-17pngxe"></td><td class="svelte-17pngxe"><button class="policy-number-btn svelte-17pngxe"> </button></td><td class="svelte-17pngxe"><div class="client-info svelte-17pngxe"><!> <button class="client-link-btn svelte-17pngxe"> </button></div></td><td class="svelte-17pngxe"><span class="insurer-name svelte-17pngxe"> </span></td><td class="svelte-17pngxe"> </td><td class="svelte-17pngxe"><!></td><td class="svelte-17pngxe"><div class="expiry-info svelte-17pngxe"><!> <span> </span> <!></div></td><td class="text-nowrap svelte-17pngxe"> </td><td class="text-right svelte-17pngxe"><div class="actions svelte-17pngxe"><button class="action-btn svelte-17pngxe" title="Ver"><!></button> <button class="action-btn danger svelte-17pngxe" title="Eliminar"><!></button></div></td></tr>'),Ir=f('<thead class="sticky-header svelte-17pngxe"><tr class="svelte-17pngxe"><th style="width: 60px" class="svelte-17pngxe">#</th><th class="svelte-17pngxe">N° Póliza</th><th class="svelte-17pngxe">Cliente</th><th class="svelte-17pngxe">Aseguradora</th><th class="svelte-17pngxe">Tipo</th><th class="svelte-17pngxe">Estado</th><th class="svelte-17pngxe">Vencimiento</th><th class="svelte-17pngxe">Creado</th><th class="text-right svelte-17pngxe">Acciones</th></tr></thead> <tbody class="svelte-17pngxe"></tbody>',1),jr=f('<div class="cards-grid svelte-17pngxe"></div> <div class="table-container svelte-17pngxe"><!></div> <!>',1),Cr=f('<div class="page svelte-17pngxe"><div class="page-header svelte-17pngxe"><div class="svelte-17pngxe"><h1 class="svelte-17pngxe">Pólizas</h1> <p class="svelte-17pngxe">Gestiona todas las pólizas de seguros</p></div> <!></div> <div class="filters-toolbar svelte-17pngxe"><div class="search-box svelte-17pngxe"><!> <input type="text" placeholder="Buscar pólizas..." class="svelte-17pngxe"/></div> <div class="toolbar-actions svelte-17pngxe"><div class="filter-checkbox svelte-17pngxe"><label class="checkbox-label svelte-17pngxe"><input type="checkbox" class="svelte-17pngxe"/> <span class="svelte-17pngxe">Mostrar inactivas</span></label></div> <button title="Filtros"><!> <!></button> <!> <div class="sort-select svelte-17pngxe"><label for="sort-by" class="svelte-17pngxe">Ordenar por:</label> <select id="sort-by" class="svelte-17pngxe"></select> <button class="sort-order-btn svelte-17pngxe"><!></button></div> <div class="results-count svelte-17pngxe"><!></div></div></div> <!></div> <!> <!>',1);function is(P,s){Mt(s,!0);const u=()=>Ht($t,"$page",z),[z,F]=qt();let m=C(Ae([])),o=C(!0),ee=C(!1),N=C(""),k=C("created_at"),re=C("desc"),se=C(!1),p=C(1),O=30,_e=C(0),me=C(!0),oe=C(!1),U=C(Ae({policyTypes:[],paymentModes:[],insurers:[],statuses:[]})),Ee=H(()=>u().url.searchParams.get("policyId")),ge=H(()=>u().url.searchParams.get("mode")||"view");const De=[{value:"created_at",label:"Fecha de creación"},{value:"expiry_date",label:"Fecha de vencimiento"},{value:"policy_number",label:"Número de póliza"},{value:"policy_type",label:"Tipo de póliza"},{value:"insurer",label:"Aseguradora"},{value:"payment_mode",label:"Forma de pago"}];ra(()=>{const l=localStorage.getItem("policies_show_inactive");l!==null&&i(se,l==="true"),h()});const Ie=wa(()=>{i(p,1),i(m,[],!0),h()},300);Bt(()=>{e(N)!==void 0&&Ie()});async function h(l=!1){var c;l?i(ee,!0):i(o,!0);try{const v=new URLSearchParams({page:e(p).toString(),limit:O.toString(),sortBy:e(k),sortOrder:e(re)});e(N)&&v.append("search",e(N)),e(se)||v.append("active_only","true"),e(U).policyTypes.forEach(G=>{v.append("policy_type",G)}),e(U).paymentModes.forEach(G=>{v.append("payment_mode",G)}),e(U).insurers.forEach(G=>{v.append("insurer",G)}),e(U).statuses.forEach(G=>{v.append("status",G)});const A=await fetch(`/api/policies?${v}`);console.log("Response status:",A.status);const R=await A.json();console.log("Result:",R),A.ok?(l?i(m,[...e(m),...R.policies||[]],!0):i(m,R.policies||[],!0),i(_e,((c=R.pagination)==null?void 0:c.total)||0,!0),i(me,e(m).length<e(_e))):(Se({type:"error",message:R.message||"Error al cargar pólizas"}),i(m,[],!0))}catch(v){console.error("Error loading policies:",v),Se({type:"error",message:"Error al cargar pólizas"}),i(m,[],!0)}finally{i(o,!1),i(ee,!1)}}function V(){!e(o)&&!e(ee)&&e(me)&&(na(p),h(!0))}async function le(l,c){if(confirm(`¿Seguro que deseas eliminar la póliza ${c}?`))try{const v=await fetch(`/api/policies/${l}`,{method:"DELETE"});if(v.ok)Se({type:"success",message:"Póliza eliminada"}),h();else{const A=await v.json();Se({type:"error",message:A.message})}}catch{Se({type:"error",message:"Error al eliminar"})}}function b(l){return new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}function D(l,c){return l?new Date(c)<new Date?{variant:"warning",label:"Vencida"}:{variant:"success",label:"Activa"}:{variant:"error",label:"Inactiva"}}function ne(l){const c=new Date,v=new Date(l);return Math.ceil((v.getTime()-c.getTime())/(1e3*60*60*24))}const $=H(()=>()=>{let l=0;return l+=e(U).policyTypes.length,l+=e(U).paymentModes.length,l+=e(U).insurers.length,l+=e(U).statuses.length,l});function ve(l){i(U,l,!0),i(p,1),i(m,[],!0),h()}function L(l,c="view"){const v=new URL(window.location.href);v.searchParams.set("policyId",l),v.searchParams.set("mode",c),We(v.pathname+v.search,{replaceState:!1,noScroll:!0})}function be(l){const c=new URL(window.location.href);c.searchParams.delete("policyId"),c.searchParams.delete("mode"),We(c.pathname+c.search,{replaceState:!1,noScroll:!0}),l&&(i(p,1),i(m,[],!0),h())}var X=Cr();ia(l=>{oa.title="Pólizas - PAS Manager"});var te=K(X),M=a(te),Q=r(a(M),2);mt(Q,{variant:"primary",onclick:()=>We("/polizas/nuevo"),children:(l,c)=>{var v=_r(),A=K(v);za(A,{size:18}),Ye(),n(l,v)},$$slots:{default:!0}}),t(M);var W=r(M,2),ue=a(W),He=a(ue);Pa(He,{size:20});var Ve=r(He,2);vt(Ve),t(ue);var Be=r(ue,2),Ne=a(Be),je=a(Ne),$e=a(je);vt($e),$e.__change=[ur,se,p,m,h],Ye(2),t(je),t(Ne);var I=r(Ne,2);let w;I.__click=[pr,oe];var j=a(I);pa(j,{size:18});var S=r(j,2);{var J=l=>{var c=fr(),v=a(c,!0);t(c),T(A=>x(v,A),[()=>e($)()]),n(l,c)};E(S,l=>{e($)()>0&&l(J)})}t(I);var ie=r(I,2);{var d=l=>{var c=yr();c.__click=[dr,U,p,m,h];var v=a(c);Ot(v,{size:18}),t(c),n(l,c)};E(ie,l=>{e($)()>0&&l(d)})}var g=r(ie,2),B=r(a(g),2);B.__change=[mr,p,m,h],Te(B,21,()=>De,Fe,(l,c)=>{var v=gr(),A=a(v,!0);t(v);var R={};T(()=>{x(A,e(c).label),R!==(R=e(c).value)&&(v.value=(v.__value=e(c).value)??"")}),n(l,v)}),t(B);var he=r(B,2);he.__click=[cr,re,p,m,h];var ce=a(he);{var pe=l=>{fa(l,{size:16})},xe=l=>{ya(l,{size:16})};E(ce,l=>{e(re)==="asc"?l(pe):l(xe,!1)})}t(he),t(g);var Oe=r(g,2),Xe=a(Oe);{var ct=l=>{var c=br();n(l,c)},fe=l=>{var c=hr(),v=K(c),A=a(v,!0);t(v);var R=r(v,4),G=a(R,!0);t(R),T(()=>{x(A,e(m).length),x(G,e(_e))}),n(l,c)};E(Xe,l=>{e(o)&&e(m).length===0?l(ct):l(fe,!1)})}t(Oe),t(Be),t(W);var ye=r(W,2);{var Je=l=>{var c=xr();Te(c,20,()=>Array(5),Fe,(v,A)=>{ma(v,{height:"60px"})}),t(c),n(l,c)},dt=l=>{var c=Qe(),v=K(c);{var A=G=>{{let tt=H(()=>e(N)||e($)()>0?"No se encontraron resultados":"Comienza agregando tu primera póliza"),Ze=H(()=>e(N)||e($)()>0?void 0:{label:"Nueva Póliza",onclick:()=>We("/polizas/nuevo")});ua(G,{get icon(){return Qt},title:"No hay pólizas",get description(){return e(tt)},get action(){return e(Ze)}})}},R=G=>{var tt=jr(),Ze=K(tt);Te(Ze,21,()=>e(m),Fe,(Ue,at,Le)=>{Ca(Ue,{get policy(){return e(at)},index:Le,onView:Re=>L(Re,"view"),onDelete:le})}),t(Ze);var ut=r(Ze,2),Tt=a(ut);_a(Tt,{children:(Ue,at)=>{var Le=Ir(),Re=r(K(Le),2);Te(Re,21,()=>e(m),Fe,(bt,q,pt)=>{const ht=H(()=>D(e(q).active,e(q).expiry_date)),Ge=H(()=>ne(e(q).expiry_date)),Ft=H(()=>e(q).client?`${e(q).client.first_name} ${e(q).client.last_name}`:"Cliente no disponible");var rt=Er(),xt=a(rt);xt.textContent=pt+1;var st=r(xt),ft=a(st);ft.__click=[kr,L,q];var kt=a(ft,!0);t(ft),t(st);var lt=r(st),wt=a(lt),Pt=a(wt);Nt(Pt,{size:14});var yt=r(Pt,2);yt.__click=[wr,q];var _=a(yt,!0);t(yt),t(wt),t(lt);var y=r(lt),Z=a(y),Ce=a(Z,!0);t(Z),t(y);var ke=r(y),ae=a(ke,!0);t(ke);var Y=r(ke),we=a(Y);Xt(we,{get variant(){return e(ht).variant},children:(Ke,it)=>{Ye();var ot=qe();T(()=>x(ot,e(ht).label)),n(Ke,ot)},$$slots:{default:!0}}),t(Y);var Me=r(Y),Pe=a(Me),de=a(Pe);Jt(de,{size:14});var ze=r(de,2);let zt;var St=a(ze,!0);t(ze);var Wt=r(ze,2);{var Yt=Ke=>{var it=Pr(),ot=a(it);t(it),T(()=>x(ot,`${e(Ge)??""}d`)),n(Ke,it)};E(Wt,Ke=>{e(Ge)<=30&&e(Ge)>0&&Ke(Yt)})}t(Pe),t(Me);var Dt=r(Me),ea=a(Dt,!0);t(Dt);var Ut=r(Dt),Lt=a(Ut),Et=a(Lt);Et.__click=[zr,L,q];var ta=a(Et);Zt(ta,{size:16}),t(Et);var Vt=r(Et,2);Vt.__click=[Sr,le,q];var aa=a(Vt);Kt(aa,{size:16}),t(Vt),t(Lt),t(Ut),t(rt),T((Ke,it,ot)=>{x(kt,e(q).policy_number||"S/N"),x(_,e(Ft)),x(Ce,e(q).insurer||"-"),x(ae,e(q).policy_type),zt=Rt(ze,1,"svelte-17pngxe",null,zt,Ke),x(St,it),x(ea,ot)},[()=>({warning:e(Ge)<=30&&e(Ge)>0}),()=>b(e(q).expiry_date),()=>b(e(q).created_at)]),n(bt,rt)}),t(Re),n(Ue,Le)},$$slots:{default:!0}}),t(ut);var gt=r(ut,2);ga(gt,{get hasMore(){return e(me)},onLoadMore:V}),n(G,tt)};E(v,G=>{e(m).length===0?G(A):G(R,!1)},!0)}n(l,c)};E(ye,l=>{e(o)?l(Je):l(dt,!1)})}t(te);var et=r(te,2);La(et,{get open(){return e(oe)},onClose:()=>i(oe,!1),onApply:ve,get initialFilters(){return e(U)}});var _t=r(et,2);vr(_t,{get policyId(){return e(Ee)},get mode(){return e(ge)},onClose:be}),T(l=>{w=Rt(I,1,"filter-btn svelte-17pngxe",null,w,l),va(he,"title",e(re)==="asc"?"Ascendente":"Descendente")},[()=>({active:e(oe)||e($)()>0})]),Gt(Ve,()=>e(N),l=>i(N,l)),ca($e,()=>e(se),l=>i(se,l)),jt(B,()=>e(k),l=>i(k,l)),n(P,X),At(),F()}Ct(["change","click"]);export{is as component};
