import"../chunks/CWj6FrbW.js";import{o as ke}from"../chunks/P-h-QmmT.js";import{c as Se,f as G,a as d,af as Fe,a6 as Pe,a7 as H,a8 as de,o as Oe,a2 as i,ac as n,N as h,Q as t,P as r,ag as Q,aE as we,aa as Ce,T as s,ae as W,ah as Y,aD as ze,ad as qe,aF as he,a9 as Me,ab as Ne}from"../chunks/DXalFYC5.js";import{l as Te,s as Be,p as J,a as Ee,b as Ve}from"../chunks/BkTacmYQ.js";import{g as be}from"../chunks/DboXdvGe.js";import{p as je}from"../chunks/MzzRNa-k.js";import{B as _e}from"../chunks/ey38HHQe.js";import{i as N}from"../chunks/DgS_HarA.js";import{b as ye}from"../chunks/Bf-8v-H5.js";import{I as L}from"../chunks/DYUOFKwE.js";import{S as xe}from"../chunks/CUzdHB_b.js";import{d as Ge,s as Re,r as Le,e as He,i as Je}from"../chunks/CCesXY4h.js";import{s as Ue}from"../chunks/CiAFSiaO.js";import{b as Xe}from"../chunks/BjGM86Mo.js";import{S as Ke,d as Qe}from"../chunks/DUFLD2a0.js";import{X as We}from"../chunks/C90WgwIi.js";import"../chunks/D3fhBnoc.js";import{I as Ye,s as Ze}from"../chunks/Wd1UXAwi.js";import{C as ve}from"../chunks/DD2hwmqD.js";import{s as pe}from"../chunks/ejPKeNiZ.js";import{S as ea}from"../chunks/-aJssGs5.js";import{A as aa}from"../chunks/CNwQjRCr.js";function ra(T,o){const m=Te(o,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.545.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const c=[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]];Ye(T,Be({name:"external-link"},()=>m,{get iconNode(){return c},children:(C,p)=>{var z=Se(),f=G(z);Ze(f,o,"default",{}),d(C,z)},$$slots:{default:!0}}))}function ta(T,o,m,c,C,p,z){var e;const f=T.target;n(o,f.value,!0),i(m)&&i(o)!==i(m).label&&(n(m,null),c(""),(e=C.onValueChange)==null||e.call(C,"")),p(i(o)),n(z,!0)}var sa=h('<button type="button" class="clear-btn svelte-1kxtmwo" title="Limpiar selección"><!></button>'),la=h('<div class="loading svelte-1kxtmwo">Buscando...</div>'),ia=(T,o,m)=>o(i(m)),oa=h('<span class="option-meta svelte-1kxtmwo"> </span>'),na=h('<span class="option-document svelte-1kxtmwo"> </span>'),va=h('<button type="button" class="option svelte-1kxtmwo"><div class="option-main svelte-1kxtmwo"><span class="option-label svelte-1kxtmwo"> </span> <!></div> <!></button>'),da=h('<div class="dropdown svelte-1kxtmwo"><!></div>'),ca=h('<div class="dropdown svelte-1kxtmwo"><div class="no-results svelte-1kxtmwo"><p class="svelte-1kxtmwo">No se encontraron clientes</p> <a href="/clientes/nuevo" target="_blank" class="create-link svelte-1kxtmwo"><!> Crear nuevo cliente</a></div></div>'),ua=h('<div class="error-message svelte-1kxtmwo"> </div>'),ma=h('<div class="help-text svelte-1kxtmwo">Si el cliente no existe, <a href="/clientes/nuevo" target="_blank" class="svelte-1kxtmwo">créalo primero</a></div>'),_a=h('<div><div class="input-wrapper svelte-1kxtmwo"><div class="icon-left svelte-1kxtmwo"><!></div> <input type="text" autocomplete="off" class="svelte-1kxtmwo"/> <!></div> <!> <!> <!> <!></div>');function pa(T,o){Pe(o,!0);let m=J(o,"value",15,""),c=J(o,"placeholder",3,"Buscar cliente..."),C=J(o,"error",3,""),p=J(o,"required",3,!1),z=J(o,"disabled",3,!1),f=H(""),e=H(de([])),I=H(!1),A=H(!1),S=H(null),R;ke(async()=>{m()&&await re(m())}),Oe(()=>{m()&&!i(S)?re(m()):!m()&&i(S)&&(n(S,null),n(f,""))});async function re(a){try{const l=await fetch(`/api/clients/${a}`);if(l.ok){const w=(await l.json()).client;w&&(n(S,{value:w.id,label:`${w.first_name} ${w.last_name}`,email:w.email_primary,document:w.document_number},!0),n(f,i(S).label,!0))}}catch(l){console.error("Error fetching client:",l)}}async function q(a){if(!a||a.length<2){n(e,[],!0);return}n(A,!0);try{const l=await fetch(`/api/clients/search?q=${encodeURIComponent(a)}&limit=20`);if(l.ok){const x=await l.json();n(e,x.options||[],!0)}else n(e,[],!0)}catch(l){console.error("Error searching clients:",l),n(e,[],!0)}finally{n(A,!1)}}const B=Qe(a=>{q(a)},300);function F(a){var l;n(S,a,!0),n(f,a.label,!0),m(a.value),n(I,!1),(l=o.onValueChange)==null||l.call(o,a.value)}function te(){var a;n(S,null),n(f,""),m(""),n(e,[],!0),n(I,!1),(a=o.onValueChange)==null||a.call(o,""),R==null||R.focus()}function ce(){i(f)&&!i(S)&&(B(i(f)),n(I,!0))}function ue(){setTimeout(()=>{n(I,!1)},200)}var se=_a();let oe;var le=t(se),ne=t(le),v=t(ne);Ke(v,{size:18}),s(ne);var u=r(ne,2);Le(u),u.__input=[ta,f,S,m,o,B,I],Xe(u,a=>R=a,()=>R);var b=r(u,2);{var y=a=>{var l=sa();l.__click=te;var x=t(l);We(x,{size:16}),s(l),d(a,l)};N(b,a=>{i(S)&&a(y)})}s(le);var g=r(le,2);{var E=a=>{var l=da(),x=t(l);{var w=M=>{var _=la();d(M,_)},k=M=>{var _=Se(),me=G(_);He(me,17,()=>i(e),Je,(fe,U)=>{var ie=va();ie.__click=[ia,F,U];var j=t(ie),X=t(j),K=t(X,!0);s(X);var Ie=r(X,2);{var De=ee=>{var ae=oa(),ge=t(ae,!0);s(ae),Q(()=>Y(ge,i(U).email)),d(ee,ae)};N(Ie,ee=>{i(U).email&&ee(De)})}s(j);var $e=r(j,2);{var Ae=ee=>{var ae=na(),ge=t(ae,!0);s(ae),Q(()=>Y(ge,i(U).document)),d(ee,ae)};N($e,ee=>{i(U).document&&ee(Ae)})}s(ie),Q(()=>Y(K,i(U).label)),d(fe,ie)}),d(M,_)};N(x,M=>{i(A)?M(w):M(k,!1)})}s(l),d(a,l)};N(g,a=>{i(I)&&(i(A)||i(e).length>0)&&a(E)})}var P=r(g,2);{var $=a=>{var l=ca(),x=t(l),w=r(t(x),2),k=t(w);ra(k,{size:14}),W(),s(w),s(x),s(l),d(a,l)};N(P,a=>{i(I)&&!i(A)&&i(e).length===0&&i(f).length>=2&&a($)})}var D=r(P,2);{var V=a=>{var l=ua(),x=t(l,!0);s(l),Q(()=>Y(x,C())),d(a,l)};N(D,a=>{C()&&a(V)})}var O=r(D,2);{var Z=a=>{var l=ma();d(a,l)};N(O,a=>{i(S)||a(Z)})}s(se),Q(a=>{oe=Ue(se,1,"searchable-select svelte-1kxtmwo",null,oe,a),Ge(u,i(f)),Re(u,"placeholder",c()),u.required=p(),u.disabled=z()},[()=>({error:!!C(),disabled:z()})]),we("focus",u,ce),we("blur",u,ue),d(T,se),Ce()}Fe(["input","click"]);var fa=h('<!> <small class="help-text svelte-107edav">Crea aseguradoras en Configuración → Aseguradoras</small>',1),ga=h('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Información General</h2></div> <div class="form-grid svelte-107edav"><div class="form-group svelte-107edav"><label for="client_id" class="svelte-107edav">Cliente <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="policy_number" class="svelte-107edav">Número de Póliza <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="policy_type" class="svelte-107edav">Tipo de Seguro <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="payment_mode" class="svelte-107edav">Modalidad de Pago</label> <!></div> <div class="form-group svelte-107edav"><label for="insurer_id" class="svelte-107edav">Compañía Aseguradora</label> <!></div> <div class="form-group svelte-107edav"><label for="vehicle_plate" class="svelte-107edav">Matrícula (si aplica)</label> <!></div></div>',1),ha=h('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Información Financiera</h2></div> <div class="form-grid svelte-107edav"><div class="form-group svelte-107edav"><label for="insured_sum" class="svelte-107edav">Suma Asegurada (ARS)</label> <!></div> <div class="form-group svelte-107edav"><label for="premium" class="svelte-107edav">Premio (ARS)</label> <!></div> <div class="form-group full-width svelte-107edav"><label for="accessories" class="svelte-107edav">Accesorios</label> <textarea id="accessories" placeholder="Descripción de accesorios incluidos..." rows="2" maxlength="2000" class="svelte-107edav"></textarea> <small class="help-text svelte-107edav"> </small></div> <div class="form-group full-width svelte-107edav"><label for="endorsement" class="svelte-107edav">Endoso</label> <textarea id="endorsement" placeholder="Detalles del endoso..." rows="2" maxlength="2000" class="svelte-107edav"></textarea> <small class="help-text svelte-107edav"> </small></div></div>',1),ba=h('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Fechas</h2></div> <div class="form-grid svelte-107edav"><div class="form-group svelte-107edav"><label for="start_date" class="svelte-107edav">Fecha de Inicio <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="expiry_date" class="svelte-107edav">Fecha de Vencimiento <span class="required svelte-107edav">*</span></label> <!></div> <div class="form-group svelte-107edav"><label for="review_date" class="svelte-107edav">Fecha de Revisión</label> <div style="display: flex; gap: 8px;" class="svelte-107edav"><!> <!></div> <small class="help-text svelte-107edav">Fecha sugerida para revisar la póliza antes del vencimiento</small></div></div>',1),ya=h('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Observaciones</h2></div> <div class="form-group svelte-107edav"><label for="observations" class="svelte-107edav">Observaciones</label> <textarea id="observations" placeholder="Información adicional sobre la póliza..." rows="4" maxlength="1000" class="svelte-107edav"></textarea> <small class="help-text svelte-107edav"> </small></div>',1),xa=h('<div class="card-header svelte-107edav"><h2 class="svelte-107edav">Seguimientos</h2></div> <div class="info-message svelte-107edav"><p class="svelte-107edav">ℹ️ Los seguimientos se pueden agregar después de crear la póliza</p></div>',1),wa=h("<!> ",1),ka=h('<form class="svelte-107edav"><!> <!> <!> <!> <!> <div class="form-actions svelte-107edav"><!> <!></div></form>');function Sa(T,o){Pe(o,!0);let m=J(o,"mode",3,"create"),c=J(o,"initialData",19,()=>({})),C=J(o,"loading",3,!1),p=J(o,"errors",19,()=>({})),z=H(!1),f=H(de([])),e=de({client_id:c().client_id||"",policy_number:c().policy_number||"",policy_type:c().policy_type||"",insurer_id:c().insurer_id||"",payment_mode:c().payment_mode||"",start_date:c().start_date||"",expiry_date:c().expiry_date||"",review_date:c().review_date||"",vehicle_plate:c().vehicle_plate||"",insured_sum:c().insured_sum||"",accessories:c().accessories||"",premium:c().premium||"",endorsement:c().endorsement||"",observations:c().observations||""});const I=[{value:"auto",label:"Auto"},{value:"home",label:"Hogar"},{value:"life",label:"Vida"},{value:"health",label:"Salud"},{value:"business",label:"Negocio"},{value:"other",label:"Otro"}],A=[{value:"monthly",label:"Mensual"},{value:"quarterly",label:"Trimestral"},{value:"biannual",label:"Semestral"},{value:"annual",label:"Anual"}];ke(async()=>{await S()});async function S(){n(z,!0);try{const v=await fetch("/api/insurance-companies"),u=await v.json();v.ok&&n(f,u.companies||[],!0)}catch(v){console.error("Error loading insurers:",v)}finally{n(z,!1)}}function R(){if(!e.expiry_date){pe({type:"error",message:"Primero ingresa la fecha de vencimiento"});return}const v=new Date(e.expiry_date);v.setDate(v.getDate()-30),e.review_date=v.toISOString().split("T")[0]}function re(v){v.preventDefault();const u={...e,insured_sum:e.insured_sum?parseFloat(String(e.insured_sum)):null,premium:e.premium?parseFloat(String(e.premium)):null,insurer_id:e.insurer_id||null,review_date:e.review_date||null,accessories:e.accessories||null,endorsement:e.endorsement||null,observations:e.observations||null,payment_mode:e.payment_mode||null,vehicle_plate:e.vehicle_plate||null};o.onSubmit(u)}var q=ka(),B=t(q);ve(B,{children:(v,u)=>{var b=ga(),y=r(G(b),2),g=t(y),E=r(t(g),2);pa(E,{placeholder:"Buscar cliente por nombre, email o documento...",get error(){return p().client_id},required:!0,get value(){return e.client_id},set value(_){e.client_id=_}}),s(g);var P=r(g,2),$=r(t(P),2);L($,{id:"policy_number",placeholder:"POL-2024-001",get error(){return p().policy_number},required:!0,get value(){return e.policy_number},set value(_){e.policy_number=_}}),s(P);var D=r(P,2),V=r(t(D),2);xe(V,{id:"policy_type",get options(){return I},placeholder:"Selecciona un tipo",get error(){return p().policy_type},required:!0,get value(){return e.policy_type},set value(_){e.policy_type=_}}),s(D);var O=r(D,2),Z=r(t(O),2);xe(Z,{id:"payment_mode",get options(){return A},placeholder:"Selecciona modalidad",get error(){return p().payment_mode},get value(){return e.payment_mode},set value(_){e.payment_mode=_}}),s(O);var a=r(O,2),l=r(t(a),2);{var x=_=>{L(_,{disabled:!0,placeholder:"Cargando aseguradoras..."})},w=_=>{var me=Se(),fe=G(me);{var U=j=>{var X=fa(),K=G(X);L(K,{disabled:!0,placeholder:"Sin compañías creadas"}),W(2),d(j,X)},ie=j=>{{let X=qe(()=>i(f).map(K=>({value:K.id,label:K.name})));xe(j,{id:"insurer_id",get options(){return i(X)},placeholder:"Selecciona aseguradora",get error(){return p().insurer_id},get value(){return e.insurer_id},set value(K){e.insurer_id=K}})}};N(fe,j=>{i(f).length===0?j(U):j(ie,!1)},!0)}d(_,me)};N(l,_=>{i(z)?_(x):_(w,!1)})}s(a);var k=r(a,2),M=r(t(k),2);L(M,{id:"vehicle_plate",placeholder:"ABC1234",get error(){return p().vehicle_plate},get value(){return e.vehicle_plate},set value(_){e.vehicle_plate=_}}),s(k),s(y),d(v,b)},$$slots:{default:!0}});var F=r(B,2);ve(F,{children:(v,u)=>{var b=ha(),y=r(G(b),2),g=t(y),E=r(t(g),2);L(E,{id:"insured_sum",type:"number",step:"0.01",placeholder:"0.00",get error(){return p().insured_sum},get value(){return e.insured_sum},set value(k){e.insured_sum=k}}),s(g);var P=r(g,2),$=r(t(P),2);L($,{id:"premium",type:"number",step:"0.01",placeholder:"0.00",get error(){return p().premium},get value(){return e.premium},set value(k){e.premium=k}}),s(P);var D=r(P,2),V=r(t(D),2);he(V);var O=r(V,2),Z=t(O);s(O),s(D);var a=r(D,2),l=r(t(a),2);he(l);var x=r(l,2),w=t(x);s(x),s(a),s(y),Q(()=>{var k,M;Y(Z,`${(((k=e.accessories)==null?void 0:k.length)||0)??""}/2000 caracteres`),Y(w,`${(((M=e.endorsement)==null?void 0:M.length)||0)??""}/2000 caracteres`)}),ye(V,()=>e.accessories,k=>e.accessories=k),ye(l,()=>e.endorsement,k=>e.endorsement=k),d(v,b)},$$slots:{default:!0}});var te=r(F,2);ve(te,{children:(v,u)=>{var b=ba(),y=r(G(b),2),g=t(y),E=r(t(g),2);L(E,{id:"start_date",type:"date",get error(){return p().start_date},required:!0,get value(){return e.start_date},set value(a){e.start_date=a}}),s(g);var P=r(g,2),$=r(t(P),2);L($,{id:"expiry_date",type:"date",get error(){return p().expiry_date},required:!0,get value(){return e.expiry_date},set value(a){e.expiry_date=a}}),s(P);var D=r(P,2),V=r(t(D),2),O=t(V);L(O,{id:"review_date",type:"date",get error(){return p().review_date},style:"flex: 1;",get value(){return e.review_date},set value(a){e.review_date=a}});var Z=r(O,2);{let a=qe(()=>!e.expiry_date);_e(Z,{type:"button",variant:"outline",onclick:R,get disabled(){return i(a)},children:(l,x)=>{W();var w=ze("Sugerir (30 días antes)");d(l,w)},$$slots:{default:!0}})}s(V),W(2),s(D),s(y),d(v,b)},$$slots:{default:!0}});var ce=r(te,2);ve(ce,{children:(v,u)=>{var b=ya(),y=r(G(b),2),g=r(t(y),2);he(g);var E=r(g,2),P=t(E);s(E),s(y),Q(()=>{var $;return Y(P,`${((($=e.observations)==null?void 0:$.length)||0)??""}/1000 caracteres`)}),ye(g,()=>e.observations,$=>e.observations=$),d(v,b)},$$slots:{default:!0}});var ue=r(ce,2);{var se=v=>{ve(v,{children:(u,b)=>{var y=xa();W(2),d(u,y)},$$slots:{default:!0}})};N(ue,v=>{m()==="create"&&v(se)})}var oe=r(ue,2),le=t(oe);_e(le,{type:"button",variant:"outline",get onclick(){return o.onCancel},get disabled(){return C()},children:(v,u)=>{W();var b=ze("Cancelar");d(v,b)},$$slots:{default:!0}});var ne=r(le,2);_e(ne,{type:"submit",variant:"primary",get disabled(){return C()},children:(v,u)=>{var b=wa(),y=G(b);ea(y,{size:18});var g=r(y);Q(()=>Y(g,` ${C()?"Guardando...":m()==="create"?"Guardar Póliza":"Guardar Cambios"}`)),d(v,b)},$$slots:{default:!0}}),s(oe),s(q),we("submit",q,re),d(T,q),Ce()}var Pa=h("<!> Volver",1),Ca=h('<div class="page svelte-1py8aeq"><div class="page-header svelte-1py8aeq"><div class="svelte-1py8aeq"><!> <h1 class="svelte-1py8aeq">Nueva Póliza</h1> <p class="svelte-1py8aeq">Completa los datos para registrar una nueva póliza</p></div></div> <!></div>');function Ka(T,o){Pe(o,!0);const m=()=>Ve(je,"$page",c),[c,C]=Ee();let p=H(!1),z=H(de({})),f=de({});ke(()=>{const q=m().url.searchParams.get("client_id");q&&(f.client_id=q)});async function e(q){n(p,!0),n(z,{},!0);try{const B=await fetch("/api/policies",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)}),F=await B.json();B.ok?(pe({type:"success",message:"Póliza creada exitosamente"}),be("/polizas")):(F.errors&&n(z,F.errors,!0),pe({type:"error",message:F.message||"Error al crear póliza"}))}catch{pe({type:"error",message:"Error al crear póliza"})}finally{n(p,!1)}}var I=Ca();Me(q=>{Ne.title="Nueva Póliza - PAS Manager"});var A=t(I),S=t(A),R=t(S);_e(R,{variant:"ghost",size:"sm",onclick:()=>be("/polizas"),children:(q,B)=>{var F=Pa(),te=G(F);aa(te,{size:18}),W(),d(q,F)},$$slots:{default:!0}}),W(4),s(S),s(A);var re=r(A,2);Sa(re,{mode:"create",get initialData(){return f},get loading(){return i(p)},get errors(){return i(z)},onSubmit:e,onCancel:()=>be("/polizas")}),s(I),d(T,I),Ce(),C()}export{Ka as component};
