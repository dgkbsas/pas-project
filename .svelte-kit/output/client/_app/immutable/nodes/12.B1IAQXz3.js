import"../chunks/CWj6FrbW.js";import{o as Re}from"../chunks/DFUbiISE.js";import{ag as He,a7 as Ve,a8 as E,a9 as F,b as m,aa as Ge,a as d,ab as Ke,ac as Qe,f as C,d as r,U as n,a3 as e,t as O,ad as c,af as P,r as o,aj as We,ah as D,ae as Xe,ak as pe,c as Ye}from"../chunks/BKJL6YfG.js";import{i as T}from"../chunks/CX_YFbLR.js";import{e as Ze,i as $e}from"../chunks/BpKyf_Cv.js";import{b as ea}from"../chunks/DFnROSPn.js";import{g as te}from"../chunks/EB3MSLgs.js";import{B as I}from"../chunks/PkYitcBM.js";import{I as se}from"../chunks/B3SDN7PV.js";import{P as aa,S as ta}from"../chunks/DqKn0-zz.js";import{C as sa}from"../chunks/Dltoj_Hs.js";import{s as p}from"../chunks/CqXjdqoA.js";import{A as oa}from"../chunks/cKUVvFVp.js";import{P as ra}from"../chunks/CMz8jQQe.js";import{C as ia}from"../chunks/DsZoCF9s.js";import{S as la}from"../chunks/oTZo_vNk.js";import{T as na}from"../chunks/C0O21K1o.js";var va=m("<!> Volver",1),da=m("<!> <!>",1),ca=m("<!> Agregar Seguimiento",1),ua=m('<div class="loading-text svelte-fvw11y">Cargando seguimientos...</div>'),pa=m('<div class="empty-state svelte-fvw11y"><!> <p class="svelte-fvw11y">No hay seguimientos registrados</p> <small class="svelte-fvw11y">Agrega el primer seguimiento arriba</small></div>'),fa=(N,s,h)=>s(e(h)),ma=(N,s,h)=>s(e(h).id),ya=m('<div class="followup-status svelte-fvw11y"> </div>'),_a=m('<div class="followup-description svelte-fvw11y"> </div>'),ga=m('<div class="followup-item svelte-fvw11y"><div class="followup-header svelte-fvw11y"><div class="followup-type-badge svelte-fvw11y"> </div> <div class="followup-date svelte-fvw11y"> </div> <div class="followup-actions svelte-fvw11y"><button class="action-btn svelte-fvw11y" title="Editar"><!></button> <button class="action-btn danger svelte-fvw11y" title="Eliminar"><!></button></div></div> <!> <!></div>'),wa=m('<div class="followups-list svelte-fvw11y"></div>'),ha=m('<div class="card-header svelte-fvw11y"><h2 class="svelte-fvw11y">Seguimientos</h2> <p class="subtitle svelte-fvw11y">Historial de seguimientos y novedades de la póliza</p></div> <div class="followup-form svelte-fvw11y"><h3 class="svelte-fvw11y"> </h3> <div class="form-grid svelte-fvw11y"><div class="form-group svelte-fvw11y"><label for="followup_type" class="svelte-fvw11y">Tipo <span class="required svelte-fvw11y">*</span></label> <!></div> <div class="form-group svelte-fvw11y"><label for="followup_date" class="svelte-fvw11y">Fecha <span class="required svelte-fvw11y">*</span></label> <!></div> <div class="form-group svelte-fvw11y"><label for="followup_status" class="svelte-fvw11y">Estado</label> <!></div> <div class="form-group full-width svelte-fvw11y"><label for="followup_description" class="svelte-fvw11y">Descripción</label> <textarea id="followup_description" placeholder="Describe el seguimiento..." rows="2" class="svelte-fvw11y"></textarea></div></div> <div class="form-actions svelte-fvw11y"><!></div></div> <!>',1),ba=m('<div class="page svelte-fvw11y"><div class="page-header svelte-fvw11y"><div class="svelte-fvw11y"><!> <h1 class="svelte-fvw11y">Editar Póliza</h1> <p class="svelte-fvw11y">Modifica los datos de la póliza y gestiona seguimientos</p></div></div> <!> <!></div>');function Ja(N,s){var ie,le;Ve(s,!0);let h=E(!1),U=E(!1),J=E(F([])),j=E(F([])),x=E(null),M=E(F({})),fe=F({client_id:s.data.policy.client_id||"",policy_number:s.data.policy.policy_number||"",policy_type:s.data.policy.policy_type||"",insurer_id:s.data.policy.insurer_id||"",payment_mode:s.data.policy.payment_mode||"",start_date:s.data.policy.start_date||"",expiry_date:s.data.policy.expiry_date||"",review_date:s.data.policy.review_date||"",vehicle_plate:s.data.policy.vehicle_plate||"",insured_sum:((ie=s.data.policy.insured_sum)==null?void 0:ie.toString())||"",accessories:s.data.policy.accessories||"",premium:((le=s.data.policy.premium)==null?void 0:le.toString())||"",endorsement:s.data.policy.endorsement||"",observations:s.data.policy.observations||""}),v=E(F({followup_type:"",date:new Date().toISOString().split("T")[0],description:"",status:""}));Re(async()=>{await Promise.all([q(),me()])});async function q(){c(U,!0);try{const a=await fetch(`/api/policies/${s.data.policy.id}/followups`),i=await a.json();a.ok&&c(J,i.followups||[],!0)}catch(a){console.error("Error loading followups:",a)}finally{c(U,!1)}}async function me(){try{const a=await fetch("/api/config"),i=await a.json();if(a.ok){const l=i.configs.find(b=>b.config_key==="followup_types");l!=null&&l.config_value&&c(j,Array.isArray(l.config_value)?l.config_value:[],!0)}}catch(a){console.error("Error loading followup types:",a),c(j,["Seguimiento","Reclamo","Siniestro","Renovación","Otro"],!0)}}async function ye(a){c(h,!0),c(M,{},!0);try{const i=await fetch(`/api/policies/${s.data.policy.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),l=await i.json();i.ok?(p({type:"success",message:"Póliza actualizada exitosamente"}),te("/polizas")):(l.errors&&c(M,l.errors,!0),p({type:"error",message:l.message||"Error al actualizar póliza"}))}catch{p({type:"error",message:"Error al actualizar póliza"})}finally{c(h,!1)}}async function _e(){if(!e(v).followup_type||!e(v).date){p({type:"error",message:"Tipo y fecha son requeridos"});return}try{const a=await fetch(`/api/policies/${s.data.policy.id}/followups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e(v))});if(a.ok)p({type:"success",message:"Seguimiento creado"}),B(),await q();else{const i=await a.json();p({type:"error",message:i.message||"Error al crear seguimiento"})}}catch{p({type:"error",message:"Error al crear seguimiento"})}}async function ge(a){try{const i=await fetch(`/api/followups/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e(v))});if(i.ok)p({type:"success",message:"Seguimiento actualizado"}),c(x,null),B(),await q();else{const l=await i.json();p({type:"error",message:l.message||"Error al actualizar seguimiento"})}}catch{p({type:"error",message:"Error al actualizar seguimiento"})}}async function we(a){if(confirm("¿Seguro que deseas eliminar este seguimiento?"))try{const i=await fetch(`/api/followups/${a}`,{method:"DELETE"});if(i.ok)p({type:"success",message:"Seguimiento eliminado"}),await q();else{const l=await i.json();p({type:"error",message:l.message||"Error al eliminar seguimiento"})}}catch{p({type:"error",message:"Error al eliminar seguimiento"})}}function he(a){c(x,a.id,!0),c(v,{followup_type:a.followup_type,date:a.date,description:a.description||"",status:a.status||""},!0)}function B(){c(x,null),c(v,{followup_type:"",date:new Date().toISOString().split("T")[0],description:"",status:""},!0)}function be(a){return new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}var L=ba();Ge(a=>{Qe.title="Editar Póliza - PAS Manager"});var R=r(L),oe=r(R),Se=r(oe);I(Se,{variant:"ghost",size:"sm",onclick:()=>te("/polizas"),children:(a,i)=>{var l=va(),b=C(l);oa(b,{size:18}),P(),d(a,l)},$$slots:{default:!0}}),P(4),o(oe),o(R);var re=n(R,2);aa(re,{mode:"edit",get initialData(){return fe},get loading(){return e(h)},get errors(){return e(M)},onSubmit:ye,onCancel:()=>te("/polizas")});var ze=n(re,2);sa(ze,{children:(a,i)=>{var l=ha(),b=n(C(l),2),H=r(b),Ee=r(H,!0);o(H);var V=n(H,2),G=r(V),xe=n(r(G),2);{var ke=t=>{{let u=Xe(()=>e(j).map(y=>({value:y,label:y})));ta(t,{id:"followup_type",get options(){return e(u)},placeholder:"Selecciona tipo",required:!0,get value(){return e(v).followup_type},set value(y){e(v).followup_type=y}})}},Pe=t=>{se(t,{placeholder:"Tipo de seguimiento",required:!0,get value(){return e(v).followup_type},set value(u){e(v).followup_type=u}})};T(xe,t=>{e(j).length>0?t(ke):t(Pe,!1)})}o(G);var K=n(G,2),Te=n(r(K),2);se(Te,{id:"followup_date",type:"date",required:!0,get value(){return e(v).date},set value(t){e(v).date=t}}),o(K);var Q=n(K,2),Fe=n(r(Q),2);se(Fe,{id:"followup_status",placeholder:"Estado (opcional)",get value(){return e(v).status},set value(t){e(v).status=t}}),o(Q);var ne=n(Q,2),ve=n(r(ne),2);We(ve),o(ne),o(V);var de=n(V,2),Ce=r(de);{var De=t=>{var u=da(),y=C(u);I(y,{variant:"ghost",onclick:B,type:"button",children:(S,g)=>{P();var f=pe("Cancelar");d(S,f)},$$slots:{default:!0}});var k=n(y,2);I(k,{variant:"primary",onclick:()=>ge(e(x)),type:"button",children:(S,g)=>{P();var f=pe("Actualizar Seguimiento");d(S,f)},$$slots:{default:!0}}),d(t,u)},je=t=>{I(t,{variant:"primary",onclick:_e,type:"button",children:(u,y)=>{var k=ca(),S=C(k);ra(S,{size:18}),P(),d(u,k)},$$slots:{default:!0}})};T(Ce,t=>{e(x)?t(De):t(je,!1)})}o(de),o(b);var qe=n(b,2);{var Ae=t=>{var u=ua();d(t,u)},Oe=t=>{var u=Ye(),y=C(u);{var k=g=>{var f=pa(),W=r(f);ia(W,{size:48}),P(4),o(f),d(g,f)},S=g=>{var f=wa();Ze(f,21,()=>e(J),$e,(W,w)=>{var X=ga(),Y=r(X),Z=r(Y),Ie=r(Z,!0);o(Z);var $=n(Z,2),Ne=r($,!0);o($);var ce=n($,2),A=r(ce);A.__click=[fa,he,w];var Ue=r(A);la(Ue,{size:16}),o(A);var ee=n(A,2);ee.__click=[ma,we,w];var Je=r(ee);na(Je,{size:16}),o(ee),o(ce),o(Y);var ue=n(Y,2);{var Me=_=>{var z=ya(),ae=r(z);o(z),O(()=>D(ae,`Estado: ${e(w).status??""}`)),d(_,z)};T(ue,_=>{e(w).status&&_(Me)})}var Be=n(ue,2);{var Le=_=>{var z=_a(),ae=r(z,!0);o(z),O(()=>D(ae,e(w).description)),d(_,z)};T(Be,_=>{e(w).description&&_(Le)})}o(X),O(_=>{D(Ie,e(w).followup_type),D(Ne,_)},[()=>be(e(w).date)]),d(W,X)}),o(f),d(g,f)};T(y,g=>{e(J).length===0?g(k):g(S,!1)},!0)}d(t,u)};T(qe,t=>{e(U)?t(Ae):t(Oe,!1)})}O(()=>D(Ee,e(x)?"Editar Seguimiento":"Nuevo Seguimiento")),ea(ve,()=>e(v).description,t=>e(v).description=t),d(a,l)},$$slots:{default:!0}}),o(L),d(N,L),Ke()}He(["click"]);export{Ja as component};
