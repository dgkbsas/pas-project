import"../chunks/CWj6FrbW.js";import{o as $e}from"../chunks/B5RiWETq.js";import{t as L,h as le,i as ve,_ as Pe,bp as Ie,p as de,G as Te,W as qe,bq as Le,br as Oe,b6 as fe,y as Se,bs as Ae,z as Y,b as w,d as c,g as m,aa as u,a as o,ab as H,s as Be,a8 as je,ax as h,aw as De,ay as He,a9 as Re,aA as Ze,c as U,f as $,aD as i,A as e,av as q,aB as X,aE as Je,az as Ve}from"../chunks/T0dPp4D2.js";import{i as N}from"../chunks/iIrk5DBN.js";import{p as ue,a as Ye,b as Fe}from"../chunks/x5bn8cLp.js";import{g as ce}from"../chunks/CdRlIqj1.js";import{p as Ge}from"../chunks/C_yrTCpp.js";import{B as We}from"../chunks/BpcvKk5C.js";import{I as D}from"../chunks/CCnm1ovl.js";import{C as Ke}from"../chunks/Ch5CQVJw.js";import{s as Qe}from"../chunks/BqiCCWh5.js";import{S as Ue}from"../chunks/C445wxwa.js";import{s as ee}from"../chunks/C8FjytsP.js";function Xe(O,C,x=!1,E=!1,R=!1){var l=O,v="";L(()=>{var p=Pe;if(v===(v=C()??"")){le&&ve();return}if(p.nodes_start!==null&&(Ie(p.nodes_start,p.nodes_end),p.nodes_start=p.nodes_end=null),v!==""){if(le){de.data;for(var s=ve(),y=s;s!==null&&(s.nodeType!==Te||s.data!=="");)y=s,s=qe(s);if(s===null)throw Le(),Oe;fe(de,y),l=Se(s);return}var n=v+"";x?n=`<svg>${n}</svg>`:E&&(n=`<math>${n}</math>`);var a=Ae(n);if((x||E)&&(a=Y(a)),fe(Y(a),a.lastChild),x||E)for(;Y(a);)l.before(Y(a));else l.before(a)}})}var ea=w('<div class="alert-title svelte-e846cx"> </div>'),aa=w('<div class="alert-message svelte-e846cx"><!></div>'),ra=w('<div role="alert"><div class="alert-icon svelte-e846cx"><!></div> <div class="alert-content svelte-e846cx"><!> <!></div></div>');function me(O,C){let x=ue(C,"variant",3,"info"),E=ue(C,"class",3,"");const R={info:`<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
			<path d="M10 6V10M10 14H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
		</svg>`,success:`<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
			<path d="M6 10L9 13L14 7M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
		</svg>`,warning:`<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
			<path d="M10 6V10M10 14H10.01M8.27 2.73L1.73 14.55C0.77 16.26 2.01 18.39 4.01 18.39H15.99C17.99 18.39 19.23 16.26 18.27 14.55L11.73 2.73C10.77 1.02 9.23 1.02 8.27 2.73Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
		</svg>`,error:`<svg width="20" height="20" viewBox="0 0 20 20" fill="none">
			<path d="M6 6L14 14M6 14L14 6M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
		</svg>`};var l=ra(),v=c(l),p=c(v);Xe(p,()=>R[x()]),m(v);var s=u(v,2),y=c(s);{var n=d=>{var _=ea(),b=c(_,!0);m(_),L(()=>H(b,C.title)),o(d,_)};N(y,d=>{C.title&&d(n)})}var a=u(y,2);{var g=d=>{var _=aa(),b=c(_);Be(b,()=>C.children),m(_),o(d,_)};N(a,d=>{C.children&&d(g)})}m(s),m(l),L(()=>Qe(l,1,`alert alert-${x()??""} ${E()??""}`,"svelte-e846cx")),o(O,l)}var ta=w('<p class="invitation-message svelte-ff5z5w">Has sido invitado a unirte a <strong class="svelte-ff5z5w"> </strong></p>'),sa=w('<p class="svelte-ff5z5w">Comienza a gestionar tus pólizas de seguros</p>'),ia=w('<div class="loading-invitation svelte-ff5z5w"><!> <p class="svelte-ff5z5w">Verificando invitación...</p></div>'),oa=w('<!> <div class="divider svelte-ff5z5w"></div> <p class="text-center svelte-ff5z5w">¿No tienes una invitación? <a href="/auth/signup" class="link svelte-ff5z5w">Crea una cuenta nueva</a></p>',1),na=w("Te registrarás como <strong> </strong> ",1),la=w('<!> <div class="form-spacer svelte-ff5z5w"></div>',1),va=w('<form class="svelte-ff5z5w"><!> <!> <!> <!> <!> <!> <!></form> <div class="divider svelte-ff5z5w"></div> <p class="login-link svelte-ff5z5w">¿Ya tienes una cuenta? <a href="/auth/login" class="link svelte-ff5z5w">Inicia sesión</a></p>',1),da=w('<div class="signup-container svelte-ff5z5w"><div class="signup-wrapper svelte-ff5z5w"><div class="signup-header svelte-ff5z5w"><h1 class="svelte-ff5z5w">Crear Cuenta</h1> <!></div> <!></div></div>');function za(O,C){je(C,!0);const x=()=>Fe(Ge,"$page",E),[E,R]=Ye();let l=h(""),v=h(""),p=h(""),s=h(""),y=h(""),n=h(!1),a=h(De({})),g=h(null),d=h(null),_=h(!1),b=h(null);$e(async()=>{const r=x().url.searchParams.get("token");r&&(i(g,r,!0),await pe(r))});async function pe(r){i(_,!0),i(b,null);try{const f=await fetch("/api/invitations/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:r})}),k=await f.json();if(!f.ok){i(b,k.message||"Invitación no válida",!0);return}if(!k.valid){i(b,k.message,!0);return}i(d,k.invitation,!0),i(l,e(d).email,!0)}catch(f){i(b,"Error al cargar la invitación"),console.error(f)}finally{i(_,!1)}}function ge(){return i(a,{},!0),e(l)?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e(l))||(e(a).email="Email inválido"):e(a).email="El email es requerido",e(v)?e(v).length<6&&(e(a).password="La contraseña debe tener al menos 6 caracteres"):e(a).password="La contraseña es requerida",e(v)!==e(p)&&(e(a).confirmPassword="Las contraseñas no coinciden"),e(y)||(e(a).fullName="El nombre es requerido"),!e(g)&&!e(s)&&(e(a).companyName="El nombre de la empresa es requerido"),Object.keys(e(a)).length===0}async function _e(){if(ge()){i(n,!0);try{const r=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e(l),password:e(v),fullName:e(y),companyName:e(g)?void 0:e(s),invitationToken:e(g)})}),f=await r.json();if(!r.ok){ee({type:"error",message:f.message||"Error al crear la cuenta"});return}ee({type:"success",message:e(g)?"Cuenta creada exitosamente. Iniciando sesión...":"Cuenta creada exitosamente. Por favor verifica tu email."}),e(g)?await ce("/dashboard"):await ce("/auth/login")}catch(r){ee({type:"error",message:"Error al crear la cuenta"}),console.error(r)}finally{i(n,!1)}}}var F=da();He(r=>{Ze.title="Crear Cuenta - PAS Manager"});var ae=c(F),G=c(ae),he=u(c(G),2);{var we=r=>{var f=ta(),k=u(c(f)),W=c(k,!0);m(k),m(f),L(()=>H(W,e(d).company.name)),o(r,f)},Ce=r=>{var f=sa();o(r,f)};N(he,r=>{e(d)?r(we):r(Ce,!1)})}m(G);var ye=u(G,2);Ke(ye,{children:(r,f)=>{var k=U(),W=$(k);{var be=P=>{var I=ia(),K=c(I);Ue(K,{size:"lg"}),q(2),m(I),o(P,I)},ke=P=>{var I=U(),K=$(I);{var ze=T=>{var S=oa(),A=$(S);me(A,{variant:"error",title:"Error de Invitación",children:(Z,re)=>{q();var B=X();L(()=>H(B,e(b))),o(Z,B)},$$slots:{default:!0}}),q(4),o(T,S)},xe=T=>{var S=va(),A=$(S),Z=c(A);{var re=t=>{var M=la(),J=$(M);me(J,{variant:"info",title:"Invitación",children:(Q,ne)=>{q();var V=na(),z=u($(V)),j=c(z,!0);m(z);var Me=u(z);L(()=>{H(j,e(d).role),H(Me,` en ${e(d).company.name??""}`)}),o(Q,V)},$$slots:{default:!0}}),q(2),o(t,M)};N(Z,t=>{e(d)&&t(re)})}var B=u(Z,2);D(B,{type:"text",label:"Nombre Completo",placeholder:"Juan Pérez",get error(){return e(a).fullName},required:!0,get disabled(){return e(n)},get value(){return e(y)},set value(t){i(y,t,!0)}});var te=u(B,2);{let t=Je(()=>e(n)||!!e(g));D(te,{type:"email",label:"Email",placeholder:"tu@email.com",get error(){return e(a).email},required:!0,get disabled(){return e(t)},get value(){return e(l)},set value(M){i(l,M,!0)}})}var se=u(te,2);{var Ne=t=>{D(t,{type:"text",label:"Nombre de la Empresa",placeholder:"Mi Empresa S.A.",get error(){return e(a).companyName},required:!0,get disabled(){return e(n)},get value(){return e(s)},set value(M){i(s,M,!0)}})};N(se,t=>{e(g)||t(Ne)})}var ie=u(se,2);D(ie,{type:"password",label:"Contraseña",placeholder:"••••••••",get error(){return e(a).password},required:!0,get disabled(){return e(n)},get value(){return e(v)},set value(t){i(v,t,!0)}});var oe=u(ie,2);D(oe,{type:"password",label:"Confirmar Contraseña",placeholder:"••••••••",get error(){return e(a).confirmPassword},required:!0,get disabled(){return e(n)},get value(){return e(p)},set value(t){i(p,t,!0)}});var Ee=u(oe,2);We(Ee,{type:"submit",variant:"primary",size:"lg",get loading(){return e(n)},class:"submit-button",children:(t,M)=>{var J=U(),Q=$(J);{var ne=z=>{var j=X("Aceptar Invitación y Crear Cuenta");o(z,j)},V=z=>{var j=X("Crear Cuenta");o(z,j)};N(Q,z=>{e(g)?z(ne):z(V,!1)})}o(t,J)},$$slots:{default:!0}}),m(A),q(4),Ve("submit",A,t=>{t.preventDefault(),_e()}),o(T,S)};N(K,T=>{e(b)?T(ze):T(xe,!1)},!0)}o(P,I)};N(W,P=>{e(_)?P(be):P(ke,!1)})}o(r,k)},$$slots:{default:!0}}),m(ae),m(F),o(O,F),Re(),R()}export{za as component};
