import"../chunks/CWj6FrbW.js";import{o as gt}from"../chunks/C_FCoYF_.js";import{ag as rt,a7 as st,a8 as A,a9 as Ee,B as nt,ad as i,a3 as e,c as ra,f as G,a as n,ab as lt,b as h,U as r,d as t,r as a,ak as sa,t as T,ah as $,af as xe,ae as S,ai as yt,aj as kt,aa as zt,ac as Ct,aB as xt}from"../chunks/dGHTYzhB.js";import{i as z}from"../chunks/_danfitL.js";import{s as et,e as Ta,i as Ma,r as Ve,b as Ya,d as Pt}from"../chunks/X3gEIfGK.js";import{s as vt}from"../chunks/BZZkyLtE.js";import{b as Na,a as wt}from"../chunks/Bh6sXfGS.js";import{p as It,a as dt,b as ct}from"../chunks/pnKjlpSc.js";import{g as Ne}from"../chunks/DmrR99iC.js";import{p as _t}from"../chunks/BKbJYTTl.js";import{B as ka}from"../chunks/DOI_CNwM.js";import{I as q}from"../chunks/CFvsllsx.js";import{T as Et}from"../chunks/1h6XdPlc.js";import{E as St}from"../chunks/CgF9W7Br.js";import{F as At,A as Ft,a as $t,S as Tt,I as Mt}from"../chunks/C2tzjyNj.js";import{P as Nt}from"../chunks/N50CPPdR.js";import{s as ve}from"../chunks/CXhoiRHA.js";import{i as pt,M as ut,g as mt,P as it}from"../chunks/TI-Zte5_.js";import{U as Dt}from"../chunks/D9OO-6zb.js";import{X as ot}from"../chunks/Z30GsDLy.js";import{A as Ut}from"../chunks/BauqxaN6.js";import{P as Lt,C as jt}from"../chunks/B2ofbWwq.js";import{S as Bt}from"../chunks/sA2ACGqx.js";import{F as at}from"../chunks/BOk7XFuN.js";import{P as tt}from"../chunks/iyOaMzGm.js";import{d as Rt,S as Ot}from"../chunks/5fA7gCJ-.js";import{U as Vt}from"../chunks/DaxW58Sj.js";import{E as qt}from"../chunks/Du7u80LR.js";import{T as Gt}from"../chunks/jg_9Tfj_.js";import{M as Wt}from"../chunks/CDgF3YB_.js";var Ht=(P,s)=>s.onClose(),Jt=(P,s,p)=>{const C=s().url.searchParams.get("fromId");C&&(p.onClose(),Ne(`/polizas?policyId=${C}&mode=view`))},Xt=h('<button class="back-btn svelte-mh26do" title="Volver a póliza"><!></button>'),Zt=h('<p class="subtitle svelte-mh26do"> </p>'),Kt=h('<button class="icon-btn svelte-mh26do" title="Edit client"><!></button>'),Qt=(P,s)=>s.onClose(),Yt=h('<div class="loading-state svelte-mh26do"><p class="svelte-mh26do">Cargando datos del cliente...</p></div>'),er=h('<a target="_blank" rel="noopener noreferrer" class="whatsapp-btn svelte-mh26do" title="Abrir en WhatsApp"><!></a>'),ar=h('<textarea id="observations" rows="4" placeholder="Additional notes..." class="svelte-mh26do"></textarea>'),tr=h('<p class="field-value preserve-whitespace svelte-mh26do"> </p>'),rr=(P,s,p)=>{s.onClose(),Ne(`/polizas/nuevo?client_id=${e(p).id}`)},sr=(P,s,p,C)=>{s.onClose(),Ne(`/polizas?policyId=${e(p).id}&mode=view&from=client&fromId=${e(C).id}`)},lr=h('<span class="policy-separator svelte-mh26do">•</span> <span class="policy-insurer svelte-mh26do"> </span>',1),or=h('<div class="policy-date svelte-mh26do"> </div>'),ir=h('<button type="button" class="policy-card svelte-mh26do"><div class="policy-info svelte-mh26do"><div class="policy-header svelte-mh26do"><strong class="policy-number svelte-mh26do"> </strong> <span> </span></div> <div class="policy-meta svelte-mh26do"><span class="policy-type svelte-mh26do"> </span> <!></div> <!></div> <div class="policy-arrow svelte-mh26do">→</div></button>'),nr=h('<div class="policies-list svelte-mh26do"></div>'),vr=(P,s,p)=>{s.onClose(),Ne(`/polizas/nuevo?client_id=${e(p).id}`)},dr=h('<div class="no-policies svelte-mh26do"><!> <p class="svelte-mh26do">Este cliente no tiene pólizas registradas</p> <button type="button" class="create-first-btn svelte-mh26do"><!> Crear primera póliza</button></div>'),cr=h('<section class="form-section policies-section svelte-mh26do"><div class="section-header-row svelte-mh26do"><h3 class="svelte-mh26do"><!> </h3> <button type="button" class="add-policy-btn svelte-mh26do"><!> Nueva Póliza</button></div> <!></section>'),_r=h('<form class="svelte-mh26do"><section class="form-section svelte-mh26do"><h3 class="svelte-mh26do">Información Personal</h3> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="first_name" class="svelte-mh26do">Nombre *</label> <!></div> <div class="form-field svelte-mh26do"><label for="last_name" class="svelte-mh26do">Apellido *</label> <!></div></div> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="document_number" class="svelte-mh26do">DNI/CUIT</label> <!></div> <div class="form-field svelte-mh26do"><label for="birth_date" class="svelte-mh26do">Fecha de Nacimiento</label> <!></div></div></section> <section class="form-section svelte-mh26do"><h3 class="svelte-mh26do">Información de Contacto</h3> <div class="form-field svelte-mh26do"><label for="email_primary" class="svelte-mh26do">Email Principal</label> <!></div> <div class="form-field svelte-mh26do"><label for="email_secondary" class="svelte-mh26do">Email Secundario</label> <!></div> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="phone" class="svelte-mh26do">Celular</label> <div class="phone-input-wrapper svelte-mh26do"><!> <!></div></div> <div class="form-field svelte-mh26do"><label for="phone_landline" class="svelte-mh26do">Teléfono</label> <!></div></div></section> <section class="form-section svelte-mh26do"><h3 class="svelte-mh26do">Dirección</h3> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="street" class="svelte-mh26do">Calle</label> <!></div> <div class="form-field svelte-mh26do"><label for="street_number" class="svelte-mh26do">Número</label> <!></div> <div class="form-field svelte-mh26do"><label for="floor" class="svelte-mh26do">Piso</label> <!></div> <div class="form-field svelte-mh26do"><label for="apartment" class="svelte-mh26do">Depto</label> <!></div></div> <div class="form-row svelte-mh26do"><div class="form-field svelte-mh26do"><label for="city" class="svelte-mh26do">Ciudad</label> <!></div> <div class="form-field svelte-mh26do"><label for="province" class="svelte-mh26do">Provincia</label> <!></div> <div class="form-field svelte-mh26do"><label for="postal_code" class="svelte-mh26do">Código Postal</label> <!></div></div></section> <section class="form-section svelte-mh26do"><h3 class="svelte-mh26do">Información Adicional</h3> <div class="form-field svelte-mh26do"><label for="alias_pas" class="svelte-mh26do">Alias PAS</label> <!></div> <div class="form-field svelte-mh26do"><label for="referred_by" class="svelte-mh26do">Referido Por</label> <!></div> <div class="form-field svelte-mh26do"><label for="observations" class="svelte-mh26do">Observaciones</label> <!></div></section>  <!></form>'),pr=h("<!> Guardar Cambios",1),ur=h('<div class="modal-footer svelte-mh26do"><!> <!></div>'),mr=h('<div class="backdrop svelte-mh26do"></div> <div class="modal-panel svelte-mh26do"><div class="modal-header svelte-mh26do"><div class="header-content svelte-mh26do"><!> <div class="icon-wrapper svelte-mh26do"><!></div> <div class="svelte-mh26do"><h2 class="svelte-mh26do"><!></h2> <!></div></div> <div class="header-actions svelte-mh26do"><!> <button class="icon-btn svelte-mh26do" title="Close"><!></button></div></div> <div class="modal-content svelte-mh26do"><!></div> <!></div>',1);function hr(P,s){st(s,!0);const p=()=>ct(_t,"$page",C),[C,W]=dt();let I=It(s,"mode",3,"view"),o=A(null),R=A(!1),H=A(!1),y=A(I()==="edit"),u=A(Ee({first_name:"",last_name:"",document_number:"",birth_date:"",email_primary:"",email_secondary:"",phone:"",phone_landline:"",address:"",street:"",street_number:"",floor:"",apartment:"",postal_code:"",city:"",province:"",alias_pas:"",referred_by:"",observations:""})),w=A(Ee({}));nt(()=>{s.clientId&&(i(y,I()==="edit"),Z())});async function Z(){var L,K,k,ee,de,ce,_e,ke,Y,ae,O,te,re,pe,ze,se,ue,le,me;if(s.clientId){i(R,!0);try{const he=await fetch(`/api/clients/${s.clientId}`),J=await he.json();he.ok?(i(o,J.client,!0),i(u,{first_name:((L=e(o))==null?void 0:L.first_name)||"",last_name:((K=e(o))==null?void 0:K.last_name)||"",document_number:((k=e(o))==null?void 0:k.document_number)||"",birth_date:((ee=e(o))==null?void 0:ee.birth_date)||"",email_primary:((de=e(o))==null?void 0:de.email_primary)||"",email_secondary:((ce=e(o))==null?void 0:ce.email_secondary)||"",phone:((_e=e(o))==null?void 0:_e.phone)||"",phone_landline:((ke=e(o))==null?void 0:ke.phone_landline)||"",address:((Y=e(o))==null?void 0:Y.address)||"",street:((ae=e(o))==null?void 0:ae.street)||"",street_number:((O=e(o))==null?void 0:O.street_number)||"",floor:((te=e(o))==null?void 0:te.floor)||"",apartment:((re=e(o))==null?void 0:re.apartment)||"",postal_code:((pe=e(o))==null?void 0:pe.postal_code)||"",city:((ze=e(o))==null?void 0:ze.city)||"",province:((se=e(o))==null?void 0:se.province)||"",alias_pas:((ue=e(o))==null?void 0:ue.alias_pas)||"",referred_by:((le=e(o))==null?void 0:le.referred_by)||"",observations:((me=e(o))==null?void 0:me.observations)||""},!0)):(ve({type:"error",message:"Error loading client"}),s.onClose())}catch{ve({type:"error",message:"Error loading client"}),s.onClose()}finally{i(R,!1)}}}async function De(){if(s.clientId){i(H,!0),i(w,{},!0);try{const L=await fetch(`/api/clients/${s.clientId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e(u))}),K=await L.json();L.ok?(ve({type:"success",message:"Client updated successfully"}),i(y,!1),await Z(),s.onClose(!0)):(K.errors&&i(w,K.errors,!0),ve({type:"error",message:K.message||"Error updating client"}))}catch{ve({type:"error",message:"Error updating client"})}finally{i(H,!1)}}}function Se(){i(y,!e(y)),!e(y)&&e(o)&&(i(u,{first_name:e(o).first_name||"",last_name:e(o).last_name||"",document_number:e(o).document_number||"",birth_date:e(o).birth_date||"",email_primary:e(o).email_primary||"",email_secondary:e(o).email_secondary||"",phone:e(o).phone||"",phone_landline:e(o).phone_landline||"",address:e(o).address||"",street:e(o).street||"",street_number:e(o).street_number||"",floor:e(o).floor||"",apartment:e(o).apartment||"",postal_code:e(o).postal_code||"",city:e(o).city||"",province:e(o).province||"",alias_pas:e(o).alias_pas||"",referred_by:e(o).referred_by||"",observations:e(o).observations||""},!0),i(w,{},!0))}function Ue(L){return L?new Date(L).toLocaleDateString("es-ES"):"N/A"}var ye=ra(),F=G(ye);{var qe=L=>{var K=mr(),k=G(K);k.__click=[Ht,s];var ee=r(k,2),de=t(ee),ce=t(de),_e=t(ce);{var ke=m=>{var f=Xt();f.__click=[Jt,p,s];var E=t(f);Ut(E,{size:20}),a(f),n(m,f)};z(_e,m=>{p().url.searchParams.get("from")==="policy"&&m(ke)})}var Y=r(_e,2),ae=t(Y);Dt(ae,{size:24}),a(Y);var O=r(Y,2),te=t(O),re=t(te);{var pe=m=>{var f=sa("Cargando...");n(m,f)},ze=m=>{var f=ra(),E=G(f);{var V=N=>{var D=sa();T(()=>$(D,`${e(o).first_name??""} ${e(o).last_name??""}`)),n(N,D)};z(E,N=>{e(o)&&N(V)},!0)}n(m,f)};z(re,m=>{e(R)?m(pe):m(ze,!1)})}a(te);var se=r(te,2);{var ue=m=>{var f=Zt(),E=t(f,!0);a(f),T(()=>$(E,e(o).email_primary||"No email")),n(m,f)};z(se,m=>{e(o)&&!e(R)&&m(ue)})}a(O),a(ce);var le=r(ce,2),me=t(le);{var he=m=>{var f=Kt();f.__click=Se;var E=t(f);Lt(E,{size:18}),a(f),n(m,f)};z(me,m=>{!e(y)&&!e(R)&&m(he)})}var J=r(me,2);J.__click=[Qt,s];var Le=t(J);ot(Le,{size:20}),a(J),a(le),a(de);var Pe=r(de,2),Ge=t(Pe);{var We=m=>{var f=Yt();n(m,f)},je=m=>{var f=ra(),E=G(f);{var V=N=>{var D=_r(),X=t(D),fe=r(t(X),2),Ae=t(fe),Fe=r(t(Ae),2);{let v=S(()=>!e(y));q(Fe,{id:"first_name",get error(){return e(w).first_name},required:!0,get disabled(){return e(v)},get value(){return e(u).first_name},set value(d){e(u).first_name=d}})}a(Ae);var be=r(Ae,2),$e=r(t(be),2);{let v=S(()=>!e(y));q($e,{id:"last_name",get error(){return e(w).last_name},required:!0,get disabled(){return e(v)},get value(){return e(u).last_name},set value(d){e(u).last_name=d}})}a(be),a(fe);var He=r(fe,2),Je=t(He),Da=r(t(Je),2);{let v=S(()=>!e(y));q(Da,{id:"document_number",get error(){return e(w).document_number},get disabled(){return e(v)},get value(){return e(u).document_number},set value(d){e(u).document_number=d}})}a(Je);var za=r(Je,2),Ua=r(t(za),2);{let v=S(()=>!e(y));q(Ua,{id:"birth_date",type:"date",get error(){return e(w).birth_date},get disabled(){return e(v)},get value(){return e(u).birth_date},set value(d){e(u).birth_date=d}})}a(za),a(He),a(X);var oa=r(X,2),ia=r(t(oa),2),La=r(t(ia),2);{let v=S(()=>!e(y));q(La,{id:"email_primary",type:"email",get error(){return e(w).email_primary},get disabled(){return e(v)},get value(){return e(u).email_primary},set value(d){e(u).email_primary=d}})}a(ia);var Xe=r(ia,2),ja=r(t(Xe),2);{let v=S(()=>!e(y));q(ja,{id:"email_secondary",type:"email",get error(){return e(w).email_secondary},get disabled(){return e(v)},get value(){return e(u).email_secondary},set value(d){e(u).email_secondary=d}})}a(Xe);var l=r(Xe,2),c=t(l),_=r(t(c),2),U=t(_);{let v=S(()=>!e(y));Nt(U,{get error(){return e(w).phone},get disabled(){return e(v)},get value(){return e(u).phone},set value(d){e(u).phone=d}})}var Q=r(U,2);{var oe=v=>{var d=er(),ge=t(d);ut(ge,{size:14}),a(d),T(we=>et(d,"href",we),[()=>mt(e(o).phone)]),n(v,d)};z(Q,v=>{!e(y)&&e(o).phone&&pt(e(o).phone)&&v(oe)})}a(_),a(c);var Be=r(c,2),Ze=r(t(Be),2);{let v=S(()=>!e(y));q(Ze,{id:"phone_landline",type:"tel",get error(){return e(w).phone_landline},get disabled(){return e(v)},get value(){return e(u).phone_landline},set value(d){e(u).phone_landline=d}})}a(Be),a(l),a(oa);var na=r(oa,2),va=r(t(na),2),Ca=t(va),xa=r(t(Ca),2);{let v=S(()=>!e(y));q(xa,{id:"street",get error(){return e(w).street},get disabled(){return e(v)},placeholder:"Nombre de la calle",get value(){return e(u).street},set value(d){e(u).street=d}})}a(Ca);var Ke=r(Ca,2),Ba=r(t(Ke),2);{let v=S(()=>!e(y));q(Ba,{id:"street_number",get error(){return e(w).street_number},get disabled(){return e(v)},placeholder:"1234",get value(){return e(u).street_number},set value(d){e(u).street_number=d}})}a(Ke);var x=r(Ke,2),da=r(t(x),2);{let v=S(()=>!e(y));q(da,{id:"floor",get error(){return e(w).floor},get disabled(){return e(v)},placeholder:"5",get value(){return e(u).floor},set value(d){e(u).floor=d}})}a(x);var Qe=r(x,2),ca=r(t(Qe),2);{let v=S(()=>!e(y));q(ca,{id:"apartment",get error(){return e(w).apartment},get disabled(){return e(v)},placeholder:"A",get value(){return e(u).apartment},set value(d){e(u).apartment=d}})}a(Qe),a(va);var Pa=r(va,2),Re=t(Pa),Ra=r(t(Re),2);{let v=S(()=>!e(y));q(Ra,{id:"city",get error(){return e(w).city},get disabled(){return e(v)},placeholder:"Ciudad",get value(){return e(u).city},set value(d){e(u).city=d}})}a(Re);var _a=r(Re,2),Oa=r(t(_a),2);{let v=S(()=>!e(y));q(Oa,{id:"province",get error(){return e(w).province},get disabled(){return e(v)},placeholder:"Provincia",get value(){return e(u).province},set value(d){e(u).province=d}})}a(_a);var Ye=r(_a,2),Va=r(t(Ye),2);{let v=S(()=>!e(y));q(Va,{id:"postal_code",get error(){return e(w).postal_code},get disabled(){return e(v)},placeholder:"1234",get value(){return e(u).postal_code},set value(d){e(u).postal_code=d}})}a(Ye),a(Pa),a(na);var pa=r(na,2),ua=r(t(pa),2),ma=r(t(ua),2);{let v=S(()=>!e(y));q(ma,{id:"alias_pas",get error(){return e(w).alias_pas},get disabled(){return e(v)},get value(){return e(u).alias_pas},set value(d){e(u).alias_pas=d}})}a(ua);var ha=r(ua,2),qa=r(t(ha),2);{let v=S(()=>!e(y));q(qa,{id:"referred_by",get error(){return e(w).referred_by},get disabled(){return e(v)},get value(){return e(u).referred_by},set value(d){e(u).referred_by=d}})}a(ha);var wa=r(ha,2),fa=r(t(wa),2);{var Ga=v=>{var d=ar();kt(d),Na(d,()=>e(u).observations,ge=>e(u).observations=ge),n(v,d)},Wa=v=>{var d=tr(),ge=t(d,!0);a(d),T(()=>$(ge,e(o).observations||"Sin observaciones")),n(v,d)};z(fa,v=>{e(y)?v(Ga):v(Wa,!1)})}a(wa),a(pa);var Ha=r(pa,2);{var ba=v=>{var d=cr(),ge=t(d),we=t(ge),Ia=t(we);at(Ia,{size:20});var ga=r(Ia);a(we);var ea=r(we,2);ea.__click=[rr,s,o];var Ea=t(ea);tt(Ea,{size:16}),xe(),a(ea),a(ge);var Sa=r(ge,2);{var Ja=ie=>{var ne=nr();Ta(ne,21,()=>e(o).policies,Ma,(aa,j)=>{var Te=ir();Te.__click=[sr,s,j,o];var b=t(Te),g=t(b),B=t(g),Ce=t(B,!0);a(B);var ya=r(B,2);let Fa;var Xa=t(ya,!0);a(ya),a(g);var Oe=r(g,2),Me=t(Oe),Za=t(Me,!0);a(Me);var Ka=r(Me,2);{var ht=Ie=>{var ta=lr(),$a=r(G(ta),2),Qa=t($a,!0);a($a),T(()=>$(Qa,e(j).insurer)),n(Ie,ta)};z(Ka,Ie=>{e(j).insurer&&Ie(ht)})}a(Oe);var ft=r(Oe,2);{var bt=Ie=>{var ta=or(),$a=t(ta);a(ta),T(Qa=>$($a,`Vence: ${Qa??""}`),[()=>Ue(e(j).expiry_date)]),n(Ie,ta)};z(ft,Ie=>{e(j).expiry_date&&Ie(bt)})}a(b),xe(2),a(Te),T(Ie=>{$(Ce,e(j).policy_number||"S/N"),Fa=vt(ya,1,"policy-status svelte-mh26do",null,Fa,Ie),$(Xa,e(j).active?"Activa":"Inactiva"),$(Za,e(j).policy_type)},[()=>({active:e(j).active,inactive:!e(j).active})]),n(aa,Te)}),a(ne),n(ie,ne)},Aa=ie=>{var ne=dr(),aa=t(ne);at(aa,{size:32});var j=r(aa,4);j.__click=[vr,s,o];var Te=t(j);tt(Te,{size:16}),xe(),a(j),a(ne),n(ie,ne)};z(Sa,ie=>{e(o).policies&&e(o).policies.length>0?ie(Ja):ie(Aa,!1)})}a(d),T(()=>{var ie;return $(ga,` Pólizas (${(((ie=e(o).policies)==null?void 0:ie.length)||0)??""})`)}),n(v,d)};z(Ha,v=>{!e(y)&&!p().url.searchParams.get("from")&&v(ba)})}a(D),yt("submit",D,v=>{v.preventDefault(),De()}),n(N,D)};z(E,N=>{e(o)&&N(V)},!0)}n(m,f)};z(Ge,m=>{e(R)?m(We):m(je,!1)})}a(Pe);var la=r(Pe,2);{var M=m=>{var f=ur(),E=t(f);ka(E,{variant:"ghost",onclick:Se,get disabled(){return e(H)},children:(N,D)=>{xe();var X=sa("Cancelar");n(N,X)},$$slots:{default:!0}});var V=r(E,2);ka(V,{variant:"primary",onclick:De,get disabled(){return e(H)},children:(N,D)=>{var X=ra(),fe=G(X);{var Ae=be=>{var $e=sa("Guardando...");n(be,$e)},Fe=be=>{var $e=pr(),He=G($e);Bt(He,{size:18}),xe(),n(be,$e)};z(fe,be=>{e(H)?be(Ae):be(Fe,!1)})}n(N,X)},$$slots:{default:!0}}),a(f),n(m,f)};z(la,m=>{e(y)&&!e(R)&&m(M)})}a(ee),n(L,K)};z(F,L=>{s.clientId&&L(qe)})}n(P,ye),lt(),W()}rt(["click"]);var fr=(P,s,p)=>s(e(p)),br=h('<label class="checkbox-item svelte-eza58y"><input type="checkbox" class="svelte-eza58y"/> <span class="svelte-eza58y"> </span></label>'),gr=(P,s)=>i(s,e(s)===!0?void 0:!0,!0),yr=(P,s)=>i(s,e(s)===!0?void 0:!0,!0),kr=h("<!> Aplicar <!>",1),zr=h('<div class="backdrop svelte-eza58y"></div> <div class="filter-panel svelte-eza58y"><div class="filter-header svelte-eza58y"><h3 class="svelte-eza58y">Filtros</h3> <button class="close-btn svelte-eza58y"><!></button></div> <div class="filter-content svelte-eza58y"><div class="filter-section svelte-eza58y"><h4 class="svelte-eza58y">Ciudad</h4> <div class="checkbox-list svelte-eza58y"></div></div> <div class="filter-section svelte-eza58y"><h4 class="svelte-eza58y">Información de Contacto</h4> <div class="checkbox-list svelte-eza58y"><label class="checkbox-item svelte-eza58y"><input type="checkbox" class="svelte-eza58y"/> <span class="svelte-eza58y">Con email</span></label> <label class="checkbox-item svelte-eza58y"><input type="checkbox" class="svelte-eza58y"/> <span class="svelte-eza58y">Con teléfono</span></label></div></div> <div class="filter-section svelte-eza58y"><h4 class="svelte-eza58y">Fecha de Creación</h4> <div class="date-inputs svelte-eza58y"><div class="input-group svelte-eza58y"><label for="date-from" class="svelte-eza58y">Desde</label> <input id="date-from" type="date" class="svelte-eza58y"/></div> <div class="input-group svelte-eza58y"><label for="date-to" class="svelte-eza58y">Hasta</label> <input id="date-to" type="date" class="svelte-eza58y"/></div></div></div></div> <div class="filter-footer svelte-eza58y"><!> <!></div></div>',1);function Cr(P,s){var ye,F,qe,L,K;st(s,!0);const p={cities:[]};let C=A(Ee(((ye=s.initialFilters)==null?void 0:ye.cities)||p.cities)),W=A(Ee((F=s.initialFilters)==null?void 0:F.hasEmail)),I=A(Ee((qe=s.initialFilters)==null?void 0:qe.hasPhone)),o=A(Ee(((L=s.initialFilters)==null?void 0:L.dateFrom)||"")),R=A(Ee(((K=s.initialFilters)==null?void 0:K.dateTo)||""));const H=["Madrid","Barcelona","Valencia","Sevilla","Zaragoza","Málaga","Murcia","Palma","Bilbao","Alicante"];function y(k){e(C).includes(k)?i(C,e(C).filter(ee=>ee!==k),!0):i(C,[...e(C),k],!0)}function u(){i(C,[],!0),i(W,void 0),i(I,void 0),i(o,""),i(R,"")}function w(){s.onApply({cities:e(C),hasEmail:e(W),hasPhone:e(I),dateFrom:e(o),dateTo:e(R)}),s.onClose()}const Z=S(()=>()=>{let k=e(C).length;return e(W)!==void 0&&k++,e(I)!==void 0&&k++,e(o)&&k++,e(R)&&k++,k});var De=ra(),Se=G(De);{var Ue=k=>{var ee=zr(),de=G(ee);de.__click=function(...M){var m;(m=s.onClose)==null||m.apply(this,M)};var ce=r(de,2),_e=t(ce),ke=r(t(_e),2);ke.__click=function(...M){var m;(m=s.onClose)==null||m.apply(this,M)};var Y=t(ke);ot(Y,{size:20}),a(ke),a(_e);var ae=r(_e,2),O=t(ae),te=r(t(O),2);Ta(te,21,()=>H,Ma,(M,m)=>{var f=br(),E=t(f);Ve(E),E.__change=[fr,y,m];var V=r(E,2),N=t(V,!0);a(V),a(f),T(D=>{Ya(E,D),$(N,e(m))},[()=>e(C).includes(e(m))]),n(M,f)}),a(te),a(O);var re=r(O,2),pe=r(t(re),2),ze=t(pe),se=t(ze);Ve(se),se.__change=[gr,W],xe(2),a(ze);var ue=r(ze,2),le=t(ue);Ve(le),le.__change=[yr,I],xe(2),a(ue),a(pe),a(re);var me=r(re,2),he=r(t(me),2),J=t(he),Le=r(t(J),2);Ve(Le),a(J);var Pe=r(J,2),Ge=r(t(Pe),2);Ve(Ge),a(Pe),a(he),a(me),a(ae);var We=r(ae,2),je=t(We);ka(je,{variant:"ghost",size:"sm",onclick:u,children:(M,m)=>{xe();var f=sa("Limpiar todo");n(M,f)},$$slots:{default:!0}});var la=r(je,2);ka(la,{variant:"primary",onclick:w,children:(M,m)=>{var f=kr(),E=G(f);jt(E,{size:18});var V=r(E,2);{var N=D=>{var X=sa();T(fe=>$(X,`(${fe??""})`),[()=>e(Z)()]),n(D,X)};z(V,D=>{e(Z)()>0&&D(N)})}n(M,f)},$$slots:{default:!0}}),a(We),a(ce),T(()=>{Ya(se,e(W)===!0),Ya(le,e(I)===!0)}),Na(Le,()=>e(o),M=>i(o,M)),Na(Ge,()=>e(R),M=>i(R,M)),n(k,ee)};z(Se,k=>{s.open&&k(Ue)})}n(P,De),lt()}rt(["click","change"]);function xr(P,s,p,C,W){i(s,e(s)==="asc"?"desc":"asc",!0),i(p,1),i(C,[],!0),W()}function Pr(P,s,p,C,W){i(s,{cities:[],hasEmail:void 0,hasPhone:void 0,dateFrom:"",dateTo:""},!0),i(p,1),i(C,[],!0),W()}var wr=h("<!> Nuevo Cliente",1),Ir=(P,s)=>i(s,!e(s)),Er=h('<span class="filter-badge svelte-1hp9571"> </span>'),Sr=h('<button class="clear-filters-btn svelte-1hp9571" title="Limpiar filtros"><!></button>'),Ar=(P,s,p,C,W)=>{localStorage.setItem("clients_show_inactive",e(s).toString()),i(p,1),i(C,[],!0),W()},Fr=(P,s,p,C)=>{i(s,1),i(p,[],!0),C()},$r=h('<span class="count-skeleton svelte-1hp9571"></span>'),Tr=h('<span class="count-text svelte-1hp9571"> </span> <span class="count-separator svelte-1hp9571">/</span> <span class="count-total svelte-1hp9571"> </span>',1),Mr=h('<div class="skeleton-list svelte-1hp9571"></div>'),Nr=(P,s,p)=>s(`${e(p).first_name} ${e(p).last_name}`,"Nombre"),Dr=(P,s,p)=>s(e(p).document_number,"DNI/CUIT"),Ur=h('<button class="copyable-btn id-cell svelte-1hp9571" title="Click para copiar DNI/CUIT"> </button>'),Lr=h('<span class="text-muted svelte-1hp9571">-</span>'),jr=(P,s,p)=>s(e(p).email_primary,"Email"),Br=h('<button class="copyable-btn email svelte-1hp9571" title="Click para copiar"><!> </button>'),Rr=h('<span class="text-muted svelte-1hp9571">-</span>'),Or=(P,s,p)=>s(e(p).phone,"Celular"),Vr=h('<a target="_blank" rel="noopener noreferrer" class="whatsapp-btn svelte-1hp9571" title="Abrir en WhatsApp"><!></a>'),qr=h('<div class="phone-cell svelte-1hp9571"><button class="copyable-btn phone svelte-1hp9571" title="Click para copiar"><!> </button> <!></div>'),Gr=h('<span class="text-muted svelte-1hp9571">-</span>'),Wr=(P,s,p)=>s(e(p).phone_landline,"Teléfono"),Hr=h('<button class="copyable-btn phone svelte-1hp9571" title="Click para copiar"><!> </button>'),Jr=h('<span class="text-muted svelte-1hp9571">-</span>'),Xr=(P,s,p,C)=>s(p(e(C)),"Dirección"),Zr=h('<button class="copyable-btn address-cell svelte-1hp9571" title="Click para copiar"> </button>'),Kr=h('<span class="text-muted svelte-1hp9571">-</span>'),Qr=(P,s,p)=>s(e(p).id,"view"),Yr=(P,s,p)=>s(e(p).id,e(p).first_name,e(p).last_name),es=h('<tr class="svelte-1hp9571"><td class="svelte-1hp9571"><button class="copyable-btn name-cell svelte-1hp9571" title="Click para copiar nombre"> </button></td><td class="svelte-1hp9571"><!></td><td class="svelte-1hp9571"><!></td><td class="svelte-1hp9571"><!></td><td class="svelte-1hp9571"><!></td><td class="svelte-1hp9571"><!></td><td class="text-nowrap svelte-1hp9571"> </td><td class="text-center svelte-1hp9571"><div class="policies-count svelte-1hp9571"><!> <span class="svelte-1hp9571"> </span></div></td><td class="text-right svelte-1hp9571"><div class="actions svelte-1hp9571"><button class="action-btn view-btn svelte-1hp9571" title="Ver detalles"><!></button> <button class="action-btn danger svelte-1hp9571" title="Eliminar"><!></button></div></td></tr>'),as=h('<thead class="svelte-1hp9571"><tr class="svelte-1hp9571"><th class="svelte-1hp9571">Nombre</th><th class="svelte-1hp9571">DNI/CUIT</th><th class="svelte-1hp9571">Email</th><th class="svelte-1hp9571">Celular</th><th class="svelte-1hp9571">Teléfono</th><th class="svelte-1hp9571">Domicilio</th><th class="svelte-1hp9571">Creado</th><th class="text-center svelte-1hp9571">Pólizas</th><th class="text-right svelte-1hp9571">Acciones</th></tr></thead> <tbody class="svelte-1hp9571"></tbody>',1),ts=h("<!> <!>",1),rs=h('<div class="page svelte-1hp9571"><div class="page-header svelte-1hp9571"><div class="svelte-1hp9571"><h1 class="svelte-1hp9571">Clientes</h1> <p class="svelte-1hp9571">Gestiona tus clientes y su información</p></div> <!></div> <div class="filters-toolbar svelte-1hp9571"><div class="search-box svelte-1hp9571"><!> <input type="text" placeholder="Buscar clientes..." class="svelte-1hp9571"/></div> <div class="toolbar-actions svelte-1hp9571"><button title="Filtros"><!> <!></button> <!> <div class="filter-checkbox svelte-1hp9571"><label class="checkbox-label svelte-1hp9571"><input type="checkbox" class="svelte-1hp9571"/> <span class="svelte-1hp9571">Mostrar inactivos</span></label></div> <div class="sort-select svelte-1hp9571"><label for="sort-by" class="svelte-1hp9571">Ordenar por:</label> <select id="sort-by" class="svelte-1hp9571"><option class="svelte-1hp9571">Nombre</option><option class="svelte-1hp9571">Apellido</option><option class="svelte-1hp9571">Cantidad de pólizas</option><option class="svelte-1hp9571">Fecha creación</option><option class="svelte-1hp9571">Última actualización</option></select> <button class="sort-order-btn svelte-1hp9571"><!></button></div> <div class="results-count svelte-1hp9571"><!></div></div></div> <!></div> <!> <!>',1);function Ms(P,s){st(s,!0);const p=()=>ct(_t,"$page",C),[C,W]=dt();let I=A(Ee([])),o=A(!0),R=A(!1),H=A(""),y=A(!1),u=A("first_name"),w=A("asc"),Z=A(1),De=30,Se=A(0),Ue=A(!0),ye=A(!1),F=A(Ee({cities:[],hasEmail:void 0,hasPhone:void 0,dateFrom:"",dateTo:""})),qe=S(()=>p().url.searchParams.get("clientId")),L=S(()=>p().url.searchParams.get("mode")||"view");gt(()=>{const l=localStorage.getItem("clients_show_inactive");l!==null&&i(y,l==="true"),k()});const K=Rt(()=>{i(Z,1),i(I,[],!0),k()},300);nt(()=>{e(H)!==void 0&&K()});async function k(l=!1){var c;l?i(R,!0):i(o,!0);try{const _=new URLSearchParams({page:e(Z).toString(),limit:De.toString()});e(H)&&_.append("search",e(H)),e(y)||_.append("active_only","true"),_.append("sort_by",e(u)),_.append("sort_order",e(w)),e(F).cities.forEach(oe=>{_.append("city",oe)}),e(F).hasEmail!==void 0&&_.append("has_email",e(F).hasEmail.toString()),e(F).hasPhone!==void 0&&_.append("has_phone",e(F).hasPhone.toString()),e(F).dateFrom&&_.append("date_from",e(F).dateFrom),e(F).dateTo&&_.append("date_to",e(F).dateTo),console.log("Fetching clients:",`/api/clients?${_}`);const U=await fetch(`/api/clients?${_}`);console.log("Response status:",U.status);const Q=await U.json();console.log("Result:",Q),U.ok?(l?i(I,[...e(I),...Q.clients||[]],!0):i(I,Q.clients||[],!0),i(Se,((c=Q.pagination)==null?void 0:c.total)||0,!0),i(Ue,e(I).length<e(Se))):(ve({type:"error",message:Q.message||"Error al cargar clientes"}),i(I,[],!0))}catch(_){console.error("Error loading clients:",_),ve({type:"error",message:"Error al cargar clientes"}),i(I,[],!0)}finally{i(o,!1),i(R,!1)}}function ee(){!e(o)&&!e(R)&&e(Ue)&&(xt(Z),k(!0))}async function de(l,c,_){if(confirm(`¿Seguro que deseas eliminar a ${c} ${_}?`))try{const U=await fetch(`/api/clients/${l}`,{method:"DELETE"});if(U.ok)ve({type:"success",message:"Cliente eliminado"}),k();else{const Q=await U.json();ve({type:"error",message:Q.message})}}catch{ve({type:"error",message:"Error al eliminar"})}}function ce(l,c="view"){const _=new URL(window.location.href);_.searchParams.set("clientId",l),_.searchParams.set("mode",c),Ne(_.pathname+_.search,{replaceState:!1,noScroll:!0})}function _e(l){const c=new URL(window.location.href);c.searchParams.delete("clientId"),c.searchParams.delete("mode"),Ne(c.pathname+c.search,{replaceState:!1,noScroll:!0}),l&&k()}function ke(l){i(F,l,!0),i(Z,1),i(I,[],!0),k()}const Y=S(()=>()=>{let l=e(F).cities.length;return e(F).hasEmail!==void 0&&l++,e(F).hasPhone!==void 0&&l++,e(F).dateFrom&&l++,e(F).dateTo&&l++,l});function ae(l){const c=[],_=[];return l.street&&_.push(l.street),l.street_number&&_.push(l.street_number),l.floor&&_.push(`Piso ${l.floor}`),l.apartment&&_.push(`Depto ${l.apartment}`),_.length>0&&c.push(_.join(" ")),l.city&&c.push(l.city),l.province&&c.push(l.province),l.postal_code&&c.push(`(CP ${l.postal_code})`),c.length>0?c.join(", "):"-"}async function O(l,c){try{await navigator.clipboard.writeText(l),ve({type:"success",message:`${c} copiado al portapapeles`})}catch{ve({type:"error",message:"Error al copiar"})}}var te=rs();zt(l=>{Ct.title="Clientes - PAS Manager"});var re=G(te),pe=t(re),ze=r(t(pe),2);ka(ze,{variant:"primary",onclick:()=>Ne("/clientes/nuevo"),children:(l,c)=>{var _=wr(),U=G(_);tt(U,{size:18}),xe(),n(l,_)},$$slots:{default:!0}}),a(pe);var se=r(pe,2),ue=t(se),le=t(ue);Ot(le,{size:20});var me=r(le,2);Ve(me),a(ue);var he=r(ue,2),J=t(he);let Le;J.__click=[Ir,ye];var Pe=t(J);At(Pe,{size:18});var Ge=r(Pe,2);{var We=l=>{var c=Er(),_=t(c,!0);a(c),T(U=>$(_,U),[()=>e(Y)()]),n(l,c)};z(Ge,l=>{e(Y)()>0&&l(We)})}a(J);var je=r(J,2);{var la=l=>{var c=Sr();c.__click=[Pr,F,Z,I,k];var _=t(c);ot(_,{size:18}),a(c),n(l,c)};z(je,l=>{e(Y)()>0&&l(la)})}var M=r(je,2),m=t(M),f=t(m);Ve(f),f.__change=[Ar,y,Z,I,k],xe(2),a(m),a(M);var E=r(M,2),V=r(t(E),2);V.__change=[Fr,Z,I,k];var N=t(V);N.value=N.__value="first_name";var D=r(N);D.value=D.__value="last_name";var X=r(D);X.value=X.__value="policy_count";var fe=r(X);fe.value=fe.__value="created_at";var Ae=r(fe);Ae.value=Ae.__value="updated_at",a(V);var Fe=r(V,2);Fe.__click=[xr,w,Z,I,k];var be=t(Fe);{var $e=l=>{Ft(l,{size:16})},He=l=>{$t(l,{size:16})};z(be,l=>{e(w)==="asc"?l($e):l(He,!1)})}a(Fe),a(E);var Je=r(E,2),Da=t(Je);{var za=l=>{var c=$r();n(l,c)},Ua=l=>{var c=Tr(),_=G(c),U=t(_,!0);a(_);var Q=r(_,4),oe=t(Q,!0);a(Q),T(()=>{$(U,e(I).length),$(oe,e(Se))}),n(l,c)};z(Da,l=>{e(o)&&e(I).length===0?l(za):l(Ua,!1)})}a(Je),a(he),a(se);var oa=r(se,2);{var ia=l=>{var c=Mr();Ta(c,20,()=>Array(5),Ma,(_,U)=>{Tt(_,{height:"60px"})}),a(c),n(l,c)},La=l=>{var c=ra(),_=G(c);{var U=oe=>{{let Be=S(()=>e(H)?"No se encontraron resultados":"Comienza agregando tu primer cliente"),Ze=S(()=>e(H)?void 0:{label:"Nuevo Cliente",onclick:()=>Ne("/clientes/nuevo")});St(oe,{get icon(){return Vt},title:"No hay clientes",get description(){return e(Be)},get action(){return e(Ze)}})}},Q=oe=>{var Be=ts(),Ze=G(Be);Et(Ze,{children:(va,Ca)=>{var xa=as(),Ke=r(G(xa),2);Ta(Ke,21,()=>e(I),Ma,(Ba,x)=>{var da=es(),Qe=t(da),ca=t(Qe);ca.__click=[Nr,O,x];var Pa=t(ca);a(ca),a(Qe);var Re=r(Qe),Ra=t(Re);{var _a=b=>{var g=Ur();g.__click=[Dr,O,x];var B=t(g,!0);a(g),T(()=>$(B,e(x).document_number)),n(b,g)},Oa=b=>{var g=Lr();n(b,g)};z(Ra,b=>{e(x).document_number?b(_a):b(Oa,!1)})}a(Re);var Ye=r(Re),Va=t(Ye);{var pa=b=>{var g=Br();g.__click=[jr,O,x];var B=t(g);Wt(B,{size:14});var Ce=r(B);a(g),T(()=>$(Ce,` ${e(x).email_primary??""}`)),n(b,g)},ua=b=>{var g=Rr();n(b,g)};z(Va,b=>{e(x).email_primary?b(pa):b(ua,!1)})}a(Ye);var ma=r(Ye),ha=t(ma);{var qa=b=>{var g=qr(),B=t(g);B.__click=[Or,O,x];var Ce=t(B);it(Ce,{size:14});var ya=r(Ce);a(B);var Fa=r(B,2);{var Xa=Oe=>{var Me=Vr(),Za=t(Me);ut(Za,{size:20,fill:"#25d36690"}),a(Me),T(Ka=>et(Me,"href",Ka),[()=>mt(e(x).phone)]),n(Oe,Me)};z(Fa,Oe=>{pt(e(x).phone)&&Oe(Xa)})}a(g),T(()=>$(ya,` ${e(x).phone??""}`)),n(b,g)},wa=b=>{var g=Gr();n(b,g)};z(ha,b=>{e(x).phone?b(qa):b(wa,!1)})}a(ma);var fa=r(ma),Ga=t(fa);{var Wa=b=>{var g=Hr();g.__click=[Wr,O,x];var B=t(g);it(B,{size:14});var Ce=r(B);a(g),T(()=>$(Ce,` ${e(x).phone_landline??""}`)),n(b,g)},Ha=b=>{var g=Jr();n(b,g)};z(Ga,b=>{e(x).phone_landline?b(Wa):b(Ha,!1)})}a(fa);var ba=r(fa),v=t(ba);{var d=b=>{var g=Zr();g.__click=[Xr,O,ae,x];var B=t(g,!0);a(g),T(Ce=>$(B,Ce),[()=>ae(e(x))]),n(b,g)},ge=b=>{var g=Kr();n(b,g)};z(v,b=>{ae(e(x))!=="-"?b(d):b(ge,!1)})}a(ba);var we=r(ba),Ia=t(we,!0);a(we);var ga=r(we),ea=t(ga),Ea=t(ea);at(Ea,{size:14});var Sa=r(Ea,2),Ja=t(Sa,!0);a(Sa),a(ea),a(ga);var Aa=r(ga),ie=t(Aa),ne=t(ie);ne.__click=[Qr,ce,x];var aa=t(ne);qt(aa,{size:16}),a(ne);var j=r(ne,2);j.__click=[Yr,de,x];var Te=t(j);Gt(Te,{size:16}),a(j),a(ie),a(Aa),a(da),T(b=>{$(Pa,`${e(x).first_name??""}
                ${e(x).last_name??""}`),$(Ia,b),$(Ja,e(x).active_policies_count||0)},[()=>new Date(e(x).created_at).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})]),n(Ba,da)}),a(Ke),n(va,xa)},$$slots:{default:!0}});var na=r(Ze,2);Mt(na,{get hasMore(){return e(Ue)},onLoadMore:ee}),n(oe,Be)};z(_,oe=>{e(I).length===0?oe(U):oe(Q,!1)},!0)}n(l,c)};z(oa,l=>{e(o)?l(ia):l(La,!1)})}a(re);var Xe=r(re,2);hr(Xe,{get clientId(){return e(qe)},get mode(){return e(L)},onClose:_e});var ja=r(Xe,2);Cr(ja,{get open(){return e(ye)},onClose:()=>i(ye,!1),onApply:ke,get initialFilters(){return e(F)}}),T(l=>{Le=vt(J,1,"filter-btn svelte-1hp9571",null,Le,l),et(Fe,"title",e(w)==="asc"?"Ascendente":"Descendente")},[()=>({active:e(ye)||e(Y)()>0})]),Na(me,()=>e(H),l=>i(H,l)),wt(f,()=>e(y),l=>i(y,l)),Pt(V,()=>e(u),l=>i(u,l)),n(P,te),lt(),W()}rt(["click","change"]);export{Ms as component};
