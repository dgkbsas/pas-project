import"../chunks/CWj6FrbW.js";import{o as et}from"../chunks/B5RiWETq.js";import{c as tt,f as ae,a as f,a8 as ke,A as e,ax as D,aD as o,b as y,d as s,g as t,a9 as je,aW as Ue,aa as r,av as xe,aB as at,t as B,ab as j,aE as A,s as kt,n as jt,aw as wt,a1 as Ke,ay as St,aA as Et,aR as Pt}from"../chunks/T0dPp4D2.js";import{i as I}from"../chunks/iIrk5DBN.js";import{e as Ie,i as Le}from"../chunks/D_uDkMHU.js";import{r as Qe,s as Ye}from"../chunks/BjbfY3vJ.js";import{s as he}from"../chunks/BqiCCWh5.js";import{b as Dt,a as Ct}from"../chunks/DmB7dAFv.js";import{g as ye}from"../chunks/CdRlIqj1.js";import{B as Ft}from"../chunks/BpcvKk5C.js";import{P as Mt,E as Tt,T as At}from"../chunks/BU4vvWGd.js";import{d as Bt,S as Nt,a as It}from"../chunks/ASvXjQD7.js";import{b as Lt}from"../chunks/DmV6kigd.js";import{l as Ot,s as Ut,p as ze}from"../chunks/x5bn8cLp.js";import{S as Ze}from"../chunks/CeFSUsR7.js";import{B as st}from"../chunks/DJIlydZI.js";import{U as rt}from"../chunks/DTO3a6n8.js";import{C as it}from"../chunks/4fn6L_-7.js";import{S as lt}from"../chunks/DbvMrZnG.js";import{T as nt}from"../chunks/q7TW0UXd.js";import{a as Rt}from"../chunks/Dnkb2mmd.js";import"../chunks/Yaf_2f41.js";import{I as Vt,s as $t}from"../chunks/BqsbIqZd.js";import{X as qt}from"../chunks/CytF21rb.js";import{s as ve}from"../chunks/C8FjytsP.js";import{F as Gt}from"../chunks/CxVX8zWa.js";function Ht(u,a){const i=Ot(a,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.545.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const p=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z"}]];Vt(u,Ut({name:"funnel"},()=>i,{get iconNode(){return p},children:(z,m)=>{var v=tt(),b=ae(v);$t(b,a,"default",{}),f(z,v)},$$slots:{default:!0}}))}var Wt=y('<div class="loading-indicator svelte-k49ili"><div class="spinner svelte-k49ili"></div> <span>Cargando más...</span></div>'),Xt=y('<div class="infinite-scroll-sentinel svelte-k49ili"><!></div>');function Jt(u,a){ke(a,!0);let i=ze(a,"hasMore",3,!0),p=ze(a,"threshold",3,200),z=D(!1),m;et(()=>{const _=new IntersectionObserver(w=>{w[0].isIntersecting&&i()&&!e(z)&&(o(z,!0),a.onLoadMore(),setTimeout(()=>{o(z,!1)},500))},{rootMargin:`${p()}px`,threshold:.1});return m&&_.observe(m),()=>{m&&_.unobserve(m)}});var v=Xt(),b=s(v);{var k=_=>{var w=Wt();f(_,w)};I(b,_=>{i()&&_(k)})}t(v),Lt(v,_=>m=_,()=>m),f(u,v),je()}var Kt=y('<span class="expiry-badge svelte-1jbgj2g"> </span>'),Qt=(u,a)=>a.onEdit(a.policy.id),Yt=(u,a)=>a.onDelete(a.policy.id,a.policy.policy_number||"esta póliza"),Zt=y('<div class="policy-card svelte-1jbgj2g"><div class="card-header svelte-1jbgj2g"><span class="card-number svelte-1jbgj2g"> </span> <!></div> <div class="card-body svelte-1jbgj2g"><div class="policy-number svelte-1jbgj2g"> </div> <div class="policy-type svelte-1jbgj2g"> </div> <div class="card-info svelte-1jbgj2g"><div class="info-item svelte-1jbgj2g"><!> <span> </span></div> <div class="info-item svelte-1jbgj2g"><!> <span> </span> <!></div></div></div> <div class="card-actions svelte-1jbgj2g"><button class="action-btn svelte-1jbgj2g" title="Editar"><!></button> <button class="action-btn danger svelte-1jbgj2g" title="Eliminar"><!></button></div></div>');function ea(u,a){ke(a,!0);function i(x,F){return x?new Date(F)<new Date?{variant:"warning",label:"Vencida"}:{variant:"success",label:"Activa"}:{variant:"error",label:"Inactiva"}}function p(x){const F=new Date,M=new Date(x);return Math.ceil((M.getTime()-F.getTime())/(1e3*60*60*24))}function z(x){return new Date(x).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}const m=A(()=>i(a.policy.active,a.policy.expiry_date)),v=A(()=>p(a.policy.expiry_date)),b=A(()=>a.policy.client?`${a.policy.client.first_name} ${a.policy.client.last_name}`:"Cliente no disponible");var k=Zt(),_=s(k),w=s(_),W=s(w);t(w);var L=r(w,2);st(L,{get variant(){return e(m).variant},children:(x,F)=>{xe();var M=at();B(()=>j(M,e(m).label)),f(x,M)},$$slots:{default:!0}}),t(_);var N=r(_,2),g=s(N),E=s(g,!0);t(g);var C=r(g,2),R=s(C,!0);t(C);var V=r(C,2),P=s(V),X=s(P);rt(X,{size:14});var se=r(X,2),we=s(se,!0);t(se),t(P);var ce=r(P,2),de=s(ce);it(de,{size:14});var J=r(de,2),re=s(J,!0);t(J);var ie=r(J,2);{var Se=x=>{var F=Kt(),M=s(F);t(F),B(()=>j(M,`${e(v)??""}d`)),f(x,F)};I(ie,x=>{e(v)<=30&&e(v)>0&&x(Se)})}t(ce),t(V),t(N);var K=r(N,2),O=s(K);O.__click=[Qt,a];var ue=s(O);lt(ue,{size:16}),t(O);var Q=r(O,2);Q.__click=[Yt,a];var pe=s(Q);nt(pe,{size:16}),t(Q),t(K),t(k),B(x=>{j(W,`#${a.index+1}`),j(E,a.policy.policy_number||"S/N"),j(R,a.policy.policy_type),j(we,e(b)),j(re,x)},[()=>z(a.policy.expiry_date)]),f(u,k),je()}Ue(["click"]);function Oe(u,a){const i=p=>{u&&!u.contains(p.target)&&!p.defaultPrevented&&a()};return document.addEventListener("click",i,!0),{destroy(){document.removeEventListener("click",i,!0)}}}function ta(u,a){a(!a())}var aa=y('<span class="filter-badge svelte-aysfzr"> </span>'),sa=y('<div class="filter-dropdown svelte-aysfzr"><div class="filter-header svelte-aysfzr"><span class="filter-title svelte-aysfzr">Filtros</span> <button class="close-btn svelte-aysfzr" aria-label="Cerrar"><!></button></div> <div class="filter-content svelte-aysfzr"><!></div></div>'),ra=y('<div class="filter-popup svelte-aysfzr"><button title="Filtros" aria-label="Abrir filtros"><!> <!></button> <!></div>');function ia(u,a){ke(a,!0);let i=ze(a,"open",15,!1),p=ze(a,"activeFiltersCount",3,0);function z(){var g;i(!1),(g=a.onClose)==null||g.call(a)}function m(){i()&&z()}var v=ra(),b=s(v);let k;b.__click=[ta,i];var _=s(b);Ht(_,{size:18});var w=r(_,2);{var W=g=>{var E=aa(),C=s(E,!0);t(E),B(()=>j(C,p())),f(g,E)};I(w,g=>{p()>0&&g(W)})}t(b);var L=r(b,2);{var N=g=>{var E=sa(),C=s(E),R=r(s(C),2);R.__click=z;var V=s(R);qt(V,{size:16}),t(R),t(C);var P=r(C,2),X=s(P);kt(X,()=>a.children??jt),t(P),t(E),f(g,E)};I(L,g=>{i()&&g(N)})}t(v),Rt(v,(g,E)=>Oe==null?void 0:Oe(g,E),()=>m),B(g=>k=he(b,1,"filter-trigger svelte-aysfzr",null,k,g),[()=>({active:i()||p()>0})]),f(u,v),je()}Ue(["click"]);function la(u,a,i,p){o(a,"all"),o(i,"created_at"),o(p,"desc")}var na=y("<!> Nueva Póliza",1),oa=(u,a,i,p,z)=>{localStorage.setItem("policies_show_inactive",e(a).toString()),o(i,1),o(p,[],!0),z()},va=(u,a)=>o(a,"asc"),ca=(u,a)=>o(a,"desc"),da=y('<button class="clear-filters-btn svelte-17pngxe">Limpiar filtros</button>'),ua=y('<div class="filter-group svelte-17pngxe"><div class="filter-label svelte-17pngxe">Estado</div> <!></div> <div class="filter-group svelte-17pngxe"><div class="filter-label svelte-17pngxe">Ordenar por</div> <!></div> <div class="filter-group svelte-17pngxe"><div class="filter-label svelte-17pngxe">Dirección</div> <div class="sort-direction svelte-17pngxe"><button>Ascendente</button> <button>Descendente</button></div></div> <!>',1),pa=y('<div class="results-count svelte-17pngxe"><span class="count-text svelte-17pngxe"> </span> <span class="count-separator svelte-17pngxe">/</span> <span class="count-total svelte-17pngxe"> </span></div>'),_a=y('<div class="skeleton-list svelte-17pngxe"></div>'),ga=y('<span class="expiry-badge svelte-17pngxe"> </span>'),fa=(u,a)=>ye(`/polizas/${e(a).id}/editar`),ma=(u,a,i)=>a(e(i).id,e(i).policy_number||"esta póliza"),ba=y('<tr class="svelte-17pngxe"><td class="row-number svelte-17pngxe"></td><td class="svelte-17pngxe"><a class="policy-number svelte-17pngxe"> </a></td><td class="svelte-17pngxe"><div class="client-info svelte-17pngxe"><!> <a class="client-link svelte-17pngxe"> </a></div></td><td class="svelte-17pngxe"> </td><td class="svelte-17pngxe"><!></td><td class="svelte-17pngxe"><div class="expiry-info svelte-17pngxe"><!> <span> </span> <!></div></td><td class="text-right svelte-17pngxe"><div class="actions svelte-17pngxe"><button class="action-btn svelte-17pngxe" title="Editar"><!></button> <button class="action-btn danger svelte-17pngxe" title="Eliminar"><!></button></div></td></tr>'),xa=y('<thead class="sticky-header svelte-17pngxe"><tr class="svelte-17pngxe"><th style="width: 60px" class="svelte-17pngxe">#</th><th class="svelte-17pngxe">N° Póliza</th><th class="svelte-17pngxe">Cliente</th><th class="svelte-17pngxe">Tipo</th><th class="svelte-17pngxe">Estado</th><th class="svelte-17pngxe">Vencimiento</th><th class="text-right svelte-17pngxe">Acciones</th></tr></thead> <tbody class="svelte-17pngxe"></tbody>',1),ha=y('<div class="cards-grid svelte-17pngxe"></div> <div class="table-container svelte-17pngxe"><!></div> <!>',1),ya=y('<div class="page svelte-17pngxe"><div class="page-header svelte-17pngxe"><div class="svelte-17pngxe"><h1 class="svelte-17pngxe">Pólizas</h1> <p class="svelte-17pngxe">Gestiona todas las pólizas de seguros</p></div> <!></div> <div class="filters-toolbar svelte-17pngxe"><div class="search-box svelte-17pngxe"><!> <input type="text" placeholder="Buscar pólizas..." class="svelte-17pngxe"/></div> <div class="toolbar-actions svelte-17pngxe"><div class="filter-checkbox svelte-17pngxe"><label class="checkbox-label svelte-17pngxe"><input type="checkbox" class="svelte-17pngxe"/> <span class="svelte-17pngxe">Mostrar inactivas</span></label></div> <!> <!></div></div> <!></div>');function Xa(u,a){ke(a,!0);let i=D(wt([])),p=D(!0),z=D(!1),m=D(""),v=D("all"),b=D("created_at"),k=D("desc"),_=D(!1),w=D(1),W=30,L=D(0),N=D(!0),g=D(!1);const E=[{value:"all",label:"Todos los estados"},{value:"active",label:"Activa"},{value:"inactive",label:"Inactiva"},{value:"expiring_soon",label:"Por vencer"}],C=[{value:"created_at",label:"Fecha de creación"},{value:"expiry_date",label:"Fecha de vencimiento"},{value:"policy_number",label:"Número de póliza"},{value:"policy_type",label:"Tipo de póliza"}];et(()=>{const l=localStorage.getItem("policies_show_inactive");l!==null&&o(_,l==="true"),P()});const R=Bt(()=>{o(w,1),o(i,[],!0),P()},300);Ke(()=>{e(m)!==void 0&&R()});let V=!0;Ke(()=>{if(e(v),e(b),e(k),V){V=!1;return}o(w,1),o(i,[],!0),P()});async function P(l=!1){var d;l?o(z,!0):o(p,!0);try{const n=new URLSearchParams({page:e(w).toString(),limit:W.toString(),sortBy:e(b),sortOrder:e(k)});e(m)&&n.append("search",e(m)),e(v)&&e(v)!=="all"&&n.append("status",e(v)),e(_)||n.append("active_only","true"),console.log("Fetching policies:",`/api/policies?${n}`);const h=await fetch(`/api/policies?${n}`);console.log("Response status:",h.status);const S=await h.json();console.log("Result:",S),h.ok?(l?o(i,[...e(i),...S.policies||[]],!0):o(i,S.policies||[],!0),o(L,((d=S.pagination)==null?void 0:d.total)||0,!0),o(N,e(i).length<e(L))):(ve({type:"error",message:S.message||"Error al cargar pólizas"}),o(i,[],!0))}catch(n){console.error("Error loading policies:",n),ve({type:"error",message:"Error al cargar pólizas"}),o(i,[],!0)}finally{o(p,!1),o(z,!1)}}function X(){!e(p)&&!e(z)&&e(N)&&(Pt(w),P(!0))}async function se(l,d){if(confirm(`¿Seguro que deseas eliminar la póliza ${d}?`))try{const n=await fetch(`/api/policies/${l}`,{method:"DELETE"});if(n.ok)ve({type:"success",message:"Póliza eliminada"}),P();else{const h=await n.json();ve({type:"error",message:h.message})}}catch{ve({type:"error",message:"Error al eliminar"})}}function we(l){return new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}function ce(l,d){return l?new Date(d)<new Date?{variant:"warning",label:"Vencida"}:{variant:"success",label:"Activa"}:{variant:"error",label:"Inactiva"}}function de(l){const d=new Date,n=new Date(l);return Math.ceil((n.getTime()-d.getTime())/(1e3*60*60*24))}const J=A(()=>()=>{let l=0;return e(v)!=="all"&&l++,l});var re=ya();St(l=>{Et.title="Pólizas - PAS Manager"});var ie=s(re),Se=r(s(ie),2);Ft(Se,{variant:"primary",onclick:()=>ye("/polizas/nuevo"),children:(l,d)=>{var n=na(),h=ae(n);Mt(h,{size:18}),xe(),f(l,n)},$$slots:{default:!0}}),t(ie);var K=r(ie,2),O=s(K),ue=s(O);Nt(ue,{size:20});var Q=r(ue,2);Qe(Q),t(O);var pe=r(O,2),x=s(pe),F=s(x),M=s(F);Qe(M),M.__change=[oa,_,w,i,P],xe(2),t(F),t(x);var _e=r(x,2);{const l=n=>{var h=ua(),S=ae(h),T=r(s(S),2);Ze(T,{get options(){return E},placeholder:"Todos",get value(){return e(v)},set value(c){o(v,c,!0)}}),t(S);var U=r(S,2),$=r(s(U),2);Ze($,{get options(){return C},placeholder:"Seleccionar",get value(){return e(b)},set value(c){o(b,c,!0)}}),t(U);var q=r(U,2),ge=r(s(q),2),le=s(ge);let Y;le.__click=[va,k];var ne=r(le,2);let G;ne.__click=[ca,k],t(ge),t(q);var Z=r(q,2);{var Ee=c=>{var ee=da();ee.__click=[la,v,b,k],f(c,ee)};I(Z,c=>{e(J)()>0&&c(Ee)})}B((c,ee)=>{Y=he(le,1,"sort-btn svelte-17pngxe",null,Y,c),G=he(ne,1,"sort-btn svelte-17pngxe",null,G,ee)},[()=>({active:e(k)==="asc"}),()=>({active:e(k)==="desc"})]),f(n,h)};let d=A(()=>e(J)());ia(_e,{get activeFiltersCount(){return e(d)},get open(){return e(g)},set open(n){o(g,n,!0)},children:l,$$slots:{default:!0}})}var ot=r(_e,2);{var vt=l=>{var d=pa(),n=s(d),h=s(n,!0);t(n);var S=r(n,4),T=s(S,!0);t(S),t(d),B(()=>{j(h,e(i).length),j(T,e(L))}),f(l,d)};I(ot,l=>{e(L)>0&&l(vt)})}t(pe),t(K);var ct=r(K,2);{var dt=l=>{var d=_a();Ie(d,20,()=>Array(5),Le,(n,h)=>{It(n,{height:"60px"})}),t(d),f(l,d)},ut=l=>{var d=tt(),n=ae(d);{var h=T=>{{let U=A(()=>e(m)||e(v)!=="all"?"No se encontraron resultados":"Comienza agregando tu primera póliza"),$=A(()=>e(m)||e(v)!=="all"?void 0:{label:"Nueva Póliza",onclick:()=>ye("/polizas/nuevo")});Tt(T,{get icon(){return Gt},title:"No hay pólizas",get description(){return e(U)},get action(){return e($)}})}},S=T=>{var U=ha(),$=ae(U);Ie($,21,()=>e(i),Le,(Y,ne,G)=>{ea(Y,{get policy(){return e(ne)},index:G,onEdit:Z=>ye(`/polizas/${Z}/editar`),onDelete:se})}),t($);var q=r($,2),ge=s(q);At(ge,{children:(Y,ne)=>{var G=xa(),Z=r(ae(G),2);Ie(Z,21,()=>e(i),Le,(Ee,c,ee)=>{const Re=A(()=>ce(e(c).active,e(c).expiry_date)),oe=A(()=>de(e(c).expiry_date)),pt=A(()=>e(c).client?`${e(c).client.first_name} ${e(c).client.last_name}`:"Cliente no disponible");var Pe=ba(),Ve=s(Pe);Ve.textContent=ee+1;var De=r(Ve),Ce=s(De),_t=s(Ce,!0);t(Ce),t(De);var Fe=r(De),$e=s(Fe),qe=s($e);rt(qe,{size:14});var Me=r(qe,2),gt=s(Me,!0);t(Me),t($e),t(Fe);var Te=r(Fe),ft=s(Te,!0);t(Te);var Ae=r(Te),mt=s(Ae);st(mt,{get variant(){return e(Re).variant},children:(H,te)=>{xe();var be=at();B(()=>j(be,e(Re).label)),f(H,be)},$$slots:{default:!0}}),t(Ae);var Be=r(Ae),Ge=s(Be),He=s(Ge);it(He,{size:14});var fe=r(He,2);let We;var bt=s(fe,!0);t(fe);var xt=r(fe,2);{var ht=H=>{var te=ga(),be=s(te);t(te),B(()=>j(be,`${e(oe)??""}d`)),f(H,te)};I(xt,H=>{e(oe)<=30&&e(oe)>0&&H(ht)})}t(Ge),t(Be);var Xe=r(Be),Je=s(Xe),me=s(Je);me.__click=[fa,c];var yt=s(me);lt(yt,{size:16}),t(me);var Ne=r(me,2);Ne.__click=[ma,se,c];var zt=s(Ne);nt(zt,{size:16}),t(Ne),t(Je),t(Xe),t(Pe),B((H,te)=>{Ye(Ce,"href",`/polizas/${e(c).id??""}`),j(_t,e(c).policy_number||"S/N"),Ye(Me,"href",`/clientes/${e(c).client_id??""}`),j(gt,e(pt)),j(ft,e(c).policy_type),We=he(fe,1,"svelte-17pngxe",null,We,H),j(bt,te)},[()=>({warning:e(oe)<=30&&e(oe)>0}),()=>we(e(c).expiry_date)]),f(Ee,Pe)}),t(Z),f(Y,G)},$$slots:{default:!0}}),t(q);var le=r(q,2);Jt(le,{get hasMore(){return e(N)},onLoadMore:X}),f(T,U)};I(n,T=>{e(i).length===0?T(h):T(S,!1)},!0)}f(l,d)};I(ct,l=>{e(p)?l(dt):l(ut,!1)})}t(re),Dt(Q,()=>e(m),l=>o(m,l)),Ct(M,()=>e(_),l=>o(_,l)),f(u,re),je()}Ue(["change","click"]);export{Xa as component};
